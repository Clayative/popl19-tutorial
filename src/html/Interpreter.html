<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Interpreter</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">-- Interpreter for WHILE language.</a>

<a id="37" class="Comment">-- As computation is not guaranteed to terminate,</a>
<a id="87" class="Comment">-- execution of statements is placed in the Delay monad.</a>

<a id="145" class="Keyword">module</a> <a id="152" href="Interpreter.html" class="Module">Interpreter</a> <a id="164" class="Keyword">where</a>

<a id="171" class="Keyword">open</a> <a id="176" class="Keyword">import</a> <a id="183" href="Library.html" class="Module">Library</a>
<a id="191" class="Keyword">open</a> <a id="196" class="Keyword">import</a> <a id="203" href="WellTypedSyntax.html" class="Module">WellTypedSyntax</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Value.html" class="Module">Value</a>

<a id="238" class="Keyword">open</a> <a id="243" class="Keyword">import</a> <a id="250" href="Delay.html" class="Module">Delay</a> <a id="256" class="Keyword">using</a> <a id="262" class="Symbol">(</a><a id="263" href="Delay.html#221" class="Record">Delay</a><a id="268" class="Symbol">;</a> <a id="270" href="Delay.html#314" class="Field">force</a><a id="275" class="Symbol">;</a> <a id="277" href="Delay.html#438" class="InductiveConstructor">later&#39;</a><a id="283" class="Symbol">;</a> <a id="285" href="Delay.html#1398" class="Function">runDelay</a><a id="293" class="Symbol">)</a> <a id="295" class="Keyword">public</a>

<a id="303" class="Comment">-- Evaluation of expressions in fixed environment ρ.</a>

<a id="357" class="Keyword">module</a> <a id="EvalExp"></a><a id="364" href="Interpreter.html#364" class="Module">EvalExp</a> <a id="372" class="Symbol">{</a><a id="373" href="Interpreter.html#373" class="Bound">Γ</a><a id="374" class="Symbol">}</a> <a id="376" class="Symbol">(</a><a id="377" href="Interpreter.html#377" class="Bound">ρ</a> <a id="379" class="Symbol">:</a> <a id="381" href="Value.html#382" class="Function">Env</a> <a id="385" href="Interpreter.html#373" class="Bound">Γ</a><a id="386" class="Symbol">)</a> <a id="388" class="Keyword">where</a>

  <a id="EvalExp.eval"></a><a id="397" href="Interpreter.html#397" class="Function">eval</a> <a id="402" class="Symbol">:</a> <a id="404" class="Symbol">∀{</a><a id="406" href="Interpreter.html#406" class="Bound">t</a><a id="407" class="Symbol">}</a> <a id="409" class="Symbol">(</a><a id="410" href="Interpreter.html#410" class="Bound">e</a> <a id="412" class="Symbol">:</a> <a id="414" href="WellTypedSyntax.html#499" class="Datatype">Exp</a> <a id="418" href="Interpreter.html#373" class="Bound">Γ</a> <a id="420" href="Interpreter.html#406" class="Bound">t</a><a id="421" class="Symbol">)</a> <a id="423" class="Symbol">→</a> <a id="425" href="Value.html#144" class="Function">Val</a> <a id="429" href="Interpreter.html#406" class="Bound">t</a>
  <a id="433" href="Interpreter.html#397" class="Function">eval</a> <a id="438" class="Symbol">(</a><a id="439" href="WellTypedSyntax.html#549" class="InductiveConstructor">eInt</a>  <a id="445" href="Interpreter.html#445" class="Bound">i</a><a id="446" class="Symbol">)</a>              <a id="461" class="Symbol">=</a> <a id="463" href="Interpreter.html#445" class="Bound">i</a>
  <a id="467" href="Interpreter.html#397" class="Function">eval</a> <a id="472" class="Symbol">(</a><a id="473" href="WellTypedSyntax.html#611" class="InductiveConstructor">eBool</a> <a id="479" href="Interpreter.html#479" class="Bound">b</a><a id="480" class="Symbol">)</a>              <a id="495" class="Symbol">=</a> <a id="497" href="Interpreter.html#479" class="Bound">b</a>
  <a id="501" href="Interpreter.html#397" class="Function">eval</a> <a id="506" class="Symbol">(</a><a id="507" href="WellTypedSyntax.html#767" class="InductiveConstructor">eVar</a> <a id="512" href="Interpreter.html#512" class="Bound">x</a><a id="513" class="Symbol">)</a>               <a id="529" class="Symbol">=</a> <a id="531" href="Data.List.All.html#1287" class="Function">All.lookup</a> <a id="542" href="Interpreter.html#377" class="Bound">ρ</a> <a id="544" href="Interpreter.html#512" class="Bound">x</a>
  <a id="548" href="Interpreter.html#397" class="Function">eval</a> <a id="553" class="Symbol">(</a><a id="554" href="WellTypedSyntax.html#690" class="InductiveConstructor">eOp</a> <a id="558" href="WellTypedSyntax.html#381" class="InductiveConstructor">plus</a> <a id="563" href="Interpreter.html#563" class="Bound">e₁</a> <a id="566" href="Interpreter.html#566" class="Bound">e₂</a><a id="568" class="Symbol">)</a>       <a id="576" class="Symbol">=</a> <a id="578" href="Interpreter.html#397" class="Function">eval</a> <a id="583" href="Interpreter.html#563" class="Bound">e₁</a> <a id="586" href="Data.Integer.Base.html#2021" class="Function Operator">+</a> <a id="588" href="Interpreter.html#397" class="Function">eval</a> <a id="593" href="Interpreter.html#566" class="Bound">e₂</a>
  <a id="598" href="Interpreter.html#397" class="Function">eval</a> <a id="603" class="Symbol">(</a><a id="604" href="WellTypedSyntax.html#690" class="InductiveConstructor">eOp</a> <a id="608" href="WellTypedSyntax.html#403" class="InductiveConstructor">gt</a>  <a id="612" href="Interpreter.html#612" class="Bound">e₁</a> <a id="615" href="Interpreter.html#615" class="Bound">e₂</a><a id="617" class="Symbol">)</a>        <a id="626" class="Symbol">=</a> <a id="628" href="Value.html#557" class="Function">iGt</a> <a id="632" class="Symbol">(</a><a id="633" href="Interpreter.html#397" class="Function">eval</a> <a id="638" href="Interpreter.html#612" class="Bound">e₁</a><a id="640" class="Symbol">)</a> <a id="642" class="Symbol">(</a><a id="643" href="Interpreter.html#397" class="Function">eval</a> <a id="648" href="Interpreter.html#615" class="Bound">e₂</a><a id="650" class="Symbol">)</a>
  <a id="654" href="Interpreter.html#397" class="Function">eval</a> <a id="659" class="Symbol">(</a><a id="660" href="WellTypedSyntax.html#690" class="InductiveConstructor">eOp</a> <a id="664" href="WellTypedSyntax.html#426" class="InductiveConstructor">and</a> <a id="668" href="Interpreter.html#668" class="Bound">e₁</a> <a id="671" href="Interpreter.html#671" class="Bound">e₂</a><a id="673" class="Symbol">)</a>        <a id="682" class="Symbol">=</a> <a id="684" href="Function.html#3497" class="Function Operator">case</a> <a id="689" href="Interpreter.html#397" class="Function">eval</a> <a id="694" href="Interpreter.html#668" class="Bound">e₁</a> <a id="697" href="Function.html#3497" class="Function Operator">of</a> <a id="700" class="Symbol">λ</a> <a id="702" class="Keyword">where</a>
    <a id="712" href="AST.html#493" class="InductiveConstructor">true</a>  <a id="718" class="Symbol">→</a> <a id="720" href="Interpreter.html#397" class="Function">eval</a> <a id="725" href="Interpreter.html#671" class="Bound">e₂</a>
    <a id="732" href="AST.html#498" class="InductiveConstructor">false</a> <a id="738" class="Symbol">→</a> <a id="740" href="AST.html#498" class="InductiveConstructor">false</a>

<a id="747" class="Keyword">open</a> <a id="752" href="Interpreter.html#364" class="Module">EvalExp</a>

<a id="761" class="Comment">-- Execution of declarations, extending the environment.</a>

<a id="execDecl"></a><a id="819" href="Interpreter.html#819" class="Function">execDecl</a> <a id="828" class="Symbol">:</a> <a id="830" class="Symbol">∀{</a><a id="832" href="Interpreter.html#832" class="Bound">Γ</a> <a id="834" href="Interpreter.html#834" class="Bound">t</a><a id="835" class="Symbol">}</a> <a id="837" class="Symbol">(</a><a id="838" href="Interpreter.html#838" class="Bound">d</a> <a id="840" class="Symbol">:</a> <a id="842" href="WellTypedSyntax.html#884" class="Datatype">Decl</a> <a id="847" href="Interpreter.html#832" class="Bound">Γ</a> <a id="849" href="Interpreter.html#834" class="Bound">t</a><a id="850" class="Symbol">)</a> <a id="852" class="Symbol">(</a><a id="853" href="Interpreter.html#853" class="Bound">ρ</a> <a id="855" class="Symbol">:</a> <a id="857" href="Value.html#382" class="Function">Env</a> <a id="861" href="Interpreter.html#832" class="Bound">Γ</a><a id="862" class="Symbol">)</a> <a id="864" class="Symbol">→</a> <a id="866" href="Value.html#382" class="Function">Env</a> <a id="870" class="Symbol">(</a><a id="871" href="Interpreter.html#834" class="Bound">t</a> <a id="873" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="875" href="Interpreter.html#832" class="Bound">Γ</a><a id="876" class="Symbol">)</a>
<a id="878" href="Interpreter.html#819" class="Function">execDecl</a> <a id="887" class="Symbol">(</a><a id="888" href="WellTypedSyntax.html#924" class="InductiveConstructor">dInit</a> <a id="894" href="Interpreter.html#894" class="Bound">e</a><a id="895" class="Symbol">)</a> <a id="897" href="Interpreter.html#897" class="Bound">ρ</a> <a id="899" class="Symbol">=</a> <a id="901" href="Interpreter.html#397" class="Function">eval</a> <a id="906" href="Interpreter.html#897" class="Bound">ρ</a> <a id="908" href="Interpreter.html#894" class="Bound">e</a> <a id="910" href="Data.List.All.html#921" class="InductiveConstructor Operator">∷</a> <a id="912" href="Interpreter.html#897" class="Bound">ρ</a>

<a id="execDecls"></a><a id="915" href="Interpreter.html#915" class="Function">execDecls</a> <a id="925" class="Symbol">:</a> <a id="927" class="Symbol">∀{</a><a id="929" href="Interpreter.html#929" class="Bound">Γ</a> <a id="931" href="Interpreter.html#931" class="Bound">Γ&#39;</a><a id="933" class="Symbol">}</a> <a id="935" class="Symbol">(</a><a id="936" href="Interpreter.html#936" class="Bound">ds</a> <a id="939" class="Symbol">:</a> <a id="941" href="WellTypedSyntax.html#963" class="Datatype">Decls</a> <a id="947" href="Interpreter.html#929" class="Bound">Γ</a> <a id="949" href="Interpreter.html#931" class="Bound">Γ&#39;</a><a id="951" class="Symbol">)</a> <a id="953" class="Symbol">(</a><a id="954" href="Interpreter.html#954" class="Bound">ρ</a> <a id="956" class="Symbol">:</a> <a id="958" href="Value.html#382" class="Function">Env</a> <a id="962" href="Interpreter.html#929" class="Bound">Γ</a><a id="963" class="Symbol">)</a> <a id="965" class="Symbol">→</a> <a id="967" href="Value.html#382" class="Function">Env</a> <a id="971" href="Interpreter.html#931" class="Bound">Γ&#39;</a>
<a id="974" href="Interpreter.html#915" class="Function">execDecls</a> <a id="984" href="WellTypedSyntax.html#999" class="InductiveConstructor">[]</a>       <a id="993" href="Interpreter.html#993" class="Bound">ρ</a> <a id="995" class="Symbol">=</a> <a id="997" href="Interpreter.html#993" class="Bound">ρ</a>
<a id="999" href="Interpreter.html#915" class="Function">execDecls</a> <a id="1009" class="Symbol">(</a><a id="1010" href="Interpreter.html#1010" class="Bound">d</a> <a id="1012" href="WellTypedSyntax.html#1017" class="InductiveConstructor Operator">∷</a> <a id="1014" href="Interpreter.html#1014" class="Bound">ds</a><a id="1016" class="Symbol">)</a> <a id="1018" href="Interpreter.html#1018" class="Bound">ρ</a> <a id="1020" class="Symbol">=</a> <a id="1022" href="Interpreter.html#915" class="Function">execDecls</a> <a id="1032" href="Interpreter.html#1014" class="Bound">ds</a> <a id="1035" class="Symbol">(</a><a id="1036" href="Interpreter.html#819" class="Function">execDecl</a> <a id="1045" href="Interpreter.html#1010" class="Bound">d</a> <a id="1047" href="Interpreter.html#1018" class="Bound">ρ</a><a id="1048" class="Symbol">)</a>

<a id="1051" class="Comment">-- Execution of statements.</a>

<a id="1080" class="Comment">-- We use the delay monad for non-termination</a>
<a id="1126" class="Comment">-- and the state monad for environment update.</a>

<a id="1174" class="Keyword">module</a> <a id="ExecStm"></a><a id="1181" href="Interpreter.html#1181" class="Module">ExecStm</a> <a id="1189" class="Symbol">{</a><a id="1190" href="Interpreter.html#1190" class="Bound">Γ</a> <a id="1192" class="Symbol">:</a> <a id="1194" href="WellTypedSyntax.html#249" class="Function">Cxt</a><a id="1197" class="Symbol">}</a> <a id="1199" class="Keyword">where</a>

  <a id="1208" class="Keyword">record</a> <a id="ExecStm.Exec"></a><a id="1215" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1220" class="Symbol">(</a><a id="1221" href="Interpreter.html#1221" class="Bound">i</a> <a id="1223" class="Symbol">:</a> <a id="1225" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="1229" class="Symbol">)</a> <a id="1231" class="Symbol">(</a><a id="1232" href="Interpreter.html#1232" class="Bound">A</a> <a id="1234" class="Symbol">:</a> <a id="1236" class="PrimitiveType">Set</a><a id="1239" class="Symbol">)</a> <a id="1241" class="Symbol">:</a> <a id="1243" class="PrimitiveType">Set</a> <a id="1247" class="Keyword">where</a>
    <a id="1257" class="Keyword">field</a>
      <a id="ExecStm.Exec.runExec"></a><a id="1269" href="Interpreter.html#1269" class="Field">runExec</a> <a id="1277" class="Symbol">:</a> <a id="1279" class="Symbol">(</a><a id="1280" href="Interpreter.html#1280" class="Bound">ρ</a> <a id="1282" class="Symbol">:</a> <a id="1284" href="Value.html#382" class="Function">Env</a> <a id="1288" href="Interpreter.html#1190" class="Bound">Γ</a><a id="1289" class="Symbol">)</a> <a id="1291" class="Symbol">→</a> <a id="1293" href="Delay.html#221" class="Record">Delay</a> <a id="1299" href="Interpreter.html#1221" class="Bound">i</a> <a id="1301" class="Symbol">(</a><a id="1302" href="Interpreter.html#1232" class="Bound">A</a> <a id="1304" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="1306" href="Value.html#382" class="Function">Env</a> <a id="1310" href="Interpreter.html#1190" class="Bound">Γ</a><a id="1311" class="Symbol">)</a>
  <a id="1315" class="Keyword">open</a> <a id="1320" href="Interpreter.html#1215" class="Module">Exec</a> <a id="1325" class="Keyword">public</a>

  <a id="1335" class="Comment">-- Monad.</a>

  <a id="1348" class="Keyword">private</a>
    <a id="ExecStm.returnExec"></a><a id="1360" href="Interpreter.html#1360" class="Function">returnExec</a> <a id="1371" class="Symbol">:</a> <a id="1373" class="Symbol">∀{</a><a id="1375" href="Interpreter.html#1375" class="Bound">i</a> <a id="1377" href="Interpreter.html#1377" class="Bound">A</a><a id="1378" class="Symbol">}</a> <a id="1380" class="Symbol">(</a><a id="1381" href="Interpreter.html#1381" class="Bound">a</a> <a id="1383" class="Symbol">:</a> <a id="1385" href="Interpreter.html#1377" class="Bound">A</a><a id="1386" class="Symbol">)</a> <a id="1388" class="Symbol">→</a> <a id="1390" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1395" href="Interpreter.html#1375" class="Bound">i</a> <a id="1397" href="Interpreter.html#1377" class="Bound">A</a>
    <a id="1403" href="Interpreter.html#1360" class="Function">returnExec</a> <a id="1414" href="Interpreter.html#1414" class="Bound">a</a> <a id="1416" class="Symbol">.</a><a id="1417" href="Interpreter.html#1269" class="Field">runExec</a> <a id="1425" href="Interpreter.html#1425" class="Bound">ρ</a> <a id="1427" class="Symbol">=</a> <a id="1429" href="Library.Monad.html#1110" class="Function">return</a> <a id="1436" class="Symbol">(</a><a id="1437" href="Interpreter.html#1414" class="Bound">a</a> <a id="1439" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">,</a> <a id="1441" href="Interpreter.html#1425" class="Bound">ρ</a><a id="1442" class="Symbol">)</a>

    <a id="ExecStm.bindExec"></a><a id="1449" href="Interpreter.html#1449" class="Function">bindExec</a> <a id="1458" class="Symbol">:</a> <a id="1460" class="Symbol">∀{</a><a id="1462" href="Interpreter.html#1462" class="Bound">i</a> <a id="1464" href="Interpreter.html#1464" class="Bound">A</a> <a id="1466" href="Interpreter.html#1466" class="Bound">B</a><a id="1467" class="Symbol">}</a> <a id="1469" class="Symbol">(</a><a id="1470" href="Interpreter.html#1470" class="Bound">m</a> <a id="1472" class="Symbol">:</a> <a id="1474" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1479" href="Interpreter.html#1462" class="Bound">i</a> <a id="1481" href="Interpreter.html#1464" class="Bound">A</a><a id="1482" class="Symbol">)</a> <a id="1484" class="Symbol">(</a><a id="1485" href="Interpreter.html#1485" class="Bound">k</a> <a id="1487" class="Symbol">:</a> <a id="1489" href="Interpreter.html#1464" class="Bound">A</a> <a id="1491" class="Symbol">→</a> <a id="1493" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1498" href="Interpreter.html#1462" class="Bound">i</a> <a id="1500" href="Interpreter.html#1466" class="Bound">B</a><a id="1501" class="Symbol">)</a> <a id="1503" class="Symbol">→</a> <a id="1505" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1510" href="Interpreter.html#1462" class="Bound">i</a> <a id="1512" href="Interpreter.html#1466" class="Bound">B</a>
    <a id="1518" href="Interpreter.html#1449" class="Function">bindExec</a> <a id="1527" href="Interpreter.html#1527" class="Bound">m</a> <a id="1529" href="Interpreter.html#1529" class="Bound">k</a> <a id="1531" class="Symbol">.</a><a id="1532" href="Interpreter.html#1269" class="Field">runExec</a> <a id="1540" href="Interpreter.html#1540" class="Bound">ρ</a> <a id="1542" class="Symbol">=</a> <a id="1544" href="Interpreter.html#1527" class="Bound">m</a> <a id="1546" class="Symbol">.</a><a id="1547" href="Interpreter.html#1269" class="Field">runExec</a> <a id="1555" href="Interpreter.html#1540" class="Bound">ρ</a> <a id="1557" href="Library.Monad.html#1002" class="Field Operator">&gt;&gt;=</a> <a id="1561" class="Symbol">λ</a> <a id="1563" class="Keyword">where</a>
      <a id="1575" class="Symbol">(</a><a id="1576" href="Interpreter.html#1576" class="Bound">a</a> <a id="1578" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">,</a> <a id="1580" href="Interpreter.html#1580" class="Bound">ρ&#39;</a><a id="1582" class="Symbol">)</a> <a id="1584" class="Symbol">→</a> <a id="1586" href="Interpreter.html#1529" class="Bound">k</a> <a id="1588" href="Interpreter.html#1576" class="Bound">a</a> <a id="1590" class="Symbol">.</a><a id="1591" href="Interpreter.html#1269" class="Field">runExec</a> <a id="1599" href="Interpreter.html#1580" class="Bound">ρ&#39;</a>

  <a id="1605" class="Keyword">instance</a>
    <a id="ExecStm.functorExec"></a><a id="1618" href="Interpreter.html#1618" class="Function">functorExec</a> <a id="1630" class="Symbol">:</a> <a id="1632" class="Symbol">∀</a> <a id="1634" class="Symbol">{</a><a id="1635" href="Interpreter.html#1635" class="Bound">i</a><a id="1636" class="Symbol">}</a> <a id="1638" class="Symbol">→</a> <a id="1640" href="Library.Monad.html#157" class="Record">Functor</a> <a id="1648" class="Symbol">(</a><a id="1649" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1654" href="Interpreter.html#1635" class="Bound">i</a><a id="1655" class="Symbol">)</a>
    <a id="1661" href="Library.Monad.html#245" class="Field">fmap</a> <a id="1666" class="Symbol">{{</a><a id="1668" href="Interpreter.html#1618" class="Function">functorExec</a><a id="1679" class="Symbol">}}</a> <a id="1682" href="Interpreter.html#1682" class="Bound">f</a> <a id="1684" href="Interpreter.html#1684" class="Bound">mx</a> <a id="1687" class="Symbol">=</a> <a id="1689" href="Interpreter.html#1449" class="Function">bindExec</a> <a id="1698" href="Interpreter.html#1684" class="Bound">mx</a> <a id="1701" class="Symbol">(λ</a> <a id="1704" href="Interpreter.html#1704" class="Bound">x</a> <a id="1706" class="Symbol">→</a> <a id="1708" href="Interpreter.html#1360" class="Function">returnExec</a> <a id="1719" class="Symbol">(</a><a id="1720" href="Interpreter.html#1682" class="Bound">f</a> <a id="1722" href="Interpreter.html#1704" class="Bound">x</a><a id="1723" class="Symbol">))</a>

    <a id="ExecStm.applicativeExec"></a><a id="1731" href="Interpreter.html#1731" class="Function">applicativeExec</a> <a id="1747" class="Symbol">:</a> <a id="1749" class="Symbol">∀</a> <a id="1751" class="Symbol">{</a><a id="1752" href="Interpreter.html#1752" class="Bound">i</a><a id="1753" class="Symbol">}</a> <a id="1755" class="Symbol">→</a> <a id="1757" href="Library.Monad.html#729" class="Function">Applicative</a> <a id="1769" class="Symbol">(</a><a id="1770" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1775" href="Interpreter.html#1752" class="Bound">i</a><a id="1776" class="Symbol">)</a>
    <a id="1782" href="Library.Monad.html#487" class="Field">pure</a>  <a id="1788" class="Symbol">{{</a><a id="1790" href="Interpreter.html#1731" class="Function">applicativeExec</a><a id="1805" class="Symbol">}}</a>       <a id="1814" class="Symbol">=</a> <a id="1816" href="Interpreter.html#1360" class="Function">returnExec</a>
    <a id="1831" href="Library.Monad.html#521" class="Field Operator">_&lt;*&gt;_</a> <a id="1837" class="Symbol">{{</a><a id="1839" href="Interpreter.html#1731" class="Function">applicativeExec</a><a id="1854" class="Symbol">}}</a> <a id="1857" href="Interpreter.html#1857" class="Bound">mf</a> <a id="1860" href="Interpreter.html#1860" class="Bound">mx</a> <a id="1863" class="Symbol">=</a> <a id="1865" href="Interpreter.html#1449" class="Function">bindExec</a> <a id="1874" href="Interpreter.html#1857" class="Bound">mf</a> <a id="1877" class="Symbol">(</a><a id="1878" href="Library.Monad.html#284" class="Function Operator">_&lt;$&gt;</a> <a id="1883" href="Interpreter.html#1860" class="Bound">mx</a><a id="1885" class="Symbol">)</a>

    <a id="ExecStm.monadExec"></a><a id="1892" href="Interpreter.html#1892" class="Function">monadExec</a> <a id="1902" class="Symbol">:</a> <a id="1904" class="Symbol">∀</a> <a id="1906" class="Symbol">{</a><a id="1907" href="Interpreter.html#1907" class="Bound">i</a><a id="1908" class="Symbol">}</a> <a id="1910" class="Symbol">→</a> <a id="1912" href="Library.Monad.html#1395" class="Function">Monad</a> <a id="1918" class="Symbol">(</a><a id="1919" href="Interpreter.html#1215" class="Record">Exec</a> <a id="1924" href="Interpreter.html#1907" class="Bound">i</a><a id="1925" class="Symbol">)</a>
    <a id="1931" href="Library.Monad.html#1002" class="Field Operator">_&gt;&gt;=_</a> <a id="1937" class="Symbol">{{</a><a id="1939" href="Interpreter.html#1892" class="Function">monadExec</a><a id="1948" class="Symbol">}}</a> <a id="1951" class="Symbol">=</a> <a id="1953" href="Interpreter.html#1449" class="Function">bindExec</a>

  <a id="1965" class="Comment">-- Updating the environment.</a>

  <a id="ExecStm.modify"></a><a id="1997" href="Interpreter.html#1997" class="Function">modify</a> <a id="2004" class="Symbol">:</a> <a id="2006" class="Symbol">∀{</a><a id="2008" href="Interpreter.html#2008" class="Bound">i</a><a id="2009" class="Symbol">}</a> <a id="2011" class="Symbol">(</a><a id="2012" href="Interpreter.html#2012" class="Bound">f</a> <a id="2014" class="Symbol">:</a> <a id="2016" href="Value.html#382" class="Function">Env</a> <a id="2020" href="Interpreter.html#1190" class="Bound">Γ</a> <a id="2022" class="Symbol">→</a> <a id="2024" href="Value.html#382" class="Function">Env</a> <a id="2028" href="Interpreter.html#1190" class="Bound">Γ</a><a id="2029" class="Symbol">)</a> <a id="2031" class="Symbol">→</a> <a id="2033" href="Interpreter.html#1215" class="Record">Exec</a> <a id="2038" href="Interpreter.html#2008" class="Bound">i</a> <a id="2040" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
  <a id="2044" href="Interpreter.html#1997" class="Function">modify</a> <a id="2051" href="Interpreter.html#2051" class="Bound">f</a> <a id="2053" class="Symbol">.</a><a id="2054" href="Interpreter.html#1269" class="Field">runExec</a> <a id="2062" href="Interpreter.html#2062" class="Bound">ρ</a> <a id="2064" class="Symbol">=</a> <a id="2066" href="Library.Monad.html#1110" class="Function">return</a> <a id="2073" class="Symbol">(_</a> <a id="2076" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">,</a> <a id="2078" href="Interpreter.html#2051" class="Bound">f</a> <a id="2080" href="Interpreter.html#2062" class="Bound">ρ</a><a id="2081" class="Symbol">)</a>

  <a id="2086" class="Comment">-- Evaluate an expression.</a>

  <a id="ExecStm.evalExp"></a><a id="2116" href="Interpreter.html#2116" class="Function">evalExp</a> <a id="2124" class="Symbol">:</a> <a id="2126" class="Symbol">∀{</a><a id="2128" href="Interpreter.html#2128" class="Bound">i</a> <a id="2130" href="Interpreter.html#2130" class="Bound">t</a><a id="2131" class="Symbol">}</a> <a id="2133" class="Symbol">(</a><a id="2134" href="Interpreter.html#2134" class="Bound">e</a> <a id="2136" class="Symbol">:</a> <a id="2138" href="WellTypedSyntax.html#499" class="Datatype">Exp</a> <a id="2142" href="Interpreter.html#1190" class="Bound">Γ</a> <a id="2144" href="Interpreter.html#2130" class="Bound">t</a><a id="2145" class="Symbol">)</a> <a id="2147" class="Symbol">→</a> <a id="2149" href="Interpreter.html#1215" class="Record">Exec</a> <a id="2154" href="Interpreter.html#2128" class="Bound">i</a><a id="2155" class="Symbol">(</a><a id="2156" href="Value.html#144" class="Function">Val</a> <a id="2160" href="Interpreter.html#2130" class="Bound">t</a><a id="2161" class="Symbol">)</a>
  <a id="2165" href="Interpreter.html#2116" class="Function">evalExp</a> <a id="2173" href="Interpreter.html#2173" class="Bound">e</a> <a id="2175" class="Symbol">.</a><a id="2176" href="Interpreter.html#1269" class="Field">runExec</a> <a id="2184" href="Interpreter.html#2184" class="Bound">ρ</a> <a id="2186" class="Symbol">=</a> <a id="2188" href="Library.Monad.html#1110" class="Function">return</a> <a id="2195" class="Symbol">(</a><a id="2196" href="Interpreter.html#397" class="Function">M.eval</a> <a id="2203" href="Interpreter.html#2173" class="Bound">e</a> <a id="2205" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">,</a> <a id="2207" href="Interpreter.html#2184" class="Bound">ρ</a><a id="2208" class="Symbol">)</a>
    <a id="2214" class="Keyword">where</a> <a id="2220" class="Keyword">module</a> <a id="M"></a><a id="2227" href="Interpreter.html#2227" class="Module">M</a> <a id="2229" class="Symbol">=</a> <a id="2231" href="Interpreter.html#364" class="Module">EvalExp</a> <a id="2239" href="Interpreter.html#2184" class="Bound">ρ</a>

  <a id="2244" class="Keyword">mutual</a>

    <a id="2256" class="Comment">-- Executing a single statement.</a>

    <a id="ExecStm.execStm"></a><a id="2294" href="Interpreter.html#2294" class="Function">execStm</a> <a id="2302" class="Symbol">:</a> <a id="2304" class="Symbol">∀{</a><a id="2306" href="Interpreter.html#2306" class="Bound">i</a><a id="2307" class="Symbol">}</a> <a id="2309" class="Symbol">(</a><a id="2310" href="Interpreter.html#2310" class="Bound">s</a> <a id="2312" class="Symbol">:</a> <a id="2314" href="WellTypedSyntax.html#1126" class="Datatype">Stm</a> <a id="2318" href="Interpreter.html#1190" class="Bound">Γ</a><a id="2319" class="Symbol">)</a> <a id="2321" class="Symbol">→</a> <a id="2323" href="Interpreter.html#1215" class="Record">Exec</a> <a id="2328" href="Interpreter.html#2306" class="Bound">i</a> <a id="2330" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>

    <a id="2337" href="Interpreter.html#2294" class="Function">execStm</a> <a id="2345" class="Symbol">(</a><a id="2346" href="WellTypedSyntax.html#1156" class="InductiveConstructor">sAss</a> <a id="2351" href="Interpreter.html#2351" class="Bound">x</a> <a id="2353" href="Interpreter.html#2353" class="Bound">e</a><a id="2354" class="Symbol">)</a> <a id="2356" class="Symbol">=</a> <a id="2358" class="Keyword">do</a>
      <a id="2367" href="Interpreter.html#2367" class="Bound">v</a> <a id="2369" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2371" href="Interpreter.html#2116" class="Function">evalExp</a> <a id="2379" href="Interpreter.html#2353" class="Bound">e</a>
      <a id="2387" href="Interpreter.html#1997" class="Function">modify</a> <a id="2394" href="Function.html#1891" class="Function Operator">$</a> <a id="2396" href="Library.List.html#600" class="Function">All.updateWith</a> <a id="2411" href="Interpreter.html#2351" class="Bound">x</a> <a id="2413" class="Symbol">(λ</a> <a id="2416" href="Interpreter.html#2416" class="Bound">_</a> <a id="2418" class="Symbol">→</a> <a id="2420" href="Interpreter.html#2367" class="Bound">v</a><a id="2421" class="Symbol">)</a>

    <a id="2428" href="Interpreter.html#2294" class="Function">execStm</a> <a id="2436" class="Symbol">(</a><a id="2437" href="WellTypedSyntax.html#1294" class="InductiveConstructor">sIfElse</a> <a id="2445" href="Interpreter.html#2445" class="Bound">e</a> <a id="2447" href="Interpreter.html#2447" class="Bound">ss</a> <a id="2450" href="Interpreter.html#2450" class="Bound">ss&#39;</a><a id="2453" class="Symbol">)</a> <a id="2455" class="Symbol">=</a> <a id="2457" class="Keyword">do</a>
      <a id="2466" href="Interpreter.html#2466" class="Bound">b</a> <a id="2468" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2470" href="Interpreter.html#2116" class="Function">evalExp</a> <a id="2478" href="Interpreter.html#2445" class="Bound">e</a>
      <a id="2486" href="Function.html#3497" class="Function Operator">case</a> <a id="2491" href="Interpreter.html#2466" class="Bound">b</a> <a id="2493" href="Function.html#3497" class="Function Operator">of</a> <a id="2496" class="Symbol">λ</a> <a id="2498" class="Keyword">where</a>
        <a id="2512" href="AST.html#493" class="InductiveConstructor">true</a>  <a id="2518" class="Symbol">→</a> <a id="2520" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2529" href="Interpreter.html#2447" class="Bound">ss</a>
        <a id="2540" href="AST.html#498" class="InductiveConstructor">false</a> <a id="2546" class="Symbol">→</a> <a id="2548" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2557" href="Interpreter.html#2450" class="Bound">ss&#39;</a>

    <a id="2566" href="Interpreter.html#2294" class="Function">execStm</a> <a id="2574" class="Symbol">(</a><a id="2575" href="WellTypedSyntax.html#1225" class="InductiveConstructor">sWhile</a> <a id="2582" href="Interpreter.html#2582" class="Bound">e</a> <a id="2584" href="Interpreter.html#2584" class="Bound">ss</a><a id="2586" class="Symbol">)</a> <a id="2588" class="Symbol">=</a> <a id="2590" class="Keyword">do</a>
      <a id="2599" href="AST.html#493" class="InductiveConstructor">true</a> <a id="2604" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="2606" href="Interpreter.html#2116" class="Function">evalExp</a> <a id="2614" href="Interpreter.html#2582" class="Bound">e</a> <a id="2616" class="Keyword">where</a>
        <a id="2630" href="AST.html#498" class="InductiveConstructor">false</a> <a id="2636" class="Symbol">→</a> <a id="2638" href="Library.Monad.html#1110" class="Function">return</a> <a id="2645" class="Symbol">_</a>
      <a id="2653" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2662" href="Interpreter.html#2584" class="Bound">ss</a>
      <a id="2671" class="Comment">-- The recursive call needs to be guarded:</a>
      <a id="2720" class="Symbol">λ{</a> <a id="2723" class="Symbol">.</a><a id="2724" href="Interpreter.html#1269" class="Field">runExec</a> <a id="2732" href="Interpreter.html#2732" class="Bound">γ</a> <a id="2734" class="Symbol">.</a><a id="2735" href="Delay.html#314" class="Field">force</a> <a id="2741" class="Symbol">→</a> <a id="2743" href="Delay.html#438" class="InductiveConstructor">later&#39;</a> <a id="2750" href="Function.html#1891" class="Function Operator">$</a> <a id="2752" href="Interpreter.html#2294" class="Function">execStm</a> <a id="2760" class="Symbol">(</a><a id="2761" href="WellTypedSyntax.html#1225" class="InductiveConstructor">sWhile</a> <a id="2768" href="Interpreter.html#2582" class="Bound">e</a> <a id="2770" href="Interpreter.html#2584" class="Bound">ss</a><a id="2772" class="Symbol">)</a> <a id="2774" class="Symbol">.</a><a id="2775" href="Interpreter.html#1269" class="Field">runExec</a> <a id="2783" href="Interpreter.html#2732" class="Bound">γ</a> <a id="2785" class="Symbol">}</a>

    <a id="2792" class="Comment">-- Executing a list of statments.</a>

    <a id="ExecStm.execStms"></a><a id="2831" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2840" class="Symbol">:</a> <a id="2842" class="Symbol">∀{</a><a id="2844" href="Interpreter.html#2844" class="Bound">i</a><a id="2845" class="Symbol">}</a> <a id="2847" class="Symbol">(</a><a id="2848" href="Interpreter.html#2848" class="Bound">ss</a> <a id="2851" class="Symbol">:</a> <a id="2853" href="WellTypedSyntax.html#1362" class="Function">Stms</a> <a id="2858" href="Interpreter.html#1190" class="Bound">Γ</a><a id="2859" class="Symbol">)</a> <a id="2861" class="Symbol">→</a> <a id="2863" href="Interpreter.html#1215" class="Record">Exec</a> <a id="2868" href="Interpreter.html#2844" class="Bound">i</a> <a id="2870" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
    <a id="2876" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2885" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a>       <a id="2894" class="Symbol">=</a> <a id="2896" href="Library.Monad.html#1110" class="Function">return</a> <a id="2903" class="Symbol">_</a>
    <a id="2909" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2918" class="Symbol">(</a><a id="2919" href="Interpreter.html#2919" class="Bound">s</a> <a id="2921" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="2923" href="Interpreter.html#2923" class="Bound">ss</a><a id="2925" class="Symbol">)</a> <a id="2927" class="Symbol">=</a> <a id="2929" class="Keyword">do</a>
      <a id="2938" href="Interpreter.html#2294" class="Function">execStm</a>  <a id="2947" href="Interpreter.html#2919" class="Bound">s</a>
      <a id="2955" href="Interpreter.html#2831" class="Function">execStms</a> <a id="2964" href="Interpreter.html#2923" class="Bound">ss</a>

<a id="2968" class="Comment">-- Execution of the program (main loop).</a>

<a id="execPrg"></a><a id="3010" href="Interpreter.html#3010" class="Function">execPrg</a> <a id="3018" class="Symbol">:</a> <a id="3020" class="Symbol">∀{</a><a id="3022" href="Interpreter.html#3022" class="Bound">i</a><a id="3023" class="Symbol">}</a> <a id="3025" class="Symbol">(</a><a id="3026" href="Interpreter.html#3026" class="Bound">prg</a> <a id="3030" class="Symbol">:</a> <a id="3032" href="WellTypedSyntax.html#1473" class="Record">Program</a><a id="3039" class="Symbol">)</a> <a id="3041" class="Symbol">→</a> <a id="3043" href="Delay.html#221" class="Record">Delay</a> <a id="3049" href="Interpreter.html#3022" class="Bound">i</a> <a id="3051" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
<a id="3053" href="Interpreter.html#3010" class="Function">execPrg</a> <a id="3061" class="Symbol">(</a><a id="3062" href="WellTypedSyntax.html#1507" class="InductiveConstructor">program</a> <a id="3070" href="Interpreter.html#3070" class="Bound">ds</a> <a id="3073" href="Interpreter.html#3073" class="Bound">ss</a> <a id="3076" href="Interpreter.html#3076" class="Bound">e</a><a id="3077" class="Symbol">)</a> <a id="3079" class="Symbol">=</a> <a id="3081" class="Keyword">do</a>

  <a id="3087" class="Comment">-- Execute the declarations to get the initial environment ρ₀.</a>
  <a id="3152" class="Keyword">let</a> <a id="3156" href="Interpreter.html#3156" class="Bound">ρ₀</a> <a id="3159" class="Symbol">=</a> <a id="3161" href="Interpreter.html#915" class="Function">execDecls</a> <a id="3171" href="Interpreter.html#3070" class="Bound">ds</a> <a id="3174" href="Data.List.All.html#904" class="InductiveConstructor">[]</a>

  <a id="3180" class="Comment">-- Execute the statements (may not terminate).</a>
  <a id="3229" class="Symbol">(_</a> <a id="3232" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">,</a> <a id="3234" href="Interpreter.html#3234" class="Bound">ρ</a><a id="3235" class="Symbol">)</a> <a id="3237" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="3239" href="Interpreter.html#2831" class="Function">ExecStm.execStms</a> <a id="3256" href="Interpreter.html#3073" class="Bound">ss</a> <a id="3259" class="Symbol">.</a><a id="3260" href="Interpreter.html#1269" class="Field">ExecStm.runExec</a> <a id="3276" href="Interpreter.html#3156" class="Bound">ρ₀</a>

  <a id="3282" class="Comment">-- Evaluate the main expression to yield result.</a>
  <a id="3333" href="Library.Monad.html#1110" class="Function">return</a> <a id="3340" href="Function.html#1891" class="Function Operator">$</a> <a id="3342" href="Interpreter.html#397" class="Function">EvalExp.eval</a> <a id="3355" href="Interpreter.html#3234" class="Bound">ρ</a> <a id="3357" href="Interpreter.html#3076" class="Bound">e</a>

<a id="3360" class="Comment">-- The result of a program is an integer.</a>

<a id="runProgram"></a><a id="3403" href="Interpreter.html#3403" class="Function">runProgram</a> <a id="3414" class="Symbol">:</a> <a id="3416" class="Symbol">(</a><a id="3417" href="Interpreter.html#3417" class="Bound">prg</a> <a id="3421" class="Symbol">:</a> <a id="3423" href="WellTypedSyntax.html#1473" class="Record">Program</a><a id="3430" class="Symbol">)</a> <a id="3432" class="Symbol">→</a> <a id="3434" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
<a id="3436" href="Interpreter.html#3403" class="Function">runProgram</a> <a id="3447" href="Interpreter.html#3447" class="Bound">prg</a> <a id="3451" class="Symbol">=</a> <a id="3453" href="Delay.html#1398" class="Function">runDelay</a> <a id="3462" class="Symbol">(</a><a id="3463" href="Interpreter.html#3010" class="Function">execPrg</a> <a id="3471" href="Interpreter.html#3447" class="Bound">prg</a><a id="3474" class="Symbol">)</a>

<a id="3477" class="Comment">-- -}</a>
</pre></body></html>