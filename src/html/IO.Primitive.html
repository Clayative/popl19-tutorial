<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>IO.Primitive</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Primitive IO: simple bindings to Haskell types and functions</a>
<a id="170" class="Comment">------------------------------------------------------------------------</a>

<a id="244" class="Keyword">module</a> <a id="251" href="IO.Primitive.html" class="Module">IO.Primitive</a> <a id="264" class="Keyword">where</a>

<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Codata.Musical.Costring.html" class="Module">Codata.Musical.Costring</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Char.Base.html" class="Module">Data.Char.Base</a>
<a id="334" class="Keyword">open</a> <a id="339" class="Keyword">import</a> <a id="346" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="363" class="Keyword">open</a> <a id="368" class="Keyword">import</a> <a id="375" href="Foreign.Haskell.html" class="Module">Foreign.Haskell</a>

<a id="392" class="Comment">------------------------------------------------------------------------</a>
<a id="465" class="Comment">-- The IO monad</a>

<a id="482" class="Keyword">open</a> <a id="487" class="Keyword">import</a> <a id="494" href="Agda.Builtin.IO.html" class="Module">Agda.Builtin.IO</a> <a id="510" class="Keyword">public</a> <a id="517" class="Keyword">using</a> <a id="523" class="Symbol">(</a><a id="524" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a><a id="526" class="Symbol">)</a>

<a id="529" class="Keyword">infixl</a> <a id="536" class="Number">1</a> <a id="538" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>

<a id="545" class="Keyword">postulate</a>
  <a id="return"></a><a id="557" href="IO.Primitive.html#557" class="Postulate">return</a> <a id="564" class="Symbol">:</a> <a id="566" class="Symbol">∀</a> <a id="568" class="Symbol">{</a><a id="569" href="IO.Primitive.html#569" class="Bound">a</a><a id="570" class="Symbol">}</a> <a id="572" class="Symbol">{</a><a id="573" href="IO.Primitive.html#573" class="Bound">A</a> <a id="575" class="Symbol">:</a> <a id="577" class="PrimitiveType">Set</a> <a id="581" href="IO.Primitive.html#569" class="Bound">a</a><a id="582" class="Symbol">}</a> <a id="584" class="Symbol">→</a> <a id="586" href="IO.Primitive.html#573" class="Bound">A</a> <a id="588" class="Symbol">→</a> <a id="590" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="593" href="IO.Primitive.html#573" class="Bound">A</a>
  <a id="_&gt;&gt;=_"></a><a id="597" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="604" class="Symbol">:</a> <a id="606" class="Symbol">∀</a> <a id="608" class="Symbol">{</a><a id="609" href="IO.Primitive.html#609" class="Bound">a</a> <a id="611" href="IO.Primitive.html#611" class="Bound">b</a><a id="612" class="Symbol">}</a> <a id="614" class="Symbol">{</a><a id="615" href="IO.Primitive.html#615" class="Bound">A</a> <a id="617" class="Symbol">:</a> <a id="619" class="PrimitiveType">Set</a> <a id="623" href="IO.Primitive.html#609" class="Bound">a</a><a id="624" class="Symbol">}</a> <a id="626" class="Symbol">{</a><a id="627" href="IO.Primitive.html#627" class="Bound">B</a> <a id="629" class="Symbol">:</a> <a id="631" class="PrimitiveType">Set</a> <a id="635" href="IO.Primitive.html#611" class="Bound">b</a><a id="636" class="Symbol">}</a> <a id="638" class="Symbol">→</a> <a id="640" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="643" href="IO.Primitive.html#615" class="Bound">A</a> <a id="645" class="Symbol">→</a> <a id="647" class="Symbol">(</a><a id="648" href="IO.Primitive.html#615" class="Bound">A</a> <a id="650" class="Symbol">→</a> <a id="652" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="655" href="IO.Primitive.html#627" class="Bound">B</a><a id="656" class="Symbol">)</a> <a id="658" class="Symbol">→</a> <a id="660" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="663" href="IO.Primitive.html#627" class="Bound">B</a>

<a id="666" class="Symbol">{-#</a> <a id="670" class="Keyword">COMPILE</a> <a id="678" class="Pragma">GHC</a> <a id="682" href="IO.Primitive.html#557" class="Postulate">return</a> <a id="689" class="Pragma">=</a> <a id="691" class="Pragma">\_</a> <a id="694" class="Pragma">_</a> <a id="696" class="Pragma">-&gt;</a> <a id="699" class="Pragma">return</a>    <a id="709" class="Symbol">#-}</a>
<a id="713" class="Symbol">{-#</a> <a id="717" class="Keyword">COMPILE</a> <a id="725" class="Pragma">GHC</a> <a id="729" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="736" class="Pragma">=</a> <a id="738" class="Pragma">\_</a> <a id="741" class="Pragma">_</a> <a id="743" class="Pragma">_</a> <a id="745" class="Pragma">_</a> <a id="747" class="Pragma">-&gt;</a> <a id="750" class="Pragma">(&gt;&gt;=)</a> <a id="756" class="Symbol">#-}</a>
<a id="760" class="Symbol">{-#</a> <a id="764" class="Keyword">COMPILE</a> <a id="772" class="Pragma">UHC</a> <a id="776" href="IO.Primitive.html#557" class="Postulate">return</a> <a id="783" class="Pragma">=</a> <a id="785" class="Pragma">\_</a> <a id="788" class="Pragma">_</a> <a id="790" class="Pragma">x</a> <a id="792" class="Pragma">-&gt;</a> <a id="795" class="Pragma">UHC.Agda.Builtins.primReturn</a> <a id="824" class="Pragma">x</a> <a id="826" class="Symbol">#-}</a>
<a id="830" class="Symbol">{-#</a> <a id="834" class="Keyword">COMPILE</a> <a id="842" class="Pragma">UHC</a> <a id="846" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="853" class="Pragma">=</a> <a id="855" class="Pragma">\_</a> <a id="858" class="Pragma">_</a> <a id="860" class="Pragma">_</a> <a id="862" class="Pragma">_</a> <a id="864" class="Pragma">x</a> <a id="866" class="Pragma">y</a> <a id="868" class="Pragma">-&gt;</a> <a id="871" class="Pragma">UHC.Agda.Builtins.primBind</a> <a id="898" class="Pragma">x</a> <a id="900" class="Pragma">y</a> <a id="902" class="Symbol">#-}</a>

<a id="907" class="Comment">------------------------------------------------------------------------</a>
<a id="980" class="Comment">-- Simple lazy IO</a>

<a id="999" class="Comment">-- Note that the functions below produce commands which, when</a>
<a id="1061" class="Comment">-- executed, may raise exceptions.</a>

<a id="1097" class="Comment">-- Note also that the semantics of these functions depends on the</a>
<a id="1163" class="Comment">-- version of the Haskell base library. If the version is 4.2.0.0 (or</a>
<a id="1233" class="Comment">-- later?), then the functions use the character encoding specified by</a>
<a id="1304" class="Comment">-- the locale. For older versions of the library (going back to at</a>
<a id="1371" class="Comment">-- least version 3) the functions use ISO-8859-1.</a>

<a id="1422" class="Symbol">{-#</a> <a id="1426" class="Keyword">FOREIGN</a> <a id="1434" class="Pragma">GHC</a> <a id="1438" class="Pragma">import</a> <a id="1445" class="Pragma">qualified</a> <a id="1455" class="Pragma">Data.Text</a>    <a id="1468" class="Symbol">#-}</a>
<a id="1472" class="Symbol">{-#</a> <a id="1476" class="Keyword">FOREIGN</a> <a id="1484" class="Pragma">GHC</a> <a id="1488" class="Pragma">import</a> <a id="1495" class="Pragma">qualified</a> <a id="1505" class="Pragma">Data.Text.IO</a> <a id="1518" class="Symbol">#-}</a>
<a id="1522" class="Symbol">{-#</a> <a id="1526" class="Keyword">FOREIGN</a> <a id="1534" class="Pragma">GHC</a> <a id="1538" class="Pragma">import</a> <a id="1545" class="Pragma">qualified</a> <a id="1555" class="Pragma">System.IO</a>    <a id="1568" class="Symbol">#-}</a>
<a id="1572" class="Symbol">{-#</a> <a id="1576" class="Keyword">FOREIGN</a> <a id="1584" class="Pragma">GHC</a> <a id="1588" class="Pragma">import</a> <a id="1595" class="Pragma">qualified</a> <a id="1605" class="Pragma">Control.Exception</a> <a id="1623" class="Symbol">#-}</a>

<a id="1628" class="Keyword">postulate</a>
  <a id="getContents"></a><a id="1640" href="IO.Primitive.html#1640" class="Postulate">getContents</a> <a id="1652" class="Symbol">:</a> <a id="1654" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1657" href="Codata.Musical.Costring.html#439" class="Function">Costring</a>
  <a id="readFile"></a><a id="1668" href="IO.Primitive.html#1668" class="Postulate">readFile</a>    <a id="1680" class="Symbol">:</a> <a id="1682" href="Agda.Builtin.String.html#174" class="Postulate">String</a> <a id="1689" class="Symbol">→</a> <a id="1691" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1694" href="Codata.Musical.Costring.html#439" class="Function">Costring</a>
  <a id="writeFile"></a><a id="1705" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>   <a id="1717" class="Symbol">:</a> <a id="1719" href="Agda.Builtin.String.html#174" class="Postulate">String</a> <a id="1726" class="Symbol">→</a> <a id="1728" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1737" class="Symbol">→</a> <a id="1739" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1742" href="Foreign.Haskell.html#314" class="Datatype">Unit</a>
  <a id="appendFile"></a><a id="1749" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>  <a id="1761" class="Symbol">:</a> <a id="1763" href="Agda.Builtin.String.html#174" class="Postulate">String</a> <a id="1770" class="Symbol">→</a> <a id="1772" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1781" class="Symbol">→</a> <a id="1783" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1786" href="Foreign.Haskell.html#314" class="Datatype">Unit</a>
  <a id="putStr"></a><a id="1793" href="IO.Primitive.html#1793" class="Postulate">putStr</a>      <a id="1805" class="Symbol">:</a> <a id="1807" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1816" class="Symbol">→</a> <a id="1818" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1821" href="Foreign.Haskell.html#314" class="Datatype">Unit</a>
  <a id="putStrLn"></a><a id="1828" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>    <a id="1840" class="Symbol">:</a> <a id="1842" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1851" class="Symbol">→</a> <a id="1853" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1856" href="Foreign.Haskell.html#314" class="Datatype">Unit</a>

  <a id="1864" class="Comment">-- Reads a finite file. Raises an exception if the file path refers</a>
  <a id="1934" class="Comment">-- to a non-physical file (like &quot;/dev/zero&quot;).</a>

  <a id="readFiniteFile"></a><a id="1983" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> <a id="1998" class="Symbol">:</a> <a id="2000" href="Agda.Builtin.String.html#174" class="Postulate">String</a> <a id="2007" class="Symbol">→</a> <a id="2009" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="2012" href="Agda.Builtin.String.html#174" class="Postulate">String</a>

<a id="2020" class="Symbol">{-#</a> <a id="2024" class="Keyword">FOREIGN</a> <a id="2032" class="Pragma">GHC</a>
  <a id="2038" class="Pragma">readFiniteFile</a> <a id="2053" class="Pragma">::</a> <a id="2056" class="Pragma">Data.Text.Text</a> <a id="2071" class="Pragma">-&gt;</a> <a id="2074" class="Pragma">IO</a> <a id="2077" class="Pragma">Data.Text.Text</a>
  <a id="2094" class="Pragma">readFiniteFile</a> <a id="2109" class="Pragma">f</a> <a id="2111" class="Pragma">=</a> <a id="2113" class="Pragma">do</a>
    <a id="2120" class="Pragma">h</a> <a id="2122" class="Pragma">&lt;-</a> <a id="2125" class="Pragma">System.IO.openFile</a> <a id="2144" class="Pragma">(Data.Text.unpack</a> <a id="2162" class="Pragma">f)</a> <a id="2165" class="Pragma">System.IO.ReadMode</a>
    <a id="2188" class="Pragma">Control.Exception.bracketOnError</a> <a id="2221" class="Pragma">(return</a> <a id="2229" class="Pragma">())</a> <a id="2233" class="Pragma">(\_</a> <a id="2237" class="Pragma">-&gt;</a> <a id="2240" class="Pragma">System.IO.hClose</a> <a id="2257" class="Pragma">h)</a>
                                                 <a id="2309" class="Pragma">(\_</a> <a id="2313" class="Pragma">-&gt;</a> <a id="2316" class="Pragma">System.IO.hFileSize</a> <a id="2336" class="Pragma">h)</a>
    <a id="2343" class="Pragma">Data.Text.IO.hGetContents</a> <a id="2369" class="Pragma">h</a>

  <a id="2374" class="Pragma">fromColist</a> <a id="2385" class="Pragma">::</a> <a id="2388" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.AgdaColist</a> <a id="2434" class="Pragma">a</a> <a id="2436" class="Pragma">-&gt;</a> <a id="2439" class="Pragma">[a]</a>
  <a id="2445" class="Pragma">fromColist</a> <a id="2456" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Nil</a>         <a id="2503" class="Pragma">=</a> <a id="2505" class="Pragma">[]</a>
  <a id="2510" class="Pragma">fromColist</a> <a id="2521" class="Pragma">(MAlonzo.Code.Codata.Musical.Colist.Cons</a> <a id="2562" class="Pragma">x</a> <a id="2564" class="Pragma">xs)</a> <a id="2568" class="Pragma">=</a>
    <a id="2574" class="Pragma">x</a> <a id="2576" class="Pragma">:</a> <a id="2578" class="Pragma">fromColist</a> <a id="2589" class="Pragma">(MAlonzo.RTE.flat</a> <a id="2607" class="Pragma">xs)</a>

  <a id="2614" class="Pragma">toColist</a> <a id="2623" class="Pragma">::</a> <a id="2626" class="Pragma">[a]</a> <a id="2630" class="Pragma">-&gt;</a> <a id="2633" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.AgdaColist</a> <a id="2679" class="Pragma">a</a>
  <a id="2683" class="Pragma">toColist</a> <a id="2692" class="Pragma">[]</a>       <a id="2701" class="Pragma">=</a> <a id="2703" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Nil</a>
  <a id="2744" class="Pragma">toColist</a> <a id="2753" class="Pragma">(x</a> <a id="2756" class="Pragma">:</a> <a id="2758" class="Pragma">xs)</a> <a id="2762" class="Pragma">=</a>
    <a id="2768" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Cons</a> <a id="2808" class="Pragma">x</a> <a id="2810" class="Pragma">(MAlonzo.RTE.Sharp</a> <a id="2829" class="Pragma">(toColist</a> <a id="2839" class="Pragma">xs))</a>
<a id="2844" class="Symbol">#-}</a>

<a id="2849" class="Symbol">{-#</a> <a id="2853" class="Keyword">COMPILE</a> <a id="2861" class="Pragma">GHC</a> <a id="2865" href="IO.Primitive.html#1640" class="Postulate">getContents</a>    <a id="2880" class="Pragma">=</a> <a id="2882" class="Pragma">fmap</a> <a id="2887" class="Pragma">toColist</a> <a id="2896" class="Pragma">getContents</a>                          <a id="2933" class="Symbol">#-}</a>
<a id="2937" class="Symbol">{-#</a> <a id="2941" class="Keyword">COMPILE</a> <a id="2949" class="Pragma">GHC</a> <a id="2953" href="IO.Primitive.html#1668" class="Postulate">readFile</a>       <a id="2968" class="Pragma">=</a> <a id="2970" class="Pragma">fmap</a> <a id="2975" class="Pragma">toColist</a> <a id="2984" class="Pragma">.</a> <a id="2986" class="Pragma">readFile</a> <a id="2995" class="Pragma">.</a> <a id="2997" class="Pragma">Data.Text.unpack</a>        <a id="3021" class="Symbol">#-}</a>
<a id="3025" class="Symbol">{-#</a> <a id="3029" class="Keyword">COMPILE</a> <a id="3037" class="Pragma">GHC</a> <a id="3041" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>      <a id="3056" class="Pragma">=</a> <a id="3058" class="Pragma">\x</a> <a id="3061" class="Pragma">-&gt;</a> <a id="3064" class="Pragma">writeFile</a> <a id="3074" class="Pragma">(Data.Text.unpack</a> <a id="3092" class="Pragma">x)</a> <a id="3095" class="Pragma">.</a> <a id="3097" class="Pragma">fromColist</a>  <a id="3109" class="Symbol">#-}</a>
<a id="3113" class="Symbol">{-#</a> <a id="3117" class="Keyword">COMPILE</a> <a id="3125" class="Pragma">GHC</a> <a id="3129" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>     <a id="3144" class="Pragma">=</a> <a id="3146" class="Pragma">\x</a> <a id="3149" class="Pragma">-&gt;</a> <a id="3152" class="Pragma">appendFile</a> <a id="3163" class="Pragma">(Data.Text.unpack</a> <a id="3181" class="Pragma">x)</a> <a id="3184" class="Pragma">.</a> <a id="3186" class="Pragma">fromColist</a> <a id="3197" class="Symbol">#-}</a>
<a id="3201" class="Symbol">{-#</a> <a id="3205" class="Keyword">COMPILE</a> <a id="3213" class="Pragma">GHC</a> <a id="3217" href="IO.Primitive.html#1793" class="Postulate">putStr</a>         <a id="3232" class="Pragma">=</a> <a id="3234" class="Pragma">putStr</a> <a id="3241" class="Pragma">.</a> <a id="3243" class="Pragma">fromColist</a>                                <a id="3285" class="Symbol">#-}</a>
<a id="3289" class="Symbol">{-#</a> <a id="3293" class="Keyword">COMPILE</a> <a id="3301" class="Pragma">GHC</a> <a id="3305" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>       <a id="3320" class="Pragma">=</a> <a id="3322" class="Pragma">putStrLn</a> <a id="3331" class="Pragma">.</a> <a id="3333" class="Pragma">fromColist</a>                              <a id="3373" class="Symbol">#-}</a>
<a id="3377" class="Symbol">{-#</a> <a id="3381" class="Keyword">COMPILE</a> <a id="3389" class="Pragma">GHC</a> <a id="3393" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> <a id="3408" class="Pragma">=</a> <a id="3410" class="Pragma">readFiniteFile</a>                        <a id="3448" class="Symbol">#-}</a>
<a id="3452" class="Symbol">{-#</a> <a id="3456" class="Keyword">COMPILE</a> <a id="3464" class="Pragma">UHC</a> <a id="3468" href="IO.Primitive.html#1640" class="Postulate">getContents</a>    <a id="3483" class="Pragma">=</a> <a id="3485" class="Pragma">UHC.Agda.Builtins.primGetContents</a>     <a id="3523" class="Symbol">#-}</a>
<a id="3527" class="Symbol">{-#</a> <a id="3531" class="Keyword">COMPILE</a> <a id="3539" class="Pragma">UHC</a> <a id="3543" href="IO.Primitive.html#1668" class="Postulate">readFile</a>       <a id="3558" class="Pragma">=</a> <a id="3560" class="Pragma">UHC.Agda.Builtins.primReadFile</a>        <a id="3598" class="Symbol">#-}</a>
<a id="3602" class="Symbol">{-#</a> <a id="3606" class="Keyword">COMPILE</a> <a id="3614" class="Pragma">UHC</a> <a id="3618" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>      <a id="3633" class="Pragma">=</a> <a id="3635" class="Pragma">UHC.Agda.Builtins.primWriteFile</a>       <a id="3673" class="Symbol">#-}</a>
<a id="3677" class="Symbol">{-#</a> <a id="3681" class="Keyword">COMPILE</a> <a id="3689" class="Pragma">UHC</a> <a id="3693" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>     <a id="3708" class="Pragma">=</a> <a id="3710" class="Pragma">UHC.Agda.Builtins.primAppendFile</a>      <a id="3748" class="Symbol">#-}</a>
<a id="3752" class="Symbol">{-#</a> <a id="3756" class="Keyword">COMPILE</a> <a id="3764" class="Pragma">UHC</a> <a id="3768" href="IO.Primitive.html#1793" class="Postulate">putStr</a>         <a id="3783" class="Pragma">=</a> <a id="3785" class="Pragma">UHC.Agda.Builtins.primPutStr</a>          <a id="3823" class="Symbol">#-}</a>
<a id="3827" class="Symbol">{-#</a> <a id="3831" class="Keyword">COMPILE</a> <a id="3839" class="Pragma">UHC</a> <a id="3843" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>       <a id="3858" class="Pragma">=</a> <a id="3860" class="Pragma">UHC.Agda.Builtins.primPutStrLn</a>        <a id="3898" class="Symbol">#-}</a>
<a id="3902" class="Symbol">{-#</a> <a id="3906" class="Keyword">COMPILE</a> <a id="3914" class="Pragma">UHC</a> <a id="3918" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> <a id="3933" class="Pragma">=</a> <a id="3935" class="Pragma">UHC.Agda.Builtins.primReadFiniteFile</a>  <a id="3973" class="Symbol">#-}</a>
</pre></body></html>