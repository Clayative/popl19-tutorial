<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>runwhile</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">-- Type checker and interpreter for WHILE language.</a>

<a id="54" class="Keyword">module</a> <a id="61" href="runwhile.html" class="Module">runwhile</a> <a id="70" class="Keyword">where</a>

<a id="77" class="Keyword">open</a> <a id="82" class="Keyword">import</a> <a id="89" href="Library.html" class="Module">Library</a>
<a id="97" class="Keyword">open</a> <a id="102" class="Keyword">import</a> <a id="109" href="WellTypedSyntax.html" class="Module">WellTypedSyntax</a> <a id="125" class="Keyword">using</a> <a id="131" class="Symbol">(</a><a id="132" href="WellTypedSyntax.html#1473" class="Record">Program</a><a id="139" class="Symbol">)</a>
<a id="141" class="Keyword">open</a> <a id="146" class="Keyword">import</a> <a id="153" href="TypeChecker.html" class="Module">TypeChecker</a>     <a id="169" class="Keyword">using</a> <a id="175" class="Symbol">(</a><a id="176" href="TypeChecker.html#6235" class="Function">checkProgram</a><a id="188" class="Symbol">)</a>

<a id="191" class="Keyword">import</a> <a id="198" href="AST.html" class="Module">AST</a> <a id="202" class="Symbol">as</a> <a id="205" class="Module">A</a>
<a id="207" class="Keyword">import</a> <a id="214" href="Parser.html" class="Module">Parser</a>
<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Interpreter.html" class="Module">Interpreter</a> <a id="245" class="Keyword">using</a> <a id="251" class="Symbol">(</a><a id="252" href="Interpreter.html#3403" class="Function">runProgram</a><a id="262" class="Symbol">)</a>

<a id="265" class="Comment">-- Other modules, not used here.</a>
<a id="298" class="Keyword">import</a> <a id="305" href="Value.html" class="Module">Value</a>

<a id="312" class="Comment">-- Parse.</a>

<a id="parse"></a><a id="323" href="runwhile.html#323" class="Function">parse</a> <a id="329" class="Symbol">:</a> <a id="331" href="Agda.Builtin.String.html#174" class="Postulate">String</a> <a id="338" class="Symbol">→</a> <a id="340" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="343" href="AST.html#1331" class="Record">A.Program</a>
<a id="353" href="runwhile.html#323" class="Function">parse</a> <a id="359" href="runwhile.html#359" class="Bound">contents</a> <a id="368" class="Symbol">=</a> <a id="370" class="Keyword">do</a>
  <a id="375" href="Function.html#3497" class="Function Operator">case</a> <a id="380" href="Parser.html#524" class="Postulate">Parser.parse</a> <a id="393" href="runwhile.html#359" class="Bound">contents</a> <a id="402" href="Function.html#3497" class="Function Operator">of</a> <a id="405" class="Symbol">λ</a> <a id="407" class="Keyword">where</a>
    <a id="417" class="Symbol">(</a><a id="418" href="Parser.html#437" class="InductiveConstructor">bad</a> <a id="422" href="runwhile.html#422" class="Bound">cs</a><a id="424" class="Symbol">)</a> <a id="426" class="Symbol">→</a> <a id="428" class="Keyword">do</a>
      <a id="437" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="446" class="String">&quot;SYNTAX ERROR&quot;</a>
      <a id="467" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="476" class="Symbol">(</a><a id="477" href="Data.String.Base.html#924" class="Function">String.fromList</a> <a id="493" href="runwhile.html#422" class="Bound">cs</a><a id="495" class="Symbol">)</a>
      <a id="503" href="Library.IO.html#509" class="Postulate">exitFailure</a>
    <a id="519" class="Symbol">(</a><a id="520" href="Parser.html#418" class="InductiveConstructor">ok</a> <a id="523" href="runwhile.html#523" class="Bound">prg</a><a id="526" class="Symbol">)</a> <a id="528" class="Symbol">→</a> <a id="530" href="Library.Monad.html#1110" class="Function">return</a> <a id="537" href="runwhile.html#523" class="Bound">prg</a>
  <a id="543" class="Keyword">where</a>
  <a id="551" class="Keyword">open</a> <a id="556" href="Parser.html" class="Module">Parser</a> <a id="563" class="Keyword">using</a> <a id="569" class="Symbol">(</a><a id="570" href="Parser.html#390" class="Datatype">Err</a><a id="573" class="Symbol">;</a> <a id="575" href="Parser.html#418" class="InductiveConstructor">ok</a><a id="577" class="Symbol">;</a> <a id="579" href="Parser.html#437" class="InductiveConstructor">bad</a><a id="582" class="Symbol">)</a>

<a id="585" class="Comment">-- Type check.</a>

<a id="check"></a><a id="601" href="runwhile.html#601" class="Function">check</a> <a id="607" class="Symbol">:</a> <a id="609" href="AST.html#1331" class="Record">A.Program</a> <a id="619" class="Symbol">→</a> <a id="621" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="624" href="WellTypedSyntax.html#1473" class="Record">Program</a>
<a id="632" href="runwhile.html#601" class="Function">check</a> <a id="638" href="runwhile.html#638" class="Bound">prg</a> <a id="642" class="Symbol">=</a> <a id="644" class="Keyword">do</a>
  <a id="649" href="Function.html#3497" class="Function Operator">case</a> <a id="654" href="TypeChecker.html#6235" class="Function">checkProgram</a> <a id="667" href="runwhile.html#638" class="Bound">prg</a> <a id="671" href="Function.html#3497" class="Function Operator">of</a> <a id="674" class="Symbol">λ</a> <a id="676" class="Keyword">where</a>
    <a id="686" class="Symbol">(</a><a id="687" href="Library.Error.html#238" class="InductiveConstructor">fail</a> <a id="692" href="runwhile.html#692" class="Bound">err</a><a id="695" class="Symbol">)</a> <a id="697" class="Symbol">→</a> <a id="699" class="Keyword">do</a>
      <a id="708" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="717" class="String">&quot;TYPE ERROR&quot;</a>
      <a id="736" href="Library.IO.html#588" class="Postulate">putStr</a>   <a id="745" class="Symbol">(</a><a id="746" href="Library.Print.html#244" class="Field">print</a> <a id="752" href="runwhile.html#638" class="Bound">prg</a><a id="755" class="Symbol">)</a>
      <a id="763" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="772" class="String">&quot;The type error is:&quot;</a>
      <a id="799" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="808" class="Symbol">(</a><a id="809" href="Library.Print.html#244" class="Field">print</a> <a id="815" href="runwhile.html#692" class="Bound">err</a><a id="818" class="Symbol">)</a>
      <a id="826" href="Library.IO.html#509" class="Postulate">exitFailure</a>
    <a id="842" class="Symbol">(</a><a id="843" href="Library.Error.html#268" class="InductiveConstructor">ok</a> <a id="846" href="runwhile.html#846" class="Bound">prg&#39;</a><a id="850" class="Symbol">)</a> <a id="852" class="Symbol">→</a> <a id="854" href="Library.Monad.html#1110" class="Function">return</a> <a id="861" href="runwhile.html#846" class="Bound">prg&#39;</a>
  <a id="868" class="Keyword">where</a>
  <a id="876" class="Keyword">open</a> <a id="881" href="Library.Error.html#134" class="Module">ErrorMonad</a> <a id="892" class="Keyword">using</a> <a id="898" class="Symbol">(</a><a id="899" href="Library.Error.html#238">fail</a><a id="903" class="Symbol">;</a> <a id="905" href="Library.Error.html#268">ok</a><a id="907" class="Symbol">)</a>

<a id="910" class="Comment">-- Interpret.</a>

<a id="run"></a><a id="925" href="runwhile.html#925" class="Function">run</a> <a id="929" class="Symbol">:</a> <a id="931" href="WellTypedSyntax.html#1473" class="Record">Program</a> <a id="939" class="Symbol">→</a> <a id="941" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="944" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
<a id="946" href="runwhile.html#925" class="Function">run</a> <a id="950" href="runwhile.html#950" class="Bound">prg&#39;</a> <a id="955" class="Symbol">=</a> <a id="957" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="966" class="Symbol">(</a><a id="967" href="Library.Print.html#244" class="Field">print</a> <a id="973" class="Symbol">(</a><a id="974" href="Interpreter.html#3403" class="Function">runProgram</a> <a id="985" href="runwhile.html#950" class="Bound">prg&#39;</a><a id="989" class="Symbol">))</a>

<a id="993" class="Comment">-- Display usage information and exit.</a>

<a id="usage"></a><a id="1033" href="runwhile.html#1033" class="Function">usage</a> <a id="1039" class="Symbol">:</a> <a id="1041" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1044" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
<a id="1046" href="runwhile.html#1033" class="Function">usage</a> <a id="1052" class="Symbol">=</a> <a id="1054" class="Keyword">do</a>
  <a id="1059" href="Library.IO.html#621" class="Postulate">putStrLn</a> <a id="1068" class="String">&quot;Usage: runwhile &lt;SourceFile&gt;&quot;</a>
  <a id="1101" href="Library.IO.html#509" class="Postulate">exitFailure</a>

<a id="1114" class="Comment">-- Parse command line argument and send file content through pipeline.</a>

<a id="runwhile"></a><a id="1186" href="runwhile.html#1186" class="Function">runwhile</a> <a id="1195" class="Symbol">:</a> <a id="1197" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1200" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
<a id="1202" href="runwhile.html#1186" class="Function">runwhile</a> <a id="1211" class="Symbol">=</a> <a id="1213" class="Keyword">do</a>
  <a id="1218" href="runwhile.html#1218" class="Bound">file</a> <a id="1223" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="1225" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a> <a id="1228" href="Library.Monad.html#1002" class="Field Operator">←</a> <a id="1230" href="Library.IO.html#552" class="Postulate">getArgs</a> <a id="1238" class="Keyword">where</a> <a id="1244" class="CatchallClause Symbol">_</a><a id="1245" class="CatchallClause"> </a><a id="1246" class="CatchallClause Symbol">→</a><a id="1247" class="CatchallClause"> </a><a id="1248" href="runwhile.html#1033" class="CatchallClause Function">usage</a>
  <a id="1256" href="runwhile.html#925" class="Function">run</a> <a id="1260" href="Library.Monad.html#1243" class="Function Operator">=&lt;&lt;</a> <a id="1264" href="runwhile.html#601" class="Function">check</a> <a id="1270" href="Library.Monad.html#1243" class="Function Operator">=&lt;&lt;</a> <a id="1274" href="runwhile.html#323" class="Function">parse</a> <a id="1280" href="Library.Monad.html#1243" class="Function Operator">=&lt;&lt;</a> <a id="1284" href="Library.IO.html#654" class="Postulate">readFiniteFile</a> <a id="1299" href="runwhile.html#1218" class="Bound">file</a>
  <a id="1306" href="Library.Monad.html#1110" class="Function">return</a> <a id="1313" class="Symbol">_</a>

<a id="main"></a><a id="1316" href="runwhile.html#1316" class="Function">main</a> <a id="1321" class="Symbol">=</a> <a id="1323" href="runwhile.html#1186" class="Function">runwhile</a>


<a id="1334" class="Comment">-- -}</a>
</pre></body></html>