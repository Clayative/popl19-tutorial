<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Andreas Abel and Jesper Cockx">
  <meta name="dcterms.date" content="2019-01-14">
  <title>Correct-by-construction programming in Agda</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme">
  <link rel="stylesheet" href="Agda.css"/>
  <link rel="stylesheet" href="reveal.js/css/theme/white.css"/>
  <link rel="stylesheet" href="patchTheme.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Correct-by-construction programming in Agda</h1>
  <p class="subtitle">Tutorial at POPL 2019</p>
  <p class="author">Andreas Abel and Jesper Cockx</p>
  <p class="date">14 January 2019</p>
</section>

<section><section id="introduction-to-agda" class="title-slide slide level1"><h1>Introduction to Agda</h1></section><section id="what-is-agda" class="slide level2">
<h2>What is Agda?</h2>
<p>Agda is…</p>
<ul>
<li>A strongly typed functional programming language in the tradition of Haskell</li>
<li>An interactive theorem prover in the tradition of Martin-Löf</li>
</ul>
</section><section id="installation" class="slide level2">
<h2>Installation</h2>
<p>Agda (needs GHC):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">cabal</span> install alex happy</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ex">cabal</span> install Agda <span class="kw">&amp;&amp;</span> <span class="ex">agda-mode</span> setup</a></code></pre></div>
<p>Standard library: see <a href="https://github.com/agda/agda-stdlib#quick-installation-instructions">github.com/agda/agda-stdlib</a></p>
<p>BNFC (also needs <code>alex</code> and <code>happy</code>):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">cabal</span> install BNFC</a></code></pre></div>
</section><section id="main-features-of-agda" class="slide level2">
<h2>Main features of Agda</h2>
<ul>
<li>Dependent types</li>
<li>Indexed datatypes and dependent pattern matching</li>
<li>Termination checking and productivity checking</li>
<li>A universe hierachy with universe polymorphism</li>
<li>Record types with copattern matching</li>
<li>Coinductive datatypes</li>
<li>Sized types</li>
<li>Implicit arguments</li>
<li>Instance arguments (~ Haskell’s typeclasses)</li>
<li>Parametrized modules (~ ML functors)</li>
<li>A FFI to Haskell</li>
</ul>
<p>We will use many of these in the course of this tutorial!</p>
</section><section id="emacs-mode-for-agda" class="slide level2">
<h2>Emacs mode for Agda</h2>
<p>Programs may contain <strong>holes</strong> (<code>?</code> or <code>{! !}</code>).</p>
<ul>
<li><strong><code>C-c C-l</code></strong>: typecheck and highlight the current file</li>
<li><strong><code>C-c C-,</code></strong>: get information about the hole under the cursor</li>
<li><strong><code>C-c C-space</code></strong>: give a solution</li>
<li><strong><code>C-c C-r</code></strong>: <em>refine</em> the hole
<ul>
<li>Introduce a lambda or constructor</li>
<li>Apply given function to some new holes</li>
</ul></li>
<li><strong><code>C-c C-c</code></strong>: case split on a variable</li>
</ul>
</section></section>
<section><section id="correct-by-construction-programming" class="title-slide slide level1"><h1>Correct-by-construction programming</h1></section><section id="why-use-dependent-types" class="slide level2">
<h2>Why use dependent types?</h2>
<p>With dependent types, we can <strong>statically verify</strong> that a program satisfies a given correctness property.</p>
<p>Verification is <strong>built into</strong> the language itself.</p>
</section><section id="two-approaches-to-verification-with-dependent-types" class="slide level2">
<h2>Two approaches to verification with dependent types:</h2>
<ul>
<li><strong>Extrinsic approach</strong>: first write the program and then prove correctness</li>
<li><strong>Intrinsic approach</strong>: first define the <em>type</em> of programs that satisfy the correctness property and then write the program that inhabits this type</li>
</ul>
<p>The intrinsic approach is also called <strong>correct-by-construction</strong> programming.</p>
</section><section id="example-of-extrinsic-verification" class="slide level2">
<h2>Example of extrinsic verification</h2>
<!--
<pre class="agda-code"><a id="2243" class="Symbol">{-#</a> <a id="2247" class="Keyword">OPTIONS</a> <a id="2255" class="Pragma">--guardedness</a> <a id="2269" class="Pragma">--sized-types</a> <a id="2283" class="Symbol">#-}</a>

<a id="2288" class="Keyword">open</a> <a id="2293" class="Keyword">import</a> <a id="2300" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="2315" class="Keyword">using</a> <a id="2321" class="Symbol">(</a><a id="2322" href="Agda.Builtin.List.html#80" class="Datatype">List</a><a id="2326" class="Symbol">;</a> <a id="2328" href="Data.List.Base.html#8785" class="InductiveConstructor">[]</a><a id="2330" class="Symbol">;</a> <a id="2332" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">_∷_</a><a id="2335" class="Symbol">)</a>
<a id="2337" class="Keyword">open</a> <a id="2342" class="Keyword">import</a> <a id="2349" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="2365" class="Keyword">using</a> <a id="2371" class="Symbol">(</a><a id="2372" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a><a id="2377" class="Symbol">;</a> <a id="2379" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a><a id="2386" class="Symbol">;</a> <a id="2388" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a><a id="2392" class="Symbol">)</a>
<a id="2394" class="Keyword">open</a> <a id="2399" class="Keyword">import</a> <a id="2406" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="2420" class="Keyword">using</a> <a id="2426" class="Symbol">(</a><a id="2427" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="2428" class="Symbol">;</a> <a id="2430" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a><a id="2434" class="Symbol">;</a> <a id="2436" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a><a id="2439" class="Symbol">;</a> <a id="2441" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">_+_</a><a id="2444" class="Symbol">;</a> <a id="2446" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">_*_</a><a id="2449" class="Symbol">;</a> <a id="2451" href="Data.Nat.Base.html#955" class="Function Operator">_&lt;_</a><a id="2454" class="Symbol">)</a>
<a id="2456" class="Keyword">open</a> <a id="2461" class="Keyword">import</a> <a id="2468" href="Data.Product.html" class="Module">Data.Product</a> <a id="2481" class="Keyword">using</a> <a id="2487" class="Symbol">(</a><a id="2488" href="Data.Product.html#1353" class="Function Operator">_×_</a><a id="2491" class="Symbol">;</a> <a id="2493" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">_,_</a><a id="2496" class="Symbol">)</a>
<a id="2498" class="Keyword">open</a> <a id="2503" class="Keyword">import</a> <a id="2510" href="Agda.Builtin.Equality.html" class="Module">Agda.Builtin.Equality</a> <a id="2532" class="Keyword">using</a> <a id="2538" class="Symbol">(</a><a id="2539" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="2542" class="Symbol">;</a> <a id="2544" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="2548" class="Symbol">)</a>

<a id="2551" class="Keyword">postulate</a>
  <a id="⋯"></a><a id="2563" href="slides.html#2563" class="Postulate">⋯</a> <a id="2565" class="Symbol">:</a> <a id="2567" class="Symbol">∀</a> <a id="2569" class="Symbol">{</a><a id="2570" href="slides.html#2570" class="Bound">ℓ</a><a id="2571" class="Symbol">}</a> <a id="2573" class="Symbol">{</a><a id="2574" href="slides.html#2574" class="Bound">A</a> <a id="2576" class="Symbol">:</a> <a id="2578" class="PrimitiveType">Set</a> <a id="2582" href="slides.html#2570" class="Bound">ℓ</a><a id="2583" class="Symbol">}</a> <a id="2585" class="Symbol">→</a> <a id="2587" href="slides.html#2574" class="Bound">A</a>

<a id="2590" class="Keyword">module</a> <a id="Intro"></a><a id="2597" href="slides.html#2597" class="Module">Intro</a> <a id="2603" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">  <a id="2628" class="Keyword">module</a> <a id="Extrinsic"></a><a id="2635" href="slides.html#2635" class="Module">Extrinsic</a> <a id="2645" class="Keyword">where</a>
    <a id="Intro.Extrinsic._/_"></a><a id="2655" href="slides.html#2655" class="Function Operator">_/_</a> <a id="2659" class="Symbol">:</a> <a id="2661" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2663" class="Symbol">→</a> <a id="2665" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2667" class="Symbol">→</a> <a id="2669" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="2675" href="slides.html#2675" class="Bound">k</a> <a id="2677" href="slides.html#2655" class="Function Operator">/</a> <a id="2679" href="slides.html#2679" class="Bound">l</a> <a id="2681" class="Symbol">=</a> <a id="2683" href="slides.html#2563" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic._%_"></a><a id="2690" href="slides.html#2690" class="Function Operator">_%_</a> <a id="2694" class="Symbol">:</a> <a id="2696" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2698" class="Symbol">→</a> <a id="2700" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2702" class="Symbol">→</a> <a id="2704" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="2710" href="slides.html#2710" class="Bound">k</a> <a id="2712" href="slides.html#2690" class="Function Operator">%</a> <a id="2714" href="slides.html#2714" class="Bound">l</a> <a id="2716" class="Symbol">=</a> <a id="2718" href="slides.html#2563" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic.divmod-lemma"></a><a id="2725" href="slides.html#2725" class="Function">divmod-lemma</a> <a id="2738" class="Symbol">:</a> <a id="2740" class="Symbol">∀</a> <a id="2742" class="Symbol">{</a><a id="2743" href="slides.html#2743" class="Bound">k</a> <a id="2745" href="slides.html#2745" class="Bound">l</a><a id="2746" class="Symbol">}</a> <a id="2748" class="Symbol">→</a> <a id="2750" href="slides.html#2745" class="Bound">l</a> <a id="2752" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">*</a> <a id="2754" class="Symbol">(</a><a id="2755" href="slides.html#2743" class="Bound">k</a> <a id="2757" href="slides.html#2655" class="Function Operator">/</a> <a id="2759" href="slides.html#2745" class="Bound">l</a><a id="2760" class="Symbol">)</a> <a id="2762" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="2764" href="slides.html#2743" class="Bound">k</a> <a id="2766" href="slides.html#2690" class="Function Operator">%</a> <a id="2768" href="slides.html#2745" class="Bound">l</a> <a id="2770" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="2772" href="slides.html#2743" class="Bound">k</a>
    <a id="2778" href="slides.html#2725" class="Function">divmod-lemma</a> <a id="2791" class="Symbol">=</a> <a id="2793" href="slides.html#2563" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic.divmod-minimal"></a><a id="2800" href="slides.html#2800" class="Function">divmod-minimal</a> <a id="2815" class="Symbol">:</a> <a id="2817" class="Symbol">∀</a> <a id="2819" class="Symbol">{</a><a id="2820" href="slides.html#2820" class="Bound">k</a> <a id="2822" href="slides.html#2822" class="Bound">l</a><a id="2823" class="Symbol">}</a> <a id="2825" class="Symbol">→</a> <a id="2827" href="slides.html#2820" class="Bound">k</a> <a id="2829" href="slides.html#2690" class="Function Operator">%</a> <a id="2831" href="slides.html#2822" class="Bound">l</a> <a id="2833" href="Data.Nat.Base.html#955" class="Function Operator">&lt;</a> <a id="2835" href="slides.html#2822" class="Bound">l</a>
    <a id="2841" href="slides.html#2800" class="Function">divmod-minimal</a> <a id="2856" class="Symbol">=</a> <a id="2858" href="slides.html#2563" class="Postulate">⋯</a>
</pre>
</section><section id="example-of-intrinsic-verification" class="slide level2">
<h2>Example of intrinsic verification</h2>
<pre class="agda-code">  <a id="2912" class="Keyword">module</a> <a id="Intrinsic"></a><a id="2919" href="slides.html#2919" class="Module">Intrinsic</a> <a id="2929" class="Keyword">where</a>
    <a id="2939" class="Keyword">record</a> <a id="Intro.Intrinsic.Quotient"></a><a id="2946" href="slides.html#2946" class="Record">Quotient</a> <a id="2955" class="Symbol">(</a><a id="2956" href="slides.html#2956" class="Bound">k</a> <a id="2958" href="slides.html#2958" class="Bound">l</a> <a id="2960" class="Symbol">:</a> <a id="2962" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="2963" class="Symbol">)</a> <a id="2965" class="Symbol">:</a> <a id="2967" class="PrimitiveType">Set</a> <a id="2971" class="Keyword">where</a>
      <a id="2983" class="Keyword">field</a>
        <a id="Intro.Intrinsic.Quotient.q"></a><a id="2997" href="slides.html#2997" class="Field">q</a> <a id="Intro.Intrinsic.Quotient.r"></a><a id="2999" href="slides.html#2999" class="Field">r</a>     <a id="3005" class="Symbol">:</a> <a id="3007" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
        <a id="Intro.Intrinsic.Quotient.divmod"></a><a id="3017" href="slides.html#3017" class="Field">divmod</a>  <a id="3025" class="Symbol">:</a> <a id="3027" href="slides.html#2958" class="Bound">l</a> <a id="3029" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">*</a> <a id="3031" href="slides.html#2997" class="Field">q</a> <a id="3033" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="3035" href="slides.html#2999" class="Field">r</a> <a id="3037" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="3039" href="slides.html#2956" class="Bound">k</a>
        <a id="Intro.Intrinsic.Quotient.minimal"></a><a id="3049" href="slides.html#3049" class="Field">minimal</a> <a id="3057" class="Symbol">:</a> <a id="3059" href="slides.html#2999" class="Field">r</a> <a id="3061" href="Data.Nat.Base.html#955" class="Function Operator">&lt;</a> <a id="3063" href="slides.html#2958" class="Bound">l</a>

    <a id="Intro.Intrinsic.quotient"></a><a id="3070" href="slides.html#3070" class="Function">quotient</a> <a id="3079" class="Symbol">:</a> <a id="3081" class="Symbol">(</a><a id="3082" href="slides.html#3082" class="Bound">k</a> <a id="3084" href="slides.html#3084" class="Bound">l</a> <a id="3086" class="Symbol">:</a> <a id="3088" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="3089" class="Symbol">)</a> <a id="3091" class="Symbol">→</a> <a id="3093" href="slides.html#2946" class="Record">Quotient</a> <a id="3102" href="slides.html#3082" class="Bound">k</a> <a id="3104" href="slides.html#3084" class="Bound">l</a>
    <a id="3110" href="slides.html#3070" class="Function">quotient</a> <a id="3119" class="Symbol">=</a> <a id="3121" href="slides.html#2563" class="Postulate">⋯</a>

    <a id="Intro.Intrinsic._/_"></a><a id="3128" href="slides.html#3128" class="Function Operator">_/_</a> <a id="3132" class="Symbol">:</a> <a id="3134" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3136" class="Symbol">→</a> <a id="3138" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3140" class="Symbol">→</a> <a id="3142" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="3148" href="slides.html#3148" class="Bound">k</a> <a id="3150" href="slides.html#3128" class="Function Operator">/</a> <a id="3152" href="slides.html#3152" class="Bound">l</a> <a id="3154" class="Symbol">=</a> <a id="3156" href="slides.html#2997" class="Field">Quotient.q</a> <a id="3167" class="Symbol">(</a><a id="3168" href="slides.html#3070" class="Function">quotient</a> <a id="3177" href="slides.html#3148" class="Bound">k</a> <a id="3179" href="slides.html#3152" class="Bound">l</a><a id="3180" class="Symbol">)</a>

    <a id="Intro.Intrinsic._%_"></a><a id="3187" href="slides.html#3187" class="Function Operator">_%_</a> <a id="3191" class="Symbol">:</a> <a id="3193" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3195" class="Symbol">→</a> <a id="3197" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3199" class="Symbol">→</a> <a id="3201" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="3207" href="slides.html#3207" class="Bound">k</a> <a id="3209" href="slides.html#3187" class="Function Operator">%</a> <a id="3211" href="slides.html#3211" class="Bound">l</a> <a id="3213" class="Symbol">=</a> <a id="3215" href="slides.html#2999" class="Field">Quotient.r</a> <a id="3226" class="Symbol">(</a><a id="3227" href="slides.html#3070" class="Function">quotient</a> <a id="3236" href="slides.html#3207" class="Bound">k</a> <a id="3238" href="slides.html#3211" class="Bound">l</a><a id="3239" class="Symbol">)</a>
</pre>
</section><section id="correct-by-construction-programming-1" class="slide level2">
<h2>Correct-by-construction programming</h2>
<p>≠ verifying <em>all</em> properties we want</p>
<p>= verifying as many properties as we can get <em>for free</em></p>
</section><section id="goal-of-this-tutorial" class="slide level2">
<h2>Goal of this tutorial</h2>
<p>Implement a correct-by-construction <strong>typechecker</strong> + <strong>interpreter</strong> for a C-like language (WHILE)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb3-1" title="1"><span class="dt">int</span> main () {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">int</span> n   = <span class="dv">100</span>;</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">int</span> sum = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">int</span> k   = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="cf">while</span> (n &gt; k) {</a>
<a class="sourceLine" id="cb3-6" title="6">    k   = k   + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb3-7" title="7">    sum = sum + k;</a>
<a class="sourceLine" id="cb3-8" title="8">  }</a>
<a class="sourceLine" id="cb3-9" title="9">  printInt(sum);</a>
<a class="sourceLine" id="cb3-10" title="10">}</a></code></pre></div>
</section><section id="structure-of-a-while-program" class="slide level2">
<h2>Structure of a WHILE program</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb4-1" title="1"><span class="dt">int</span> main () {</a>
<a class="sourceLine" id="cb4-2" title="2">  type₁ var₁ = expr₁;</a>
<a class="sourceLine" id="cb4-3" title="3">  ...</a>
<a class="sourceLine" id="cb4-4" title="4">  typeₘ varₘ = exprₘ;</a>
<a class="sourceLine" id="cb4-5" title="5">  stmt₁</a>
<a class="sourceLine" id="cb4-6" title="6">  ...</a>
<a class="sourceLine" id="cb4-7" title="7">  stmtₙ</a>
<a class="sourceLine" id="cb4-8" title="8">  printInt(expr);</a>
<a class="sourceLine" id="cb4-9" title="9">}</a></code></pre></div>
</section></section>
<section><section id="simple-data-types-and-pattern-matching" class="title-slide slide level1"><h1>Simple data types and pattern matching</h1></section><section id="some-simple-agda-datatypes" class="slide level2">
<h2>Some simple Agda datatypes</h2>
<!--
<pre class="agda-code"><a id="3892" class="Keyword">module</a> <a id="SimpleData"></a><a id="3899" href="slides.html#3899" class="Module">SimpleData</a> <a id="3910" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">  <a id="3935" class="Keyword">data</a> <a id="SimpleData.Bool"></a><a id="3940" href="slides.html#3940" class="Datatype">Bool</a> <a id="3945" class="Symbol">:</a> <a id="3947" class="PrimitiveType">Set</a> <a id="3951" class="Keyword">where</a>
    <a id="SimpleData.Bool.true"></a><a id="3961" href="slides.html#3961" class="InductiveConstructor">true</a> <a id="SimpleData.Bool.false"></a><a id="3966" href="slides.html#3966" class="InductiveConstructor">false</a> <a id="3972" class="Symbol">:</a> <a id="3974" href="slides.html#3940" class="Datatype">Bool</a>

  <a id="3982" class="Keyword">data</a> <a id="SimpleData.Nat"></a><a id="3987" href="slides.html#3987" class="Datatype">Nat</a> <a id="3991" class="Symbol">:</a> <a id="3993" class="PrimitiveType">Set</a> <a id="3997" class="Keyword">where</a>
    <a id="SimpleData.Nat.zero"></a><a id="4007" href="slides.html#4007" class="InductiveConstructor">zero</a> <a id="4012" class="Symbol">:</a> <a id="4014" href="slides.html#3987" class="Datatype">Nat</a>
    <a id="SimpleData.Nat.suc"></a><a id="4022" href="slides.html#4022" class="InductiveConstructor">suc</a>  <a id="4027" class="Symbol">:</a> <a id="4029" href="slides.html#3987" class="Datatype">Nat</a> <a id="4033" class="Symbol">→</a> <a id="4035" href="slides.html#3987" class="Datatype">Nat</a>

  <a id="4042" class="Keyword">data</a> <a id="SimpleData.Ord"></a><a id="4047" href="slides.html#4047" class="Datatype">Ord</a> <a id="4051" class="Symbol">:</a> <a id="4053" class="PrimitiveType">Set</a> <a id="4057" class="Keyword">where</a>
    <a id="SimpleData.Ord.zero"></a><a id="4067" href="slides.html#4067" class="InductiveConstructor">zero</a> <a id="4072" class="Symbol">:</a> <a id="4074" href="slides.html#4047" class="Datatype">Ord</a>
    <a id="SimpleData.Ord.suc"></a><a id="4082" href="slides.html#4082" class="InductiveConstructor">suc</a>  <a id="4087" class="Symbol">:</a> <a id="4089" href="slides.html#4047" class="Datatype">Ord</a> <a id="4093" class="Symbol">→</a> <a id="4095" href="slides.html#4047" class="Datatype">Ord</a>
    <a id="SimpleData.Ord.sup"></a><a id="4103" href="slides.html#4103" class="InductiveConstructor">sup</a>  <a id="4108" class="Symbol">:</a> <a id="4110" class="Symbol">(</a><a id="4111" href="slides.html#3987" class="Datatype">Nat</a> <a id="4115" class="Symbol">→</a> <a id="4117" href="slides.html#4047" class="Datatype">Ord</a><a id="4120" class="Symbol">)</a> <a id="4122" class="Symbol">→</a> <a id="4124" href="slides.html#4047" class="Datatype">Ord</a>

  <a id="4131" class="Keyword">data</a> <a id="SimpleData.⊥"></a><a id="4136" href="slides.html#4136" class="Datatype">⊥</a> <a id="4138" class="Symbol">:</a> <a id="4140" class="PrimitiveType">Set</a> <a id="4144" class="Keyword">where</a>
    <a id="4154" class="Comment">-- no constructors</a>
</pre>
</section><section id="pattern-matching-in-agda" class="slide level2">
<h2>Pattern matching in Agda</h2>
<pre class="agda-code">  <a id="SimpleData.not"></a><a id="4216" href="slides.html#4216" class="Function">not</a> <a id="4220" class="Symbol">:</a> <a id="4222" href="slides.html#3940" class="Datatype">Bool</a> <a id="4227" class="Symbol">→</a> <a id="4229" href="slides.html#3940" class="Datatype">Bool</a>
  <a id="4236" href="slides.html#4216" class="Function">not</a> <a id="4240" href="slides.html#3961" class="InductiveConstructor">true</a>  <a id="4246" class="Symbol">=</a> <a id="4248" href="slides.html#3966" class="InductiveConstructor">false</a>
  <a id="4256" href="slides.html#4216" class="Function">not</a> <a id="4260" href="slides.html#3966" class="InductiveConstructor">false</a> <a id="4266" class="Symbol">=</a> <a id="4268" href="slides.html#3961" class="InductiveConstructor">true</a>

  <a id="SimpleData.max"></a><a id="4276" href="slides.html#4276" class="Function">max</a> <a id="4280" class="Symbol">:</a> <a id="4282" href="slides.html#3987" class="Datatype">Nat</a> <a id="4286" class="Symbol">→</a> <a id="4288" href="slides.html#3987" class="Datatype">Nat</a> <a id="4292" class="Symbol">→</a> <a id="4294" href="slides.html#3987" class="Datatype">Nat</a>
  <a id="4300" href="slides.html#4276" class="Function">max</a> <a id="4304" href="slides.html#4007" class="InductiveConstructor">zero</a>    <a id="4312" href="slides.html#4312" class="Bound">l</a>       <a id="4320" class="Symbol">=</a> <a id="4322" href="slides.html#4312" class="Bound">l</a>
  <a id="4326" href="slides.html#4276" class="CatchallClause Function">max</a><a id="4329" class="CatchallClause"> </a><a id="4330" href="slides.html#4330" class="CatchallClause Bound">k</a><a id="4331" class="CatchallClause">       </a><a id="4338" href="slides.html#4007" class="CatchallClause InductiveConstructor">zero</a>    <a id="4346" class="Symbol">=</a> <a id="4348" href="slides.html#4330" class="Bound">k</a>
  <a id="4352" href="slides.html#4276" class="Function">max</a> <a id="4356" class="Symbol">(</a><a id="4357" href="slides.html#4022" class="InductiveConstructor">suc</a> <a id="4361" href="slides.html#4361" class="Bound">k</a><a id="4362" class="Symbol">)</a> <a id="4364" class="Symbol">(</a><a id="4365" href="slides.html#4022" class="InductiveConstructor">suc</a> <a id="4369" href="slides.html#4369" class="Bound">l</a><a id="4370" class="Symbol">)</a> <a id="4372" class="Symbol">=</a> <a id="4374" href="slides.html#4022" class="InductiveConstructor">suc</a> <a id="4378" class="Symbol">(</a><a id="4379" href="slides.html#4276" class="Function">max</a> <a id="4383" href="slides.html#4361" class="Bound">k</a> <a id="4385" href="slides.html#4369" class="Bound">l</a><a id="4386" class="Symbol">)</a>

  <a id="SimpleData.magic"></a><a id="4391" href="slides.html#4391" class="Function">magic</a> <a id="4397" class="Symbol">:</a> <a id="4399" class="Symbol">{</a><a id="4400" href="slides.html#4400" class="Bound">A</a> <a id="4402" class="Symbol">:</a> <a id="4404" class="PrimitiveType">Set</a><a id="4407" class="Symbol">}</a> <a id="4409" class="Symbol">→</a> <a id="4411" href="slides.html#4136" class="Datatype">⊥</a> <a id="4413" class="Symbol">→</a> <a id="4415" href="slides.html#4400" class="Bound">A</a>
  <a id="4419" href="slides.html#4391" class="Function">magic</a> <a id="4425" class="Symbol">()</a>
</pre>
</section><section id="type-and-expression-syntax-for-while" class="slide level2">
<h2>Type and expression syntax for WHILE</h2>
<!--
<pre class="agda-code">  <a id="4489" class="Keyword">postulate</a>
    <a id="SimpleData.Id"></a><a id="4503" href="slides.html#4503" class="Postulate">Id</a> <a id="SimpleData.ℤ"></a><a id="4506" href="slides.html#4506" class="Postulate">ℤ</a> <a id="SimpleData.Boolean"></a><a id="4508" href="slides.html#4508" class="Postulate">Boolean</a> <a id="4516" class="Symbol">:</a> <a id="4518" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="4541" class="Keyword">data</a> <a id="SimpleData.Type"></a><a id="4546" href="slides.html#4546" class="Datatype">Type</a> <a id="4551" class="Symbol">:</a> <a id="4553" class="PrimitiveType">Set</a> <a id="4557" class="Keyword">where</a>
    <a id="SimpleData.Type.bool"></a><a id="4567" href="slides.html#4567" class="InductiveConstructor">bool</a> <a id="SimpleData.Type.int"></a><a id="4572" href="slides.html#4572" class="InductiveConstructor">int</a> <a id="4576" class="Symbol">:</a> <a id="4578" href="slides.html#4546" class="Datatype">Type</a>              <a id="4596" class="Comment">-- t ::= bool | int</a>

  <a id="4619" class="Keyword">data</a> <a id="SimpleData.Exp"></a><a id="4624" href="slides.html#4624" class="Datatype">Exp</a> <a id="4628" class="Symbol">:</a> <a id="4630" class="PrimitiveType">Set</a> <a id="4634" class="Keyword">where</a>
    <a id="SimpleData.Exp.eId"></a><a id="4644" href="slides.html#4644" class="InductiveConstructor">eId</a>   <a id="4650" class="Symbol">:</a> <a id="4652" class="Symbol">(</a><a id="4653" href="slides.html#4653" class="Bound">x</a> <a id="4655" class="Symbol">:</a> <a id="4657" href="slides.html#4503" class="Postulate">Id</a><a id="4659" class="Symbol">)</a>      <a id="4666" class="Symbol">→</a> <a id="4668" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4673" class="Comment">-- x,y,z,...</a>
    <a id="SimpleData.Exp.eInt"></a><a id="4690" href="slides.html#4690" class="InductiveConstructor">eInt</a>  <a id="4696" class="Symbol">:</a> <a id="4698" class="Symbol">(</a><a id="4699" href="slides.html#4699" class="Bound">i</a> <a id="4701" class="Symbol">:</a> <a id="4703" href="slides.html#4506" class="Postulate">ℤ</a><a id="4704" class="Symbol">)</a>       <a id="4712" class="Symbol">→</a> <a id="4714" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4719" class="Comment">-- ...-2,-1,0,1,2...</a>
    <a id="SimpleData.Exp.eBool"></a><a id="4744" href="slides.html#4744" class="InductiveConstructor">eBool</a> <a id="4750" class="Symbol">:</a> <a id="4752" class="Symbol">(</a><a id="4753" href="slides.html#4753" class="Bound">b</a> <a id="4755" class="Symbol">:</a> <a id="4757" href="slides.html#4508" class="Postulate">Boolean</a><a id="4764" class="Symbol">)</a> <a id="4766" class="Symbol">→</a> <a id="4768" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4773" class="Comment">-- true or false</a>
    <a id="SimpleData.Exp.ePlus"></a><a id="4794" href="slides.html#4794" class="InductiveConstructor">ePlus</a> <a id="4800" class="Symbol">:</a> <a id="4802" class="Symbol">(</a><a id="4803" href="slides.html#4803" class="Bound">e</a> <a id="4805" href="slides.html#4805" class="Bound">e&#39;</a> <a id="4808" class="Symbol">:</a> <a id="4810" href="slides.html#4624" class="Datatype">Exp</a><a id="4813" class="Symbol">)</a>  <a id="4816" class="Symbol">→</a> <a id="4818" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4823" class="Comment">-- e+e&#39;</a>
    <a id="SimpleData.Exp.eGt"></a><a id="4835" href="slides.html#4835" class="InductiveConstructor">eGt</a>   <a id="4841" class="Symbol">:</a> <a id="4843" class="Symbol">(</a><a id="4844" href="slides.html#4844" class="Bound">e</a> <a id="4846" href="slides.html#4846" class="Bound">e&#39;</a> <a id="4849" class="Symbol">:</a> <a id="4851" href="slides.html#4624" class="Datatype">Exp</a><a id="4854" class="Symbol">)</a>  <a id="4857" class="Symbol">→</a> <a id="4859" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4864" class="Comment">-- e&gt;e&#39;</a>
    <a id="SimpleData.Exp.eAnd"></a><a id="4876" href="slides.html#4876" class="InductiveConstructor">eAnd</a>  <a id="4882" class="Symbol">:</a> <a id="4884" class="Symbol">(</a><a id="4885" href="slides.html#4885" class="Bound">e</a> <a id="4887" href="slides.html#4887" class="Bound">e&#39;</a> <a id="4890" class="Symbol">:</a> <a id="4892" href="slides.html#4624" class="Datatype">Exp</a><a id="4895" class="Symbol">)</a>  <a id="4898" class="Symbol">→</a> <a id="4900" href="slides.html#4624" class="Datatype">Exp</a>  <a id="4905" class="Comment">-- e&amp;&amp;e&#39;</a>
</pre>
</section><section id="statement-syntax-for-while" class="slide level2">
<h2>Statement syntax for WHILE</h2>
<pre class="agda-code">  <a id="4960" class="Keyword">data</a> <a id="SimpleData.Stm"></a><a id="4965" href="slides.html#4965" class="Datatype">Stm</a> <a id="4969" class="Symbol">:</a> <a id="4971" class="PrimitiveType">Set</a> <a id="4975" class="Keyword">where</a>
    <a id="SimpleData.Stm.sAss"></a><a id="4985" href="slides.html#4985" class="InductiveConstructor">sAss</a>   <a id="4992" class="Symbol">:</a> <a id="4994" class="Symbol">(</a><a id="4995" href="slides.html#4995" class="Bound">x</a> <a id="4997" class="Symbol">:</a> <a id="4999" href="slides.html#4503" class="Postulate">Id</a><a id="5001" class="Symbol">)</a> <a id="5003" class="Symbol">(</a><a id="5004" href="slides.html#5004" class="Bound">e</a> <a id="5006" class="Symbol">:</a> <a id="5008" href="slides.html#4624" class="Datatype">Exp</a><a id="5011" class="Symbol">)</a>        <a id="5020" class="Symbol">→</a> <a id="5022" href="slides.html#4965" class="Datatype">Stm</a>
      <a id="5032" class="Comment">-- ^ x = e;</a>
    <a id="SimpleData.Stm.sWhile"></a><a id="5048" href="slides.html#5048" class="InductiveConstructor">sWhile</a> <a id="5055" class="Symbol">:</a> <a id="5057" class="Symbol">(</a><a id="5058" href="slides.html#5058" class="Bound">e</a> <a id="5060" class="Symbol">:</a> <a id="5062" href="slides.html#4624" class="Datatype">Exp</a><a id="5065" class="Symbol">)</a> <a id="5067" class="Symbol">(</a><a id="5068" href="slides.html#5068" class="Bound">ss</a> <a id="5071" class="Symbol">:</a> <a id="5073" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5078" href="slides.html#4965" class="Datatype">Stm</a><a id="5081" class="Symbol">)</a> <a id="5083" class="Symbol">→</a> <a id="5085" href="slides.html#4965" class="Datatype">Stm</a>
      <a id="5095" class="Comment">-- ^ while (b) { ... }</a>
</pre>
</section><section id="program-syntax-for-while" class="slide level2">
<h2>Program syntax for WHILE</h2>
<pre class="agda-code">  <a id="5162" class="Keyword">record</a> <a id="SimpleData.Decl"></a><a id="5169" href="slides.html#5169" class="Record">Decl</a> <a id="5174" class="Symbol">:</a> <a id="5176" class="PrimitiveType">Set</a> <a id="5180" class="Keyword">where</a>
    <a id="5190" class="Keyword">constructor</a> <a id="SimpleData.Decl.dInit"></a><a id="5202" href="slides.html#5202" class="InductiveConstructor">dInit</a>   <a id="5210" class="Comment">-- t x = e;</a>
    <a id="5226" class="Keyword">field</a>
      <a id="SimpleData.Decl.declType"></a><a id="5238" href="slides.html#5238" class="Field">declType</a> <a id="5247" class="Symbol">:</a> <a id="5249" href="slides.html#4546" class="Datatype">Type</a>   <a id="5256" class="Comment">-- variable type (t)</a>
      <a id="SimpleData.Decl.declId"></a><a id="5283" href="slides.html#5283" class="Field">declId</a>   <a id="5292" class="Symbol">:</a> <a id="5294" href="slides.html#4503" class="Postulate">Id</a>     <a id="5301" class="Comment">-- variable name (x)</a>
      <a id="SimpleData.Decl.declExp"></a><a id="5328" href="slides.html#5328" class="Field">declExp</a>  <a id="5337" class="Symbol">:</a> <a id="5339" href="slides.html#4624" class="Datatype">Exp</a>    <a id="5346" class="Comment">-- initial value (e)</a>
  <a id="5369" class="Keyword">open</a> <a id="5374" href="slides.html#5169" class="Module">Decl</a> <a id="5379" class="Keyword">public</a>

  <a id="5389" class="Keyword">record</a> <a id="SimpleData.Program"></a><a id="5396" href="slides.html#5396" class="Record">Program</a> <a id="5404" class="Symbol">:</a> <a id="5406" class="PrimitiveType">Set</a> <a id="5410" class="Keyword">where</a>
    <a id="5420" class="Keyword">constructor</a> <a id="SimpleData.Program.program"></a><a id="5432" href="slides.html#5432" class="InductiveConstructor">program</a>
    <a id="5444" class="Keyword">field</a>
      <a id="SimpleData.Program.theDecls"></a><a id="5456" href="slides.html#5456" class="Field">theDecls</a> <a id="5465" class="Symbol">:</a> <a id="5467" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5472" href="slides.html#5169" class="Record">Decl</a>  <a id="5478" class="Comment">-- t x = e; ...</a>
      <a id="SimpleData.Program.theStms"></a><a id="5500" href="slides.html#5500" class="Field">theStms</a>  <a id="5509" class="Symbol">:</a> <a id="5511" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5516" href="slides.html#4965" class="Datatype">Stm</a>   <a id="5522" class="Comment">-- ss</a>
      <a id="SimpleData.Program.theMain"></a><a id="5534" href="slides.html#5534" class="Field">theMain</a>  <a id="5543" class="Symbol">:</a> <a id="5545" href="slides.html#4624" class="Datatype">Exp</a>        <a id="5556" class="Comment">-- printInt(e);</a>
  <a id="5574" class="Keyword">open</a> <a id="5579" href="slides.html#5396" class="Module">Program</a> <a id="5587" class="Keyword">public</a>
</pre>
</section><section id="untyped-interpreter" class="slide level2">
<h2>Untyped interpreter</h2>
<p>File <code>UntypedInterpreter.agda</code> defines an <em>untyped</em> interpreter for WHILE:</p>
<pre class="agda-code">  <a id="5709" class="Keyword">data</a> <a id="SimpleData.Val"></a><a id="5714" href="slides.html#5714" class="Datatype">Val</a> <a id="5718" class="Symbol">:</a> <a id="5720" class="PrimitiveType">Set</a> <a id="5724" class="Keyword">where</a>
    <a id="SimpleData.Val.intV"></a><a id="5734" href="slides.html#5734" class="InductiveConstructor">intV</a>  <a id="5740" class="Symbol">:</a> <a id="5742" href="slides.html#4506" class="Postulate">ℤ</a>       <a id="5750" class="Symbol">→</a> <a id="5752" href="slides.html#5714" class="Datatype">Val</a>
    <a id="SimpleData.Val.boolV"></a><a id="5760" href="slides.html#5760" class="InductiveConstructor">boolV</a> <a id="5766" class="Symbol">:</a> <a id="5768" href="slides.html#4508" class="Postulate">Boolean</a> <a id="5776" class="Symbol">→</a> <a id="5778" href="slides.html#5714" class="Datatype">Val</a>

  <a id="SimpleData.Env"></a><a id="5785" href="slides.html#5785" class="Function">Env</a> <a id="5789" class="Symbol">:</a> <a id="5791" class="PrimitiveType">Set</a>
  <a id="5797" href="slides.html#5785" class="Function">Env</a> <a id="5801" class="Symbol">=</a> <a id="5803" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5808" class="Symbol">(</a><a id="5809" href="slides.html#4503" class="Postulate">Id</a> <a id="5812" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="5814" href="slides.html#5714" class="Datatype">Val</a><a id="5817" class="Symbol">)</a>

  <a id="SimpleData.eval"></a><a id="5822" href="slides.html#5822" class="Function">eval</a> <a id="5827" class="Symbol">:</a> <a id="5829" href="slides.html#5785" class="Function">Env</a> <a id="5833" class="Symbol">→</a> <a id="5835" href="slides.html#4624" class="Datatype">Exp</a> <a id="5839" class="Symbol">→</a> <a id="5841" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="5847" href="slides.html#5714" class="Datatype">Val</a>
  <a id="5853" href="slides.html#5822" class="Function">eval</a> <a id="5858" href="slides.html#5858" class="Bound">ρ</a> <a id="5860" href="slides.html#5860" class="Bound">e</a> <a id="5862" class="Symbol">=</a> <a id="5864" href="slides.html#2563" class="Postulate">⋯</a>

  <a id="SimpleData.execDecl"></a><a id="5869" href="slides.html#5869" class="Function">execDecl</a> <a id="5878" class="Symbol">:</a> <a id="5880" href="slides.html#5169" class="Record">Decl</a> <a id="5885" class="Symbol">→</a> <a id="5887" href="slides.html#5785" class="Function">Env</a> <a id="5891" class="Symbol">→</a> <a id="5893" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="5899" href="slides.html#5785" class="Function">Env</a>
  <a id="5905" href="slides.html#5869" class="Function">execDecl</a> <a id="5914" href="slides.html#5914" class="Bound">d</a> <a id="5916" href="slides.html#5916" class="Bound">ρ</a> <a id="5918" class="Symbol">=</a> <a id="5920" href="slides.html#2563" class="Postulate">⋯</a>
</pre>
</section><section id="untyped-interpreter-continued" class="slide level2">
<h2>Untyped interpreter (continued)</h2>
<p>All Agda functions must be <strong>total</strong></p>
<p>But WHILE programs can loop!</p>
<p>⇒ we must limit the number of times we repeat the loop</p>
<pre class="agda-code">  <a id="SimpleData.execStm"></a><a id="6097" href="slides.html#6097" class="Function">execStm</a> <a id="6105" class="Symbol">:</a> <a id="6107" class="Symbol">(</a><a id="6108" href="slides.html#6108" class="Bound">fuel</a> <a id="6113" class="Symbol">:</a> <a id="6115" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="6116" class="Symbol">)</a> <a id="6118" class="Symbol">→</a> <a id="6120" href="slides.html#4965" class="Datatype">Stm</a> <a id="6124" class="Symbol">→</a> <a id="6126" href="slides.html#5785" class="Function">Env</a> <a id="6130" class="Symbol">→</a> <a id="6132" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6138" href="slides.html#5785" class="Function">Env</a>
  <a id="6144" href="slides.html#6097" class="Function">execStm</a> <a id="6152" href="slides.html#6152" class="Bound">fuel</a> <a id="6157" href="slides.html#6157" class="Bound">stm</a> <a id="6161" href="slides.html#6161" class="Bound">ρ</a> <a id="6163" class="Symbol">=</a> <a id="6165" href="slides.html#2563" class="Postulate">⋯</a>

  <a id="SimpleData.evalPrg"></a><a id="6170" href="slides.html#6170" class="Function">evalPrg</a> <a id="6178" class="Symbol">:</a> <a id="6180" class="Symbol">(</a><a id="6181" href="slides.html#6181" class="Bound">fuel</a> <a id="6186" class="Symbol">:</a> <a id="6188" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="6189" class="Symbol">)</a> <a id="6191" class="Symbol">→</a> <a id="6193" href="slides.html#5396" class="Record">Program</a> <a id="6201" class="Symbol">→</a> <a id="6203" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6209" href="slides.html#4506" class="Postulate">ℤ</a>
  <a id="6213" href="slides.html#6170" class="Function">evalPrg</a> <a id="6221" href="slides.html#6221" class="Bound">fuel</a> <a id="6226" class="Symbol">(</a><a id="6227" href="slides.html#5432" class="InductiveConstructor">program</a> <a id="6235" href="slides.html#6235" class="Bound">ds</a> <a id="6238" href="slides.html#6238" class="Bound">ss</a> <a id="6241" href="slides.html#6241" class="Bound">e</a><a id="6242" class="Symbol">)</a> <a id="6244" class="Symbol">=</a> <a id="6246" href="slides.html#2563" class="Postulate">⋯</a>
</pre>
</section><section id="exercise-1" class="slide level2">
<h2>Exercise #1</h2>
<p>Go to <code>AST.agda</code> and extend the syntax with one or more of the following:</p>
<ul>
<li>Boolean negation: <code>!e</code></li>
<li>Integer subtraction: <code>e₁-e₂</code></li>
<li>Conditionals: <code class="sourceCode c"><span class="cf">if</span> (e) { ss₁ } <span class="cf">else</span> { ss₂ }</code></li>
</ul>
<p>Ignore the pragmas <code>{-# COMPILE ... #-}</code> for now.</p>
<p>Also go to <code>UntypedInterpreter.agda</code> and add the missing cases!</p>
</section></section>
<section><section id="haskell-ffi" class="title-slide slide level1"><h1>Haskell FFI</h1></section><section id="haskell-ffi-basics" class="slide level2">
<h2>Haskell FFI: basics</h2>
<!--
<pre class="agda-code"><a id="6619" class="Keyword">module</a> <a id="FFI"></a><a id="6626" href="slides.html#6626" class="Module">FFI</a> <a id="6630" class="Keyword">where</a>
</pre>-->
Import a Haskell module:
<pre class="agda-code">  <a id="6680" class="Symbol">{-#</a> <a id="6684" class="Keyword">FOREIGN</a> <a id="6692" class="Pragma">GHC</a> <a id="6696" class="Pragma">import</a> <a id="6703" class="Pragma">HaskellModule.hs</a> <a id="6720" class="Symbol">#-}</a>
</pre>
Bind Haskell function to Agda name: <!--
<pre class="agda-code">  <a id="6776" class="Keyword">postulate</a> <a id="FFI.AgdaType"></a><a id="6786" href="slides.html#6786" class="Postulate">AgdaType</a> <a id="6795" class="Symbol">:</a> <a id="6797" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="6819" class="Keyword">postulate</a> <a id="FFI.agdaName"></a><a id="6829" href="slides.html#6829" class="Postulate">agdaName</a> <a id="6838" class="Symbol">:</a> <a id="6840" href="slides.html#6786" class="Postulate">AgdaType</a>
  <a id="6851" class="Symbol">{-#</a> <a id="6855" class="Keyword">COMPILE</a> <a id="6863" class="Pragma">GHC</a> <a id="6867" href="slides.html#6829" class="Postulate">agdaName</a> <a id="6876" class="Pragma">=</a> <a id="6878" class="Pragma">haskellCode</a> <a id="6890" class="Symbol">#-}</a>
</pre>
Bind Haskell datatype to Agda datatype:
<pre class="agda-code">  <a id="6945" class="Keyword">data</a> <a id="FFI.D"></a><a id="6950" href="slides.html#6950" class="Datatype">D</a> <a id="6952" class="Symbol">:</a> <a id="6954" class="PrimitiveType">Set</a> <a id="6958" class="Keyword">where</a> <a id="FFI.D.c₁"></a><a id="6964" href="slides.html#6964" class="InductiveConstructor">c₁</a> <a id="FFI.D.c₂"></a><a id="6967" href="slides.html#6967" class="InductiveConstructor">c₂</a> <a id="6970" class="Symbol">:</a> <a id="6972" href="slides.html#6950" class="Datatype">D</a>
  <a id="6976" class="Symbol">{-#</a> <a id="6980" class="Keyword">COMPILE</a> <a id="6988" class="Pragma">GHC</a> <a id="6992" href="slides.html#6950" class="Datatype">D</a> <a id="6994" class="Pragma">=</a> <a id="6996" class="Pragma">data</a> <a id="7001" class="Pragma">hsData</a> <a id="7008" class="Pragma">(hsCon₁</a> <a id="7016" class="Pragma">|</a> <a id="7018" class="Pragma">hsCon₂)</a> <a id="7026" class="Symbol">#-}</a>
</pre>
</section><section id="haskell-ffi-example" class="slide level2">
<h2>Haskell FFI example:</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1">  <span class="co">-- In file `While/Abs.hs`:</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">data</span> <span class="dt">Type</span> <span class="fu">=</span> <span class="dt">TBool</span> <span class="fu">|</span> <span class="dt">TInt</span></a></code></pre></div>
<pre class="agda-code">  <a id="7140" class="Comment">-- In file `AST.agda`:</a>
  <a id="7165" class="Symbol">{-#</a> <a id="7169" class="Keyword">FOREIGN</a> <a id="7177" class="Pragma">GHC</a> <a id="7181" class="Pragma">import</a> <a id="7188" class="Pragma">While.Abs</a> <a id="7198" class="Symbol">#-}</a>
  <a id="7204" class="Keyword">data</a> <a id="FFI.Type"></a><a id="7209" href="slides.html#7209" class="Datatype">Type</a> <a id="7214" class="Symbol">:</a> <a id="7216" class="PrimitiveType">Set</a> <a id="7220" class="Keyword">where</a>
    <a id="FFI.Type.bool"></a><a id="7230" href="slides.html#7230" class="InductiveConstructor">bool</a> <a id="FFI.Type.int"></a><a id="7235" href="slides.html#7235" class="InductiveConstructor">int</a> <a id="7239" class="Symbol">:</a> <a id="7241" href="slides.html#7209" class="Datatype">Type</a>

  <a id="7249" class="Symbol">{-#</a> <a id="7253" class="Keyword">COMPILE</a> <a id="7261" class="Pragma">GHC</a> <a id="7265" href="slides.html#7209" class="Datatype">Type</a> <a id="7270" class="Pragma">=</a> <a id="7272" class="Pragma">data</a> <a id="7277" class="Pragma">Type</a>
    <a id="7286" class="Pragma">(</a> <a id="7288" class="Pragma">TBool</a>
    <a id="7298" class="Pragma">|</a> <a id="7300" class="Pragma">TInt</a>
    <a id="7309" class="Pragma">)</a> <a id="7311" class="Symbol">#-}</a>
</pre>
</section><section id="bnfc-the-backus-naur-form-compiler" class="slide level2">
<h2>BNFC: the Backus-Naur Form Compiler</h2>
<p>BNFC is a Haskell library for generating Haskell code from a grammar:</p>
<ul>
<li>Datatypes for abstract syntax</li>
<li>Parser</li>
<li>Pretty-printer</li>
</ul>
<p>See <code>While.cf</code> for the grammar of WHILE.</p>
</section><section id="exercise-2" class="slide level2">
<h2>Exercise #2</h2>
<p>Extend the BNFC grammar with the new syntactic constructions you added.</p>
<p>Don’t forget to update the Haskell bindings in <code>AST.agda</code>!</p>
<p>Testing the grammar: <code>make parser</code> will compile the parser and run it on <code>/test/gcd.c</code>.</p>
</section></section>
<section><section id="dependent-types-and-indexed-datatypes" class="title-slide slide level1"><h1>Dependent types and indexed datatypes</h1></section><section id="indexed-datatypes" class="slide level2">
<h2>Indexed datatypes</h2>
<strong>Indexed datatype</strong> = family of datatypes indexed over some base type <!--
<pre class="agda-code"><a id="7917" class="Keyword">module</a> <a id="IndexedData"></a><a id="7924" href="slides.html#7924" class="Module">IndexedData</a> <a id="7936" class="Keyword">where</a>
  <a id="7944" class="Keyword">open</a> <a id="7949" class="Keyword">import</a> <a id="7956" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
  <a id="7972" class="Keyword">open</a> <a id="7977" class="Keyword">import</a> <a id="7984" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="8002" class="Keyword">using</a> <a id="8008" class="Symbol">(</a><a id="8009" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a><a id="8010" class="Symbol">)</a>
  <a id="8014" class="Keyword">open</a> <a id="8019" class="Keyword">import</a> <a id="8026" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="8061" class="Keyword">using</a> <a id="8067" class="Symbol">(</a><a id="8068" href="Data.List.Membership.Setoid.html#709" class="Function Operator">_∈_</a><a id="8071" class="Symbol">;</a> <a id="8073" href="Data.List.Membership.Setoid.html#758" class="Function Operator">_∉_</a><a id="8076" class="Symbol">)</a>
  <a id="8080" class="Keyword">open</a> <a id="8085" class="Keyword">import</a> <a id="8092" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="8106" class="Keyword">using</a> <a id="8112" class="Symbol">(</a><a id="8113" href="Data.List.All.html#826" class="Datatype">All</a><a id="8116" class="Symbol">;</a> <a id="8118" href="Data.List.All.html#904" class="InductiveConstructor">[]</a><a id="8120" class="Symbol">;</a> <a id="8122" href="Data.List.All.html#921" class="InductiveConstructor Operator">_∷_</a><a id="8125" class="Symbol">)</a> <a id="8127" class="Keyword">hiding</a> <a id="8134" class="Symbol">(</a><a id="8135" class="Keyword">module</a> <a id="8142" href="Data.List.All.html#826" class="Module">All</a><a id="8145" class="Symbol">)</a>
  <a id="8149" class="Keyword">open</a> <a id="8154" href="slides.html#6626" class="Module">FFI</a> <a id="8158" class="Keyword">using</a> <a id="8164" class="Symbol">(</a><a id="8165" href="slides.html#7209" class="Datatype">Type</a><a id="8169" class="Symbol">;</a> <a id="8171" href="slides.html#7235" class="InductiveConstructor">int</a><a id="8174" class="Symbol">;</a> <a id="8176" href="slides.html#7230" class="InductiveConstructor">bool</a><a id="8180" class="Symbol">)</a>

  <a id="8185" class="Keyword">data</a> <a id="IndexedData.Boolean"></a><a id="8190" href="slides.html#8190" class="Datatype">Boolean</a> <a id="8198" class="Symbol">:</a> <a id="8200" class="PrimitiveType">Set</a> <a id="8204" class="Keyword">where</a> <a id="IndexedData.Boolean.BTrue"></a><a id="8210" href="slides.html#8210" class="InductiveConstructor">BTrue</a> <a id="IndexedData.Boolean.BFalse"></a><a id="8216" href="slides.html#8216" class="InductiveConstructor">BFalse</a> <a id="8223" class="Symbol">:</a> <a id="8225" href="slides.html#8190" class="Datatype">Boolean</a>
</pre>-->
<pre class="agda-code">  <a id="8251" class="Keyword">data</a> <a id="IndexedData.Vec"></a><a id="8256" href="slides.html#8256" class="Datatype">Vec</a> <a id="8260" class="Symbol">(</a><a id="8261" href="slides.html#8261" class="Bound">A</a> <a id="8263" class="Symbol">:</a> <a id="8265" class="PrimitiveType">Set</a><a id="8268" class="Symbol">)</a> <a id="8270" class="Symbol">:</a> <a id="8272" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="8274" class="Symbol">→</a> <a id="8276" class="PrimitiveType">Set</a> <a id="8280" class="Keyword">where</a>
    <a id="IndexedData.Vec.[]"></a><a id="8290" href="slides.html#8290" class="InductiveConstructor">[]</a>  <a id="8294" class="Symbol">:</a> <a id="8296" href="slides.html#8256" class="Datatype">Vec</a> <a id="8300" href="slides.html#8261" class="Bound">A</a> <a id="8302" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a>
    <a id="IndexedData.Vec._∷_"></a><a id="8311" href="slides.html#8311" class="InductiveConstructor Operator">_∷_</a> <a id="8315" class="Symbol">:</a> <a id="8317" class="Symbol">{</a><a id="8318" href="slides.html#8318" class="Bound">n</a> <a id="8320" class="Symbol">:</a> <a id="8322" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8323" class="Symbol">}</a> <a id="8325" class="Symbol">→</a> <a id="8327" href="slides.html#8261" class="Bound">A</a> <a id="8329" class="Symbol">→</a> <a id="8331" href="slides.html#8256" class="Datatype">Vec</a> <a id="8335" href="slides.html#8261" class="Bound">A</a> <a id="8337" href="slides.html#8318" class="Bound">n</a> <a id="8339" class="Symbol">→</a> <a id="8341" href="slides.html#8256" class="Datatype">Vec</a> <a id="8345" href="slides.html#8261" class="Bound">A</a> <a id="8347" class="Symbol">(</a><a id="8348" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="8352" href="slides.html#8318" class="Bound">n</a><a id="8353" class="Symbol">)</a>
</pre>
<p>(like GADTs in Haskell/Ocaml)</p>
</section><section id="dependent-pattern-matching" class="slide level2">
<h2>Dependent pattern matching</h2>
<pre class="agda-code">  <a id="IndexedData._++_"></a><a id="8431" href="slides.html#8431" class="Function Operator">_++_</a> <a id="8436" class="Symbol">:</a> <a id="8438" class="Symbol">{</a><a id="8439" href="slides.html#8439" class="Bound">A</a> <a id="8441" class="Symbol">:</a> <a id="8443" class="PrimitiveType">Set</a><a id="8446" class="Symbol">}</a> <a id="8448" class="Symbol">{</a><a id="8449" href="slides.html#8449" class="Bound">m</a> <a id="8451" href="slides.html#8451" class="Bound">n</a> <a id="8453" class="Symbol">:</a> <a id="8455" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8456" class="Symbol">}</a>
       <a id="8465" class="Symbol">→</a> <a id="8467" href="slides.html#8256" class="Datatype">Vec</a> <a id="8471" href="slides.html#8439" class="Bound">A</a> <a id="8473" href="slides.html#8449" class="Bound">m</a> <a id="8475" class="Symbol">→</a> <a id="8477" href="slides.html#8256" class="Datatype">Vec</a> <a id="8481" href="slides.html#8439" class="Bound">A</a> <a id="8483" href="slides.html#8451" class="Bound">n</a> <a id="8485" class="Symbol">→</a> <a id="8487" href="slides.html#8256" class="Datatype">Vec</a> <a id="8491" href="slides.html#8439" class="Bound">A</a> <a id="8493" class="Symbol">(</a><a id="8494" href="slides.html#8449" class="Bound">m</a> <a id="8496" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="8498" href="slides.html#8451" class="Bound">n</a><a id="8499" class="Symbol">)</a>
  <a id="8503" href="slides.html#8290" class="InductiveConstructor">[]</a>       <a id="8512" href="slides.html#8431" class="Function Operator">++</a> <a id="8515" href="slides.html#8515" class="Bound">ys</a> <a id="8518" class="Symbol">=</a> <a id="8520" href="slides.html#8515" class="Bound">ys</a>              <a id="8536" class="Comment">-- m = zero</a>
  <a id="8550" class="Symbol">(</a><a id="8551" href="slides.html#8551" class="Bound">x</a> <a id="8553" href="slides.html#8311" class="InductiveConstructor Operator">∷</a> <a id="8555" href="slides.html#8555" class="Bound">xs</a><a id="8557" class="Symbol">)</a> <a id="8559" href="slides.html#8431" class="Function Operator">++</a> <a id="8562" href="slides.html#8562" class="Bound">ys</a> <a id="8565" class="Symbol">=</a> <a id="8567" href="slides.html#8551" class="Bound">x</a> <a id="8569" href="slides.html#8311" class="InductiveConstructor Operator">∷</a> <a id="8571" class="Symbol">(</a><a id="8572" href="slides.html#8555" class="Bound">xs</a> <a id="8575" href="slides.html#8431" class="Function Operator">++</a> <a id="8578" href="slides.html#8562" class="Bound">ys</a><a id="8580" class="Symbol">)</a>  <a id="8583" class="Comment">-- m = suc m′</a>

  <a id="IndexedData.head"></a><a id="8600" href="slides.html#8600" class="Function">head</a> <a id="8605" class="Symbol">:</a> <a id="8607" class="Symbol">{</a><a id="8608" href="slides.html#8608" class="Bound">A</a> <a id="8610" class="Symbol">:</a> <a id="8612" class="PrimitiveType">Set</a><a id="8615" class="Symbol">}</a> <a id="8617" class="Symbol">{</a><a id="8618" href="slides.html#8618" class="Bound">n</a> <a id="8620" class="Symbol">:</a> <a id="8622" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8623" class="Symbol">}</a> <a id="8625" class="Symbol">→</a> <a id="8627" href="slides.html#8256" class="Datatype">Vec</a> <a id="8631" href="slides.html#8608" class="Bound">A</a> <a id="8633" class="Symbol">(</a><a id="8634" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="8638" href="slides.html#8618" class="Bound">n</a><a id="8639" class="Symbol">)</a> <a id="8641" class="Symbol">→</a> <a id="8643" href="slides.html#8608" class="Bound">A</a>
  <a id="8647" class="Comment">-- head []         -- Impossible!</a>
  <a id="8683" href="slides.html#8600" class="Function">head</a> <a id="8688" class="Symbol">(</a><a id="8689" href="slides.html#8689" class="Bound">x</a> <a id="8691" href="slides.html#8311" class="InductiveConstructor Operator">∷</a> <a id="8693" href="slides.html#8693" class="Bound">xs</a><a id="8695" class="Symbol">)</a> <a id="8697" class="Symbol">=</a> <a id="8699" href="slides.html#8689" class="Bound">x</a>
</pre>
</section><section id="well-typed-syntax-representation" class="slide level2">
<h2>Well-typed syntax representation</h2>
<p>Our correct-by-construction typechecker produces <strong>intrinsically well-typed syntax</strong>:</p>
<pre class="agda-code">  <a id="IndexedData.Cxt"></a><a id="8836" href="slides.html#8836" class="Function">Cxt</a> <a id="8840" class="Symbol">=</a> <a id="8842" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="8847" href="slides.html#7209" class="Datatype">Type</a>

  <a id="8855" class="Keyword">data</a> <a id="IndexedData.Exp"></a><a id="8860" href="slides.html#8860" class="Datatype">Exp</a> <a id="8864" class="Symbol">(</a><a id="8865" href="slides.html#8865" class="Bound">Γ</a> <a id="8867" class="Symbol">:</a> <a id="8869" href="slides.html#8836" class="Function">Cxt</a><a id="8872" class="Symbol">)</a> <a id="8874" class="Symbol">:</a> <a id="8876" href="slides.html#7209" class="Datatype">Type</a> <a id="8881" class="Symbol">→</a> <a id="8883" class="PrimitiveType">Set</a>
</pre>
<p>A term <code>e : Exp Γ t</code> is a <em>well-typed</em> WHILE expression in context <code>Γ</code>.</p>
</section><section id="well-typed-syntax" class="slide level2">
<h2>Well-typed syntax</h2>
<pre class="agda-code">  <a id="IndexedData.Var"></a><a id="8997" href="slides.html#8997" class="Function">Var</a> <a id="9001" class="Symbol">:</a> <a id="9003" class="Symbol">(</a><a id="9004" href="slides.html#9004" class="Bound">Γ</a> <a id="9006" class="Symbol">:</a> <a id="9008" href="slides.html#8836" class="Function">Cxt</a><a id="9011" class="Symbol">)</a> <a id="9013" class="Symbol">(</a><a id="9014" href="slides.html#9014" class="Bound">t</a> <a id="9016" class="Symbol">:</a> <a id="9018" href="slides.html#7209" class="Datatype">Type</a><a id="9022" class="Symbol">)</a> <a id="9024" class="Symbol">→</a> <a id="9026" class="PrimitiveType">Set</a>
  <a id="9032" href="slides.html#8997" class="Function">Var</a> <a id="9036" href="slides.html#9036" class="Bound">Γ</a> <a id="9038" href="slides.html#9038" class="Bound">t</a> <a id="9040" class="Symbol">=</a> <a id="9042" href="slides.html#9038" class="Bound">t</a> <a id="9044" href="Data.List.Membership.Setoid.html#709" class="Function Operator">∈</a> <a id="9046" href="slides.html#9036" class="Bound">Γ</a>

  <a id="9051" class="Keyword">data</a> <a id="IndexedData.Op"></a><a id="9056" href="slides.html#9056" class="Datatype">Op</a> <a id="9059" class="Symbol">:</a> <a id="9061" class="Symbol">(</a><a id="9062" href="slides.html#9062" class="Bound">dom</a> <a id="9066" href="slides.html#9066" class="Bound">codom</a> <a id="9072" class="Symbol">:</a> <a id="9074" href="slides.html#7209" class="Datatype">Type</a><a id="9078" class="Symbol">)</a> <a id="9080" class="Symbol">→</a> <a id="9082" class="PrimitiveType">Set</a> <a id="9086" class="Keyword">where</a>
    <a id="IndexedData.Op.plus"></a><a id="9096" href="slides.html#9096" class="InductiveConstructor">plus</a>  <a id="9102" class="Symbol">:</a> <a id="9104" href="slides.html#9056" class="Datatype">Op</a> <a id="9107" href="slides.html#7235" class="InductiveConstructor">int</a>  <a id="9112" href="slides.html#7235" class="InductiveConstructor">int</a>
    <a id="IndexedData.Op.gt"></a><a id="9120" href="slides.html#9120" class="InductiveConstructor">gt</a>    <a id="9126" class="Symbol">:</a> <a id="9128" href="slides.html#9056" class="Datatype">Op</a> <a id="9131" href="slides.html#7235" class="InductiveConstructor">int</a>  <a id="9136" href="slides.html#7230" class="InductiveConstructor">bool</a>
    <a id="IndexedData.Op.and"></a><a id="9145" href="slides.html#9145" class="InductiveConstructor">and</a>   <a id="9151" class="Symbol">:</a> <a id="9153" href="slides.html#9056" class="Datatype">Op</a> <a id="9156" href="slides.html#7230" class="InductiveConstructor">bool</a> <a id="9161" href="slides.html#7230" class="InductiveConstructor">bool</a>

  <a id="9169" class="Keyword">data</a> <a id="9174" href="slides.html#8860" class="Datatype">Exp</a> <a id="9178" href="slides.html#9178" class="Bound">Γ</a> <a id="9180" class="Keyword">where</a>
    <a id="IndexedData.Exp.eInt"></a><a id="9190" href="slides.html#9190" class="InductiveConstructor">eInt</a>  <a id="9196" class="Symbol">:</a> <a id="9198" class="Symbol">(</a><a id="9199" href="slides.html#9199" class="Bound">i</a> <a id="9201" class="Symbol">:</a> <a id="9203" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a><a id="9204" class="Symbol">)</a>            <a id="9217" class="Symbol">→</a> <a id="9219" href="slides.html#8860" class="Datatype">Exp</a> <a id="9223" href="slides.html#9178" class="Bound">Γ</a> <a id="9225" href="slides.html#7235" class="InductiveConstructor">int</a>
    <a id="IndexedData.Exp.eBool"></a><a id="9233" href="slides.html#9233" class="InductiveConstructor">eBool</a> <a id="9239" class="Symbol">:</a> <a id="9241" class="Symbol">(</a><a id="9242" href="slides.html#9242" class="Bound">b</a> <a id="9244" class="Symbol">:</a> <a id="9246" href="slides.html#8190" class="Datatype">Boolean</a><a id="9253" class="Symbol">)</a>      <a id="9260" class="Symbol">→</a> <a id="9262" href="slides.html#8860" class="Datatype">Exp</a> <a id="9266" href="slides.html#9178" class="Bound">Γ</a> <a id="9268" href="slides.html#7230" class="InductiveConstructor">bool</a>
    <a id="IndexedData.Exp.eOp"></a><a id="9277" href="slides.html#9277" class="InductiveConstructor">eOp</a>   <a id="9283" class="Symbol">:</a> <a id="9285" class="Symbol">∀{</a><a id="9287" href="slides.html#9287" class="Bound">t</a> <a id="9289" href="slides.html#9289" class="Bound">t&#39;</a><a id="9291" class="Symbol">}</a> <a id="9293" class="Symbol">(</a><a id="9294" href="slides.html#9294" class="Bound">op</a> <a id="9297" class="Symbol">:</a> <a id="9299" href="slides.html#9056" class="Datatype">Op</a> <a id="9302" href="slides.html#9287" class="Bound">t</a> <a id="9304" href="slides.html#9289" class="Bound">t&#39;</a><a id="9306" class="Symbol">)</a>
          <a id="9318" class="Symbol">→</a> <a id="9320" class="Symbol">(</a><a id="9321" href="slides.html#9321" class="Bound">e</a> <a id="9323" href="slides.html#9323" class="Bound">e&#39;</a> <a id="9326" class="Symbol">:</a> <a id="9328" href="slides.html#8860" class="Datatype">Exp</a> <a id="9332" href="slides.html#9178" class="Bound">Γ</a> <a id="9334" href="slides.html#9287" class="Bound">t</a><a id="9335" class="Symbol">)</a>   <a id="9339" class="Symbol">→</a> <a id="9341" href="slides.html#8860" class="Datatype">Exp</a> <a id="9345" href="slides.html#9178" class="Bound">Γ</a> <a id="9347" href="slides.html#9289" class="Bound">t&#39;</a>
    <a id="IndexedData.Exp.eVar"></a><a id="9354" href="slides.html#9354" class="InductiveConstructor">eVar</a>  <a id="9360" class="Symbol">:</a> <a id="9362" class="Symbol">∀{</a><a id="9364" href="slides.html#9364" class="Bound">t</a><a id="9365" class="Symbol">}</a> <a id="9367" class="Symbol">(</a><a id="9368" href="slides.html#9368" class="Bound">x</a> <a id="9370" class="Symbol">:</a> <a id="9372" href="slides.html#8997" class="Function">Var</a> <a id="9376" href="slides.html#9178" class="Bound">Γ</a> <a id="9378" href="slides.html#9364" class="Bound">t</a><a id="9379" class="Symbol">)</a> <a id="9381" class="Symbol">→</a> <a id="9383" href="slides.html#8860" class="Datatype">Exp</a> <a id="9387" href="slides.html#9178" class="Bound">Γ</a> <a id="9389" href="slides.html#9364" class="Bound">t</a>
</pre>
<p>see <code>WellTypedSyntax.agda</code></p>
</section><section id="evaluating-well-typed-syntax" class="slide level2">
<h2>Evaluating well-typed syntax</h2>
We can now define <code>eval</code> for well-typed expressions:
<pre class="agda-code">  <a id="IndexedData.Val"></a><a id="9515" href="slides.html#9515" class="Function">Val</a> <a id="9519" class="Symbol">:</a> <a id="9521" href="slides.html#7209" class="Datatype">Type</a> <a id="9526" class="Symbol">→</a> <a id="9528" class="PrimitiveType">Set</a>
  <a id="9534" href="slides.html#9515" class="Function">Val</a> <a id="9538" href="slides.html#7235" class="InductiveConstructor">int</a>    <a id="9545" class="Symbol">=</a> <a id="9547" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
  <a id="9551" href="slides.html#9515" class="Function">Val</a> <a id="9555" href="slides.html#7230" class="InductiveConstructor">bool</a>   <a id="9562" class="Symbol">=</a> <a id="9564" href="slides.html#8190" class="Datatype">Boolean</a>

  <a id="IndexedData.Env"></a><a id="9575" href="slides.html#9575" class="Function">Env</a> <a id="9579" class="Symbol">:</a> <a id="9581" href="slides.html#8836" class="Function">Cxt</a> <a id="9585" class="Symbol">→</a> <a id="9587" class="PrimitiveType">Set</a>
  <a id="9593" href="slides.html#9575" class="Function">Env</a> <a id="9597" class="Symbol">=</a> <a id="9599" href="Data.List.All.html#826" class="Datatype">All</a> <a id="9603" href="slides.html#9515" class="Function">Val</a>

  <a id="IndexedData.eval"></a><a id="9610" href="slides.html#9610" class="Function">eval</a> <a id="9615" class="Symbol">:</a> <a id="9617" class="Symbol">∀</a> <a id="9619" class="Symbol">{</a><a id="9620" href="slides.html#9620" class="Bound">Γ</a><a id="9621" class="Symbol">}</a> <a id="9623" class="Symbol">{</a><a id="9624" href="slides.html#9624" class="Bound">t</a><a id="9625" class="Symbol">}</a> <a id="9627" class="Symbol">→</a> <a id="9629" href="slides.html#9575" class="Function">Env</a> <a id="9633" href="slides.html#9620" class="Bound">Γ</a> <a id="9635" class="Symbol">→</a> <a id="9637" href="slides.html#8860" class="Datatype">Exp</a> <a id="9641" href="slides.html#9620" class="Bound">Γ</a> <a id="9643" href="slides.html#9624" class="Bound">t</a> <a id="9645" class="Symbol">→</a> <a id="9647" href="slides.html#9515" class="Function">Val</a> <a id="9651" href="slides.html#9624" class="Bound">t</a>
  <a id="9655" href="slides.html#9610" class="Function">eval</a> <a id="9660" class="Symbol">=</a> <a id="9662" href="slides.html#2563" class="Postulate">⋯</a>
</pre>
<p>that <strong>always</strong> returns a value (bye bye <code>Maybe</code>!)</p>
<p>See definition of <code>eval</code> in <code>Interpreter.agda</code>.</p>
</section><section id="exercise-3" class="slide level2">
<h2>Exercise #3</h2>
<p>Extend the well-typed syntax with the new syntactic constructions you added.</p>
</section></section>
<section id="break-30-min" class="title-slide slide level1"><h1>BREAK (30 min)</h1></section>
<section><section id="monads-and-instance-arguments" class="title-slide slide level1"><h1>Monads and instance arguments</h1></section><section id="instance-arguments" class="slide level2">
<h2>Instance arguments</h2>
<p><em>Instance arguments</em> are Agda’s builtin mechanism for ad-hoc overloading (~ type classes in Haskell).</p>
<p>Syntax:</p>
<ul>
<li>Using an instance: <code>{{x : A}} → ...</code></li>
<li>Defining new instances: <code>instance ...</code></li>
</ul>
<p>When using a function of type <code>{{x : A}} → B</code>, Agda will automatically resolve the argument if there is a <strong>unique</strong> instance of the right type in scope.</p>
</section><section id="defining-a-typeclass-with-instance-arguments" class="slide level2">
<h2>Defining a typeclass with instance arguments</h2>
<!--
<pre class="agda-code"><a id="10349" class="Keyword">module</a> <a id="Instances"></a><a id="10356" href="slides.html#10356" class="Module">Instances</a> <a id="10366" class="Keyword">where</a>
  <a id="10374" class="Keyword">open</a> <a id="10379" class="Keyword">import</a> <a id="10386" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
  <a id="10403" class="Keyword">open</a> <a id="10408" class="Keyword">import</a> <a id="10415" href="Data.String.Base.html" class="Module">Data.String.Base</a>
</pre>-->
<pre class="agda-code">  <a id="10451" class="Keyword">record</a> <a id="Instances.Print"></a><a id="10458" href="slides.html#10458" class="Record">Print</a> <a id="10464" class="Symbol">{</a><a id="10465" href="slides.html#10465" class="Bound">ℓ</a><a id="10466" class="Symbol">}</a> <a id="10468" class="Symbol">(</a><a id="10469" href="slides.html#10469" class="Bound">A</a> <a id="10471" class="Symbol">:</a> <a id="10473" class="PrimitiveType">Set</a> <a id="10477" href="slides.html#10465" class="Bound">ℓ</a><a id="10478" class="Symbol">)</a> <a id="10480" class="Symbol">:</a> <a id="10482" class="PrimitiveType">Set</a> <a id="10486" href="slides.html#10465" class="Bound">ℓ</a> <a id="10488" class="Keyword">where</a>
    <a id="10498" class="Keyword">field</a>
      <a id="Instances.Print.print"></a><a id="10510" href="slides.html#10510" class="Field">print</a> <a id="10516" class="Symbol">:</a> <a id="10518" href="slides.html#10469" class="Bound">A</a> <a id="10520" class="Symbol">→</a> <a id="10522" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
  <a id="10531" class="Keyword">open</a> <a id="10536" href="slides.html#10458" class="Module">Print</a> <a id="10542" class="Symbol">{{...}}</a>  <a id="10551" class="Comment">-- print : {{r : Print A}} → A → String</a>

  <a id="10594" class="Keyword">instance</a>
    <a id="Instances.PrintBool"></a><a id="10607" href="slides.html#10607" class="Function">PrintBool</a> <a id="10617" class="Symbol">:</a> <a id="10619" href="slides.html#10458" class="Record">Print</a> <a id="10625" href="Agda.Builtin.Bool.html#67" class="Datatype">Bool</a>
    <a id="10634" href="slides.html#10510" class="Field">print</a> <a id="10640" class="Symbol">{{</a><a id="10642" href="slides.html#10607" class="Function">PrintBool</a><a id="10651" class="Symbol">}}</a> <a id="10654" href="Agda.Builtin.Bool.html#92" class="InductiveConstructor">true</a>  <a id="10660" class="Symbol">=</a> <a id="10662" class="String">&quot;true&quot;</a>
    <a id="10673" href="slides.html#10510" class="Field">print</a> <a id="10679" class="Symbol">{{</a><a id="10681" href="slides.html#10607" class="Function">PrintBool</a><a id="10690" class="Symbol">}}</a> <a id="10693" href="Agda.Builtin.Bool.html#86" class="InductiveConstructor">false</a> <a id="10699" class="Symbol">=</a> <a id="10701" class="String">&quot;false&quot;</a>

    <a id="Instances.PrintString"></a><a id="10714" href="slides.html#10714" class="Function">PrintString</a> <a id="10726" class="Symbol">:</a> <a id="10728" href="slides.html#10458" class="Record">Print</a> <a id="10734" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
    <a id="10745" href="slides.html#10510" class="Field">print</a> <a id="10751" class="Symbol">{{</a><a id="10753" href="slides.html#10714" class="Function">PrintString</a><a id="10764" class="Symbol">}}</a> <a id="10767" href="slides.html#10767" class="Bound">x</a> <a id="10769" class="Symbol">=</a> <a id="10771" href="slides.html#10767" class="Bound">x</a>

  <a id="Instances.testPrint"></a><a id="10776" href="slides.html#10776" class="Function">testPrint</a> <a id="10786" class="Symbol">:</a> <a id="10788" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
  <a id="10797" href="slides.html#10776" class="Function">testPrint</a> <a id="10807" class="Symbol">=</a> <a id="10809" class="Symbol">(</a><a id="10810" href="slides.html#10510" class="Field">print</a> <a id="10816" href="Agda.Builtin.Bool.html#92" class="InductiveConstructor">true</a><a id="10820" class="Symbol">)</a> <a id="10822" href="Data.String.Base.html#1089" class="Function Operator">++</a> <a id="10825" class="Symbol">(</a><a id="10826" href="slides.html#10510" class="Field">print</a> <a id="10832" class="String">&quot;a string&quot;</a><a id="10842" class="Symbol">)</a>
</pre>
</section><section id="monads" class="slide level2">
<h2>Monads</h2>
<p><code>Monad</code> is a typeclass with two fields <code>return</code> and <code>_&gt;&gt;=_</code>.</p>
<p>Example: <code>Error</code> monad (see <code>Library/Error.agda</code>)</p>
</section><section id="correct-by-construction-typechecker" class="slide level2">
<h2>Correct-by-construction typechecker</h2>
<p>See <code>TypeChecker.agda</code></p>
</section><section id="exercise-4" class="slide level2">
<h2>Exercise #4</h2>
<p>Extend the typechecker with rules for the new syntactic constructions you added.</p>
</section></section>
<section><section id="coinduction-and-sized-types" class="title-slide slide level1"><h1>Coinduction and sized types</h1></section><section id="coinduction-in-agda" class="slide level2">
<h2>Coinduction in Agda</h2>
Coinductive type may contain infinitely deep values (non well-founded trees) <!--
<pre class="agda-code"><a id="11280" class="Keyword">module</a> <a id="Coinduction"></a><a id="11287" href="slides.html#11287" class="Module">Coinduction</a> <a id="11299" class="Keyword">where</a>
  <a id="11307" class="Keyword">module</a> <a id="GuardedStream"></a><a id="11314" href="slides.html#11314" class="Module">GuardedStream</a> <a id="11328" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">    <a id="11354" class="Keyword">record</a> <a id="Coinduction.GuardedStream.Stream"></a><a id="11361" href="slides.html#11361" class="Record">Stream</a> <a id="11368" class="Symbol">(</a><a id="11369" href="slides.html#11369" class="Bound">A</a> <a id="11371" class="Symbol">:</a> <a id="11373" class="PrimitiveType">Set</a><a id="11376" class="Symbol">)</a> <a id="11378" class="Symbol">:</a> <a id="11380" class="PrimitiveType">Set</a> <a id="11384" class="Keyword">where</a>
      <a id="11396" class="Keyword">coinductive</a>
      <a id="11414" class="Keyword">field</a>
        <a id="Coinduction.GuardedStream.Stream.head"></a><a id="11428" href="slides.html#11428" class="Field">head</a> <a id="11433" class="Symbol">:</a> <a id="11435" href="slides.html#11369" class="Bound">A</a>
        <a id="Coinduction.GuardedStream.Stream.tail"></a><a id="11445" href="slides.html#11445" class="Field">tail</a> <a id="11450" class="Symbol">:</a> <a id="11452" href="slides.html#11361" class="Record">Stream</a> <a id="11459" href="slides.html#11369" class="Bound">A</a>
    <a id="11465" class="Keyword">open</a> <a id="11470" href="slides.html#11361" class="Module">Stream</a>

    <a id="Coinduction.GuardedStream.repeat"></a><a id="11482" href="slides.html#11482" class="Function">repeat</a> <a id="11489" class="Symbol">:</a> <a id="11491" class="Symbol">{</a><a id="11492" href="slides.html#11492" class="Bound">A</a> <a id="11494" class="Symbol">:</a> <a id="11496" class="PrimitiveType">Set</a><a id="11499" class="Symbol">}</a> <a id="11501" class="Symbol">→</a> <a id="11503" href="slides.html#11492" class="Bound">A</a> <a id="11505" class="Symbol">→</a> <a id="11507" href="slides.html#11361" class="Record">Stream</a> <a id="11514" href="slides.html#11492" class="Bound">A</a>
    <a id="11520" href="slides.html#11482" class="Function">repeat</a> <a id="11527" href="slides.html#11527" class="Bound">x</a> <a id="11529" class="Symbol">.</a><a id="11530" href="slides.html#11428" class="Field">head</a> <a id="11535" class="Symbol">=</a> <a id="11537" href="slides.html#11527" class="Bound">x</a>
    <a id="11543" href="slides.html#11482" class="Function">repeat</a> <a id="11550" href="slides.html#11550" class="Bound">x</a> <a id="11552" class="Symbol">.</a><a id="11553" href="slides.html#11445" class="Field">tail</a> <a id="11558" class="Symbol">=</a> <a id="11560" href="slides.html#11482" class="Function">repeat</a> <a id="11567" href="slides.html#11550" class="Bound">x</a>
</pre>
</section><section id="dealing-with-infinite-computations" class="slide level2">
<h2>Dealing with infinite computations</h2>
<p>Remember: all Agda functions must be <strong>total</strong></p>
<p>⇒ interpreter for WHILE takes <code>fuel</code> argument</p>
<p>Can we do better?</p>
</section><section id="going-carbon-free-with-the-delay-monad" class="slide level2">
<h2>Going carbon-free with the <code>Delay</code> monad</h2>
<p><strong>Monads</strong> allow us to use effects in a pure language</p>
<p>The <code>Delay</code> monad captures the effect of <em>non-termination</em></p>
<p>A value of type <code>Delay A</code> is - either a value of type <code>A</code> produced <strong>now</strong> - or a computation of type <code>Delay A</code> produced <strong>later</strong></p>
</section><section id="the-delay-monad-definition" class="slide level2">
<h2>The Delay monad: definition</h2>
<pre class="agda-code">  <a id="12061" class="Keyword">mutual</a>
    <a id="12072" class="Keyword">record</a> <a id="Coinduction.Delay"></a><a id="12079" href="slides.html#12079" class="Record">Delay</a> <a id="12085" class="Symbol">(</a><a id="12086" href="slides.html#12086" class="Bound">A</a> <a id="12088" class="Symbol">:</a> <a id="12090" class="PrimitiveType">Set</a><a id="12093" class="Symbol">)</a> <a id="12095" class="Symbol">:</a> <a id="12097" class="PrimitiveType">Set</a> <a id="12101" class="Keyword">where</a>
      <a id="12113" class="Keyword">coinductive</a>
      <a id="12131" class="Keyword">field</a> <a id="Coinduction.Delay.force"></a><a id="12137" href="slides.html#12137" class="Field">force</a> <a id="12143" class="Symbol">:</a> <a id="12145" href="slides.html#12164" class="Datatype">Delay&#39;</a> <a id="12152" href="slides.html#12086" class="Bound">A</a>

    <a id="12159" class="Keyword">data</a> <a id="Coinduction.Delay&#39;"></a><a id="12164" href="slides.html#12164" class="Datatype">Delay&#39;</a> <a id="12171" class="Symbol">(</a><a id="12172" href="slides.html#12172" class="Bound">A</a> <a id="12174" class="Symbol">:</a> <a id="12176" class="PrimitiveType">Set</a><a id="12179" class="Symbol">)</a> <a id="12181" class="Symbol">:</a> <a id="12183" class="PrimitiveType">Set</a> <a id="12187" class="Keyword">where</a>
      <a id="Coinduction.Delay&#39;.now"></a><a id="12199" href="slides.html#12199" class="InductiveConstructor">now</a>   <a id="12205" class="Symbol">:</a> <a id="12207" href="slides.html#12172" class="Bound">A</a>       <a id="12215" class="Symbol">→</a> <a id="12217" href="slides.html#12164" class="Datatype">Delay&#39;</a> <a id="12224" href="slides.html#12172" class="Bound">A</a>
      <a id="Coinduction.Delay&#39;.later"></a><a id="12232" href="slides.html#12232" class="InductiveConstructor">later</a> <a id="12238" class="Symbol">:</a> <a id="12240" href="slides.html#12079" class="Record">Delay</a> <a id="12246" href="slides.html#12172" class="Bound">A</a> <a id="12248" class="Symbol">→</a> <a id="12250" href="slides.html#12164" class="Datatype">Delay&#39;</a> <a id="12257" href="slides.html#12172" class="Bound">A</a>

  <a id="12262" class="Keyword">open</a> <a id="12267" href="slides.html#12079" class="Module">Delay</a> <a id="12273" class="Keyword">public</a>

  <a id="Coinduction.never"></a><a id="12283" href="slides.html#12283" class="Function">never</a> <a id="12289" class="Symbol">:</a> <a id="12291" class="Symbol">{</a><a id="12292" href="slides.html#12292" class="Bound">A</a> <a id="12294" class="Symbol">:</a> <a id="12296" class="PrimitiveType">Set</a><a id="12299" class="Symbol">}</a> <a id="12301" class="Symbol">→</a> <a id="12303" href="slides.html#12079" class="Record">Delay</a> <a id="12309" href="slides.html#12292" class="Bound">A</a>
  <a id="12313" href="slides.html#12283" class="Function">never</a> <a id="12319" class="Symbol">.</a><a id="12320" href="slides.html#12137" class="Field">force</a> <a id="12326" class="Symbol">=</a> <a id="12328" href="slides.html#12232" class="InductiveConstructor">later</a> <a id="12334" href="slides.html#12283" class="Function">never</a>
</pre>
</section><section id="sized-types" class="slide level2">
<h2>Sized types</h2>
<p>Totality requirement: coinductive definitions should be <strong>productive</strong>: computing each observation should be terminating.</p>
<p>To ensure this, Agda checks that corecursive calls are <strong>guarded by constructors</strong>, but this is often quite limiting.</p>
<p>A more flexible and modular approach is to use <strong>sized types</strong>.</p>
</section><section id="the-type-size" class="slide level2">
<h2>The type <code>Size</code></h2>
<p><code>Size</code> ≃ abstract version of the natural numbers extended with <code>∞</code></p>
<p>For each <code>i : Size</code>, we have a type <code>Size&lt; i</code> of sizes <strong>smaller than <code>i</code></strong>.</p>
<p><strong>Note</strong>: pattern matching on <code>Size</code> is not allowed!</p>
</section><section id="the-sized-delay-monad" class="slide level2">
<h2>The sized delay monad</h2>
<!--
<pre class="agda-code"><a id="12927" class="Keyword">module</a> <a id="SizedTypes"></a><a id="12934" href="slides.html#12934" class="Module">SizedTypes</a> <a id="12945" class="Keyword">where</a>
  <a id="12953" class="Keyword">open</a> <a id="12958" class="Keyword">import</a> <a id="12965" href="Size.html" class="Module">Size</a>
</pre>-->
<pre class="agda-code">  <a id="12989" class="Keyword">mutual</a>
    <a id="13000" class="Keyword">record</a> <a id="SizedTypes.Delay"></a><a id="13007" href="slides.html#13007" class="Record">Delay</a> <a id="13013" class="Symbol">(</a><a id="13014" href="slides.html#13014" class="Bound">i</a> <a id="13016" class="Symbol">:</a> <a id="13018" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="13022" class="Symbol">)</a> <a id="13024" class="Symbol">(</a><a id="13025" href="slides.html#13025" class="Bound">A</a> <a id="13027" class="Symbol">:</a> <a id="13029" class="PrimitiveType">Set</a><a id="13032" class="Symbol">)</a> <a id="13034" class="Symbol">:</a> <a id="13036" class="PrimitiveType">Set</a> <a id="13040" class="Keyword">where</a>
      <a id="13052" class="Keyword">coinductive</a>
      <a id="13070" class="Keyword">constructor</a> <a id="SizedTypes.Delay.delay"></a><a id="13082" href="slides.html#13082" class="CoinductiveConstructor">delay</a>
      <a id="13094" class="Keyword">field</a>
        <a id="SizedTypes.Delay.force"></a><a id="13108" href="slides.html#13108" class="Field">force</a> <a id="13114" class="Symbol">:</a> <a id="13116" class="Symbol">{</a><a id="13117" href="slides.html#13117" class="Bound">j</a> <a id="13119" class="Symbol">:</a> <a id="13121" href="Agda.Builtin.Size.html#146" class="Postulate Operator">Size&lt;</a> <a id="13127" href="slides.html#13014" class="Bound">i</a><a id="13128" class="Symbol">}</a> <a id="13130" class="Symbol">→</a> <a id="13132" href="slides.html#13153" class="Datatype">Delay&#39;</a> <a id="13139" href="slides.html#13117" class="Bound">j</a> <a id="13141" href="slides.html#13025" class="Bound">A</a>

    <a id="13148" class="Keyword">data</a> <a id="SizedTypes.Delay&#39;"></a><a id="13153" href="slides.html#13153" class="Datatype">Delay&#39;</a> <a id="13160" class="Symbol">(</a><a id="13161" href="slides.html#13161" class="Bound">i</a> <a id="13163" class="Symbol">:</a> <a id="13165" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="13169" class="Symbol">)</a> <a id="13171" class="Symbol">(</a><a id="13172" href="slides.html#13172" class="Bound">A</a> <a id="13174" class="Symbol">:</a> <a id="13176" class="PrimitiveType">Set</a><a id="13179" class="Symbol">)</a> <a id="13181" class="Symbol">:</a> <a id="13183" class="PrimitiveType">Set</a> <a id="13187" class="Keyword">where</a>
      <a id="SizedTypes.Delay&#39;.return&#39;"></a><a id="13199" href="slides.html#13199" class="InductiveConstructor">return&#39;</a> <a id="13207" class="Symbol">:</a> <a id="13209" href="slides.html#13172" class="Bound">A</a>         <a id="13219" class="Symbol">→</a> <a id="13221" href="slides.html#13153" class="Datatype">Delay&#39;</a> <a id="13228" href="slides.html#13161" class="Bound">i</a> <a id="13230" href="slides.html#13172" class="Bound">A</a>
      <a id="SizedTypes.Delay&#39;.later&#39;"></a><a id="13238" href="slides.html#13238" class="InductiveConstructor">later&#39;</a>  <a id="13246" class="Symbol">:</a> <a id="13248" href="slides.html#13007" class="Record">Delay</a> <a id="13254" href="slides.html#13161" class="Bound">i</a> <a id="13256" href="slides.html#13172" class="Bound">A</a> <a id="13258" class="Symbol">→</a> <a id="13260" href="slides.html#13153" class="Datatype">Delay&#39;</a> <a id="13267" href="slides.html#13161" class="Bound">i</a> <a id="13269" href="slides.html#13172" class="Bound">A</a>
</pre>
<p><code>i</code> ≃ how many more steps are we allowed to observe.</p>
<p><code>Delay ∞ A</code> is the type of computations that can take <em>any</em> number of steps.</p>
</section><section id="interpreting-well-typed-while-programs" class="slide level2">
<h2>Interpreting well-typed WHILE programs</h2>
<p>WHILE statements can have two effects:</p>
<ul>
<li>Modify the environment ⇒ <code>State</code> monad</li>
<li>Go into a loop ⇒ <code>Delay</code> monad</li>
</ul>
<p>We combine both effects in the <code>Exec</code> monad.</p>
</section><section id="the-exec-monad" class="slide level2">
<h2>The <code>Exec</code> monad</h2>
<!--
<pre class="agda-code">  <a id="13659" class="Keyword">open</a> <a id="13664" class="Keyword">import</a> <a id="13671" href="Data.Unit.html" class="Module">Data.Unit</a>
  <a id="13683" class="Keyword">open</a> <a id="13688" class="Keyword">import</a> <a id="13695" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a>
  <a id="13715" class="Keyword">open</a> <a id="13720" href="slides.html#7924" class="Module">IndexedData</a>
  <a id="13734" class="Keyword">postulate</a>
    <a id="SizedTypes.Stm"></a><a id="13748" href="slides.html#13748" class="Postulate">Stm</a> <a id="13752" class="Symbol">:</a> <a id="13754" href="slides.html#8836" class="Function">Cxt</a> <a id="13758" class="Symbol">→</a> <a id="13760" class="PrimitiveType">Set</a>
    <a id="SizedTypes.Program"></a><a id="13768" href="slides.html#13768" class="Postulate">Program</a> <a id="13776" class="Symbol">:</a> <a id="13778" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="13801" class="Keyword">record</a> <a id="SizedTypes.Exec"></a><a id="13808" href="slides.html#13808" class="Record">Exec</a> <a id="13813" class="Symbol">{</a><a id="13814" href="slides.html#13814" class="Bound">Γ</a> <a id="13816" class="Symbol">:</a> <a id="13818" href="slides.html#8836" class="Function">Cxt</a><a id="13821" class="Symbol">}</a> <a id="13823" class="Symbol">(</a><a id="13824" href="slides.html#13824" class="Bound">i</a> <a id="13826" class="Symbol">:</a> <a id="13828" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="13832" class="Symbol">)</a> <a id="13834" class="Symbol">(</a><a id="13835" href="slides.html#13835" class="Bound">A</a> <a id="13837" class="Symbol">:</a> <a id="13839" class="PrimitiveType">Set</a><a id="13842" class="Symbol">)</a> <a id="13844" class="Symbol">:</a> <a id="13846" class="PrimitiveType">Set</a> <a id="13850" class="Keyword">where</a>
    <a id="13860" class="Keyword">field</a>
      <a id="SizedTypes.Exec.runExec"></a><a id="13872" href="slides.html#13872" class="Field">runExec</a> <a id="13880" class="Symbol">:</a> <a id="13882" class="Symbol">(</a><a id="13883" href="slides.html#13883" class="Bound">ρ</a> <a id="13885" class="Symbol">:</a> <a id="13887" href="slides.html#9575" class="Function">Env</a> <a id="13891" href="slides.html#13814" class="Bound">Γ</a><a id="13892" class="Symbol">)</a> <a id="13894" class="Symbol">→</a> <a id="13896" href="slides.html#13007" class="Record">Delay</a> <a id="13902" href="slides.html#13824" class="Bound">i</a> <a id="13904" class="Symbol">(</a><a id="13905" href="slides.html#13835" class="Bound">A</a> <a id="13907" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="13909" href="slides.html#9575" class="Function">Env</a> <a id="13913" href="slides.html#13814" class="Bound">Γ</a><a id="13914" class="Symbol">)</a>
  <a id="13918" class="Keyword">open</a> <a id="13923" href="slides.html#13808" class="Module">Exec</a> <a id="13928" class="Keyword">public</a>

  <a id="SizedTypes.execStm"></a><a id="13938" href="slides.html#13938" class="Function">execStm</a> <a id="13946" class="Symbol">:</a> <a id="13948" class="Symbol">∀</a> <a id="13950" class="Symbol">{</a><a id="13951" href="slides.html#13951" class="Bound">Γ</a><a id="13952" class="Symbol">}</a> <a id="13954" class="Symbol">{</a><a id="13955" href="slides.html#13955" class="Bound">i</a><a id="13956" class="Symbol">}</a> <a id="13958" class="Symbol">(</a><a id="13959" href="slides.html#13959" class="Bound">s</a> <a id="13961" class="Symbol">:</a> <a id="13963" href="slides.html#13748" class="Postulate">Stm</a> <a id="13967" href="slides.html#13951" class="Bound">Γ</a><a id="13968" class="Symbol">)</a> <a id="13970" class="Symbol">→</a> <a id="13972" href="slides.html#13808" class="Record">Exec</a> <a id="13977" class="Symbol">{</a><a id="13978" href="slides.html#13951" class="Bound">Γ</a><a id="13979" class="Symbol">}</a> <a id="13981" href="slides.html#13955" class="Bound">i</a> <a id="13983" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
  <a id="13987" href="slides.html#13938" class="Function">execStm</a> <a id="13995" class="Symbol">=</a> <a id="13997" href="slides.html#2563" class="Postulate">⋯</a>

  <a id="SizedTypes.execPrg"></a><a id="14002" href="slides.html#14002" class="Function">execPrg</a> <a id="14010" class="Symbol">:</a> <a id="14012" class="Symbol">∀</a> <a id="14014" class="Symbol">{</a><a id="14015" href="slides.html#14015" class="Bound">i</a><a id="14016" class="Symbol">}</a> <a id="14018" class="Symbol">(</a><a id="14019" href="slides.html#14019" class="Bound">prg</a> <a id="14023" class="Symbol">:</a> <a id="14025" href="slides.html#13768" class="Postulate">Program</a><a id="14032" class="Symbol">)</a> <a id="14034" class="Symbol">→</a> <a id="14036" href="slides.html#13007" class="Record">Delay</a> <a id="14042" href="slides.html#14015" class="Bound">i</a> <a id="14044" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
  <a id="14048" href="slides.html#14002" class="Function">execPrg</a> <a id="14056" href="slides.html#14056" class="Bound">prg</a> <a id="14060" class="Symbol">=</a> <a id="14062" href="slides.html#2563" class="Postulate">⋯</a>
</pre>
<p>See <code>Interpreter.agda</code> for full code</p>
</section><section id="exercise-5" class="slide level2">
<h2>Exercise #5</h2>
<p>Extend the interpreter with rules for the new syntactic constructions you added.</p>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'linear', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        height: 720,
        // Factor of the display size that should remain empty around the content
        margin: 0.2,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/math/math.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
