<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Andreas Abel and Jesper Cockx">
  <meta name="dcterms.date" content="2019-01-14">
  <title>Correct-by-construction programming in Agda</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/theme/black.css" id="theme">
  <link rel="stylesheet" href="Agda.css"/>
  <link rel="stylesheet" href="reveal.js/css/theme/white.css"/>
  <link rel="stylesheet" href="patchTheme.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css' : 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Correct-by-construction programming in Agda</h1>
  <p class="subtitle">Tutorial at POPL 2019</p>
  <p class="author">Andreas Abel and Jesper Cockx</p>
  <p class="date">14 January 2019</p>
</section>

<section><section id="introduction-to-agda" class="title-slide slide level1"><h1>Introduction to Agda</h1></section><section id="what-is-agda" class="slide level2">
<h2>What is Agda?</h2>
<p>Agda is…</p>
<ul>
<li>A strongly typed functional programming language in the tradition of Haskell</li>
<li>An interactive theorem prover in the tradition of Martin-Löf</li>
</ul>
</section><section id="installation" class="slide level2">
<h2>Installation</h2>
<p>For this tutorial, you will need to install <strong>Agda</strong>, the <strong>Agda standard library</strong>, and the <strong>BNFC</strong> tool.</p>
<ul>
<li>Agda: <a href="https://github.com/agda/agda">github.com/agda/agda</a></li>
<li>Agda standard library: <a href="https://github.com/agda/agda-stdlib">github.com/agda/agda-stdlib</a></li>
<li>BNFC: <a href="https://github.com/BNFC/bnfc">github.com/BNFC/bnfc</a></li>
</ul>
<p>Installation instructions:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">git</span> clone https://github.com/jespercockx/popl19-tutorial</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="bu">cd</span> popl19-tutorial</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ex">./setup.sh</span></a></code></pre></div>
</section><section id="main-features-of-agda" class="slide level2">
<h2>Main features of Agda</h2>
<ul>
<li>Dependent types</li>
<li>Indexed datatypes and dependent pattern matching</li>
<li>Termination checking and productivity checking</li>
<li>A universe hierachy with universe polymorphism</li>
<li>Record types with copattern matching</li>
<li>Coinductive datatypes</li>
<li>Sized types</li>
<li>Implicit arguments</li>
<li>Instance arguments (~ Haskell’s typeclasses)</li>
<li>Parametrized modules (~ ML functors)</li>
<li>A FFI to Haskell</li>
</ul>
<p>We will use many of these in the course of this tutorial!</p>
</section><section id="emacs-mode-for-agda" class="slide level2">
<h2>Emacs mode for Agda</h2>
<p>Programs may contain <strong>holes</strong> (<code>?</code> or <code>{! !}</code>).</p>
<ul>
<li><strong><code>C-c C-l</code></strong>: typecheck and highlight the current file</li>
<li><strong><code>C-c C-,</code></strong>: get information about the hole under the cursor</li>
<li><strong><code>C-c C-space</code></strong>: give a solution</li>
<li><strong><code>C-c C-r</code></strong>: <em>refine</em> the hole
<ul>
<li>Introduce a lambda or constructor</li>
<li>Apply given function to some new holes</li>
</ul></li>
<li><strong><code>C-c C-c</code></strong>: case split on a variable</li>
</ul>
</section></section>
<section><section id="correct-by-construction-programming" class="title-slide slide level1"><h1>Correct-by-construction programming</h1></section><section id="why-use-dependent-types" class="slide level2">
<h2>Why use dependent types?</h2>
<p>With dependent types, we can <strong>statically verify</strong> that a program satisfies a given correctness property.</p>
<p>Verification is <strong>built into</strong> the language itself.</p>
</section><section id="two-approaches-to-verification-with-dependent-types" class="slide level2">
<h2>Two approaches to verification with dependent types:</h2>
<ul>
<li><strong>Extrinsic approach</strong>: first write the program and then prove correctness</li>
<li><strong>Intrinsic approach</strong>: first define the <em>type</em> of programs that satisfy the correctness property and then write the program that inhabits this type</li>
</ul>
<p>The intrinsic approach is also called <strong>correct-by-construction</strong> programming.</p>
</section><section id="example-of-extrinsic-verification" class="slide level2">
<h2>Example of extrinsic verification</h2>
<!--
<pre class="agda-code"><a id="2409" class="Symbol">{-#</a> <a id="2413" class="Keyword">OPTIONS</a> <a id="2421" class="Pragma">--guardedness</a> <a id="2435" class="Pragma">--sized-types</a> <a id="2449" class="Symbol">#-}</a>

<a id="2454" class="Keyword">open</a> <a id="2459" class="Keyword">import</a> <a id="2466" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="2481" class="Keyword">using</a> <a id="2487" class="Symbol">(</a><a id="2488" href="Agda.Builtin.List.html#80" class="Datatype">List</a><a id="2492" class="Symbol">;</a> <a id="2494" href="Data.List.Base.html#8785" class="InductiveConstructor">[]</a><a id="2496" class="Symbol">;</a> <a id="2498" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">_∷_</a><a id="2501" class="Symbol">)</a>
<a id="2503" class="Keyword">open</a> <a id="2508" class="Keyword">import</a> <a id="2515" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="2531" class="Keyword">using</a> <a id="2537" class="Symbol">(</a><a id="2538" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a><a id="2543" class="Symbol">;</a> <a id="2545" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a><a id="2552" class="Symbol">;</a> <a id="2554" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a><a id="2558" class="Symbol">)</a>
<a id="2560" class="Keyword">open</a> <a id="2565" class="Keyword">import</a> <a id="2572" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="2586" class="Keyword">using</a> <a id="2592" class="Symbol">(</a><a id="2593" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="2594" class="Symbol">;</a> <a id="2596" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a><a id="2600" class="Symbol">;</a> <a id="2602" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a><a id="2605" class="Symbol">;</a> <a id="2607" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">_+_</a><a id="2610" class="Symbol">;</a> <a id="2612" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">_*_</a><a id="2615" class="Symbol">;</a> <a id="2617" href="Data.Nat.Base.html#955" class="Function Operator">_&lt;_</a><a id="2620" class="Symbol">)</a>
<a id="2622" class="Keyword">open</a> <a id="2627" class="Keyword">import</a> <a id="2634" href="Data.Product.html" class="Module">Data.Product</a> <a id="2647" class="Keyword">using</a> <a id="2653" class="Symbol">(</a><a id="2654" href="Data.Product.html#1353" class="Function Operator">_×_</a><a id="2657" class="Symbol">;</a> <a id="2659" href="Agda.Builtin.Sigma.html#168" class="InductiveConstructor Operator">_,_</a><a id="2662" class="Symbol">)</a>
<a id="2664" class="Keyword">open</a> <a id="2669" class="Keyword">import</a> <a id="2676" href="Agda.Builtin.Equality.html" class="Module">Agda.Builtin.Equality</a> <a id="2698" class="Keyword">using</a> <a id="2704" class="Symbol">(</a><a id="2705" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="2708" class="Symbol">;</a> <a id="2710" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="2714" class="Symbol">)</a>

<a id="2717" class="Keyword">postulate</a>
  <a id="⋯"></a><a id="2729" href="slides.html#2729" class="Postulate">⋯</a> <a id="2731" class="Symbol">:</a> <a id="2733" class="Symbol">∀</a> <a id="2735" class="Symbol">{</a><a id="2736" href="slides.html#2736" class="Bound">ℓ</a><a id="2737" class="Symbol">}</a> <a id="2739" class="Symbol">{</a><a id="2740" href="slides.html#2740" class="Bound">A</a> <a id="2742" class="Symbol">:</a> <a id="2744" class="PrimitiveType">Set</a> <a id="2748" href="slides.html#2736" class="Bound">ℓ</a><a id="2749" class="Symbol">}</a> <a id="2751" class="Symbol">→</a> <a id="2753" href="slides.html#2740" class="Bound">A</a>

<a id="2756" class="Keyword">module</a> <a id="Intro"></a><a id="2763" href="slides.html#2763" class="Module">Intro</a> <a id="2769" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">  <a id="2794" class="Keyword">module</a> <a id="Extrinsic"></a><a id="2801" href="slides.html#2801" class="Module">Extrinsic</a> <a id="2811" class="Keyword">where</a>
    <a id="Intro.Extrinsic._/_"></a><a id="2821" href="slides.html#2821" class="Function Operator">_/_</a> <a id="2825" class="Symbol">:</a> <a id="2827" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2829" class="Symbol">→</a> <a id="2831" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2833" class="Symbol">→</a> <a id="2835" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="2841" href="slides.html#2841" class="Bound">k</a> <a id="2843" href="slides.html#2821" class="Function Operator">/</a> <a id="2845" href="slides.html#2845" class="Bound">l</a> <a id="2847" class="Symbol">=</a> <a id="2849" href="slides.html#2729" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic._%_"></a><a id="2856" href="slides.html#2856" class="Function Operator">_%_</a> <a id="2860" class="Symbol">:</a> <a id="2862" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2864" class="Symbol">→</a> <a id="2866" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="2868" class="Symbol">→</a> <a id="2870" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="2876" href="slides.html#2876" class="Bound">k</a> <a id="2878" href="slides.html#2856" class="Function Operator">%</a> <a id="2880" href="slides.html#2880" class="Bound">l</a> <a id="2882" class="Symbol">=</a> <a id="2884" href="slides.html#2729" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic.divmod-lemma"></a><a id="2891" href="slides.html#2891" class="Function">divmod-lemma</a> <a id="2904" class="Symbol">:</a> <a id="2906" class="Symbol">∀</a> <a id="2908" class="Symbol">{</a><a id="2909" href="slides.html#2909" class="Bound">k</a> <a id="2911" href="slides.html#2911" class="Bound">l</a><a id="2912" class="Symbol">}</a> <a id="2914" class="Symbol">→</a> <a id="2916" href="slides.html#2911" class="Bound">l</a> <a id="2918" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">*</a> <a id="2920" class="Symbol">(</a><a id="2921" href="slides.html#2909" class="Bound">k</a> <a id="2923" href="slides.html#2821" class="Function Operator">/</a> <a id="2925" href="slides.html#2911" class="Bound">l</a><a id="2926" class="Symbol">)</a> <a id="2928" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="2930" href="slides.html#2909" class="Bound">k</a> <a id="2932" href="slides.html#2856" class="Function Operator">%</a> <a id="2934" href="slides.html#2911" class="Bound">l</a> <a id="2936" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="2938" href="slides.html#2909" class="Bound">k</a>
    <a id="2944" href="slides.html#2891" class="Function">divmod-lemma</a> <a id="2957" class="Symbol">=</a> <a id="2959" href="slides.html#2729" class="Postulate">⋯</a>

    <a id="Intro.Extrinsic.divmod-minimal"></a><a id="2966" href="slides.html#2966" class="Function">divmod-minimal</a> <a id="2981" class="Symbol">:</a> <a id="2983" class="Symbol">∀</a> <a id="2985" class="Symbol">{</a><a id="2986" href="slides.html#2986" class="Bound">k</a> <a id="2988" href="slides.html#2988" class="Bound">l</a><a id="2989" class="Symbol">}</a> <a id="2991" class="Symbol">→</a> <a id="2993" href="slides.html#2986" class="Bound">k</a> <a id="2995" href="slides.html#2856" class="Function Operator">%</a> <a id="2997" href="slides.html#2988" class="Bound">l</a> <a id="2999" href="Data.Nat.Base.html#955" class="Function Operator">&lt;</a> <a id="3001" href="slides.html#2988" class="Bound">l</a>
    <a id="3007" href="slides.html#2966" class="Function">divmod-minimal</a> <a id="3022" class="Symbol">=</a> <a id="3024" href="slides.html#2729" class="Postulate">⋯</a>
</pre>
</section><section id="example-of-intrinsic-verification" class="slide level2">
<h2>Example of intrinsic verification</h2>
<pre class="agda-code">  <a id="3079" class="Keyword">module</a> <a id="Intrinsic"></a><a id="3086" href="slides.html#3086" class="Module">Intrinsic</a> <a id="3096" class="Keyword">where</a>
    <a id="3106" class="Keyword">record</a> <a id="Intro.Intrinsic.Quotient"></a><a id="3113" href="slides.html#3113" class="Record">Quotient</a> <a id="3122" class="Symbol">(</a><a id="3123" href="slides.html#3123" class="Bound">k</a> <a id="3125" href="slides.html#3125" class="Bound">l</a> <a id="3127" class="Symbol">:</a> <a id="3129" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="3130" class="Symbol">)</a> <a id="3132" class="Symbol">:</a> <a id="3134" class="PrimitiveType">Set</a> <a id="3138" class="Keyword">where</a>
      <a id="3150" class="Keyword">field</a>
        <a id="Intro.Intrinsic.Quotient.q"></a><a id="3164" href="slides.html#3164" class="Field">q</a> <a id="Intro.Intrinsic.Quotient.r"></a><a id="3166" href="slides.html#3166" class="Field">r</a>     <a id="3172" class="Symbol">:</a> <a id="3174" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
        <a id="Intro.Intrinsic.Quotient.divmod"></a><a id="3184" href="slides.html#3184" class="Field">divmod</a>  <a id="3192" class="Symbol">:</a> <a id="3194" href="slides.html#3125" class="Bound">l</a> <a id="3196" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">*</a> <a id="3198" href="slides.html#3164" class="Field">q</a> <a id="3200" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="3202" href="slides.html#3166" class="Field">r</a> <a id="3204" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="3206" href="slides.html#3123" class="Bound">k</a>
        <a id="Intro.Intrinsic.Quotient.minimal"></a><a id="3216" href="slides.html#3216" class="Field">minimal</a> <a id="3224" class="Symbol">:</a> <a id="3226" href="slides.html#3166" class="Field">r</a> <a id="3228" href="Data.Nat.Base.html#955" class="Function Operator">&lt;</a> <a id="3230" href="slides.html#3125" class="Bound">l</a>

    <a id="Intro.Intrinsic.quotient"></a><a id="3237" href="slides.html#3237" class="Function">quotient</a> <a id="3246" class="Symbol">:</a> <a id="3248" class="Symbol">(</a><a id="3249" href="slides.html#3249" class="Bound">k</a> <a id="3251" href="slides.html#3251" class="Bound">l</a> <a id="3253" class="Symbol">:</a> <a id="3255" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="3256" class="Symbol">)</a> <a id="3258" class="Symbol">→</a> <a id="3260" href="slides.html#3113" class="Record">Quotient</a> <a id="3269" href="slides.html#3249" class="Bound">k</a> <a id="3271" href="slides.html#3251" class="Bound">l</a>
    <a id="3277" href="slides.html#3237" class="Function">quotient</a> <a id="3286" class="Symbol">=</a> <a id="3288" href="slides.html#2729" class="Postulate">⋯</a>

    <a id="Intro.Intrinsic._/_"></a><a id="3295" href="slides.html#3295" class="Function Operator">_/_</a> <a id="3299" class="Symbol">:</a> <a id="3301" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3303" class="Symbol">→</a> <a id="3305" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3307" class="Symbol">→</a> <a id="3309" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="3315" href="slides.html#3315" class="Bound">k</a> <a id="3317" href="slides.html#3295" class="Function Operator">/</a> <a id="3319" href="slides.html#3319" class="Bound">l</a> <a id="3321" class="Symbol">=</a> <a id="3323" href="slides.html#3164" class="Field">Quotient.q</a> <a id="3334" class="Symbol">(</a><a id="3335" href="slides.html#3237" class="Function">quotient</a> <a id="3344" href="slides.html#3315" class="Bound">k</a> <a id="3346" href="slides.html#3319" class="Bound">l</a><a id="3347" class="Symbol">)</a>

    <a id="Intro.Intrinsic._%_"></a><a id="3354" href="slides.html#3354" class="Function Operator">_%_</a> <a id="3358" class="Symbol">:</a> <a id="3360" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3362" class="Symbol">→</a> <a id="3364" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="3366" class="Symbol">→</a> <a id="3368" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
    <a id="3374" href="slides.html#3374" class="Bound">k</a> <a id="3376" href="slides.html#3354" class="Function Operator">%</a> <a id="3378" href="slides.html#3378" class="Bound">l</a> <a id="3380" class="Symbol">=</a> <a id="3382" href="slides.html#3166" class="Field">Quotient.r</a> <a id="3393" class="Symbol">(</a><a id="3394" href="slides.html#3237" class="Function">quotient</a> <a id="3403" href="slides.html#3374" class="Bound">k</a> <a id="3405" href="slides.html#3378" class="Bound">l</a><a id="3406" class="Symbol">)</a>
</pre>
</section><section id="correct-by-construction-programming-1" class="slide level2">
<h2>Correct-by-construction programming</h2>
<p>≠ verifying <em>all</em> properties we want</p>
<p>= verifying as many properties as we can get <em>for free</em></p>
</section><section id="goal-of-this-tutorial" class="slide level2">
<h2>Goal of this tutorial</h2>
<p>Implement a correct-by-construction <strong>typechecker</strong> + <strong>interpreter</strong> for a C-like language (WHILE)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="dt">int</span> main () {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="dt">int</span> n   = <span class="dv">100</span>;</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">int</span> sum = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">int</span> k   = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="cf">while</span> (n &gt; k) {</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    k   = k   + <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    sum = sum + k;</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  printInt(sum);</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a></code></pre></div>
</section><section id="structure-of-a-while-program" class="slide level2">
<h2>Structure of a WHILE program</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="dt">int</span> main () {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  type₁ var₁ = expr₁;</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  ...</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  typeₘ varₘ = exprₘ;</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  stmt₁</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  ...</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  stmtₙ</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  printInt(expr);</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">}</a></code></pre></div>
</section></section>
<section><section id="simple-data-types-and-pattern-matching" class="title-slide slide level1"><h1>Simple data types and pattern matching</h1></section><section id="some-simple-agda-datatypes" class="slide level2">
<h2>Some simple Agda datatypes</h2>
<!--
<pre class="agda-code"><a id="4060" class="Keyword">module</a> <a id="SimpleData"></a><a id="4067" href="slides.html#4067" class="Module">SimpleData</a> <a id="4078" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">  <a id="4103" class="Keyword">data</a> <a id="SimpleData.Bool"></a><a id="4108" href="slides.html#4108" class="Datatype">Bool</a> <a id="4113" class="Symbol">:</a> <a id="4115" class="PrimitiveType">Set</a> <a id="4119" class="Keyword">where</a>
    <a id="SimpleData.Bool.true"></a><a id="4129" href="slides.html#4129" class="InductiveConstructor">true</a> <a id="SimpleData.Bool.false"></a><a id="4134" href="slides.html#4134" class="InductiveConstructor">false</a> <a id="4140" class="Symbol">:</a> <a id="4142" href="slides.html#4108" class="Datatype">Bool</a>

  <a id="4150" class="Keyword">data</a> <a id="SimpleData.Nat"></a><a id="4155" href="slides.html#4155" class="Datatype">Nat</a> <a id="4159" class="Symbol">:</a> <a id="4161" class="PrimitiveType">Set</a> <a id="4165" class="Keyword">where</a>
    <a id="SimpleData.Nat.zero"></a><a id="4175" href="slides.html#4175" class="InductiveConstructor">zero</a> <a id="4180" class="Symbol">:</a> <a id="4182" href="slides.html#4155" class="Datatype">Nat</a>
    <a id="SimpleData.Nat.suc"></a><a id="4190" href="slides.html#4190" class="InductiveConstructor">suc</a>  <a id="4195" class="Symbol">:</a> <a id="4197" href="slides.html#4155" class="Datatype">Nat</a> <a id="4201" class="Symbol">→</a> <a id="4203" href="slides.html#4155" class="Datatype">Nat</a>

  <a id="4210" class="Keyword">data</a> <a id="SimpleData.Ord"></a><a id="4215" href="slides.html#4215" class="Datatype">Ord</a> <a id="4219" class="Symbol">:</a> <a id="4221" class="PrimitiveType">Set</a> <a id="4225" class="Keyword">where</a>
    <a id="SimpleData.Ord.zero"></a><a id="4235" href="slides.html#4235" class="InductiveConstructor">zero</a> <a id="4240" class="Symbol">:</a> <a id="4242" href="slides.html#4215" class="Datatype">Ord</a>
    <a id="SimpleData.Ord.suc"></a><a id="4250" href="slides.html#4250" class="InductiveConstructor">suc</a>  <a id="4255" class="Symbol">:</a> <a id="4257" href="slides.html#4215" class="Datatype">Ord</a> <a id="4261" class="Symbol">→</a> <a id="4263" href="slides.html#4215" class="Datatype">Ord</a>
    <a id="SimpleData.Ord.sup"></a><a id="4271" href="slides.html#4271" class="InductiveConstructor">sup</a>  <a id="4276" class="Symbol">:</a> <a id="4278" class="Symbol">(</a><a id="4279" href="slides.html#4155" class="Datatype">Nat</a> <a id="4283" class="Symbol">→</a> <a id="4285" href="slides.html#4215" class="Datatype">Ord</a><a id="4288" class="Symbol">)</a> <a id="4290" class="Symbol">→</a> <a id="4292" href="slides.html#4215" class="Datatype">Ord</a>

  <a id="4299" class="Keyword">data</a> <a id="SimpleData.⊥"></a><a id="4304" href="slides.html#4304" class="Datatype">⊥</a> <a id="4306" class="Symbol">:</a> <a id="4308" class="PrimitiveType">Set</a> <a id="4312" class="Keyword">where</a>
    <a id="4322" class="Comment">-- no constructors</a>
</pre>
</section><section id="pattern-matching-in-agda" class="slide level2">
<h2>Pattern matching in Agda</h2>
<pre class="agda-code">  <a id="SimpleData.not"></a><a id="4385" href="slides.html#4385" class="Function">not</a> <a id="4389" class="Symbol">:</a> <a id="4391" href="slides.html#4108" class="Datatype">Bool</a> <a id="4396" class="Symbol">→</a> <a id="4398" href="slides.html#4108" class="Datatype">Bool</a>
  <a id="4405" href="slides.html#4385" class="Function">not</a> <a id="4409" href="slides.html#4129" class="InductiveConstructor">true</a>  <a id="4415" class="Symbol">=</a> <a id="4417" href="slides.html#4134" class="InductiveConstructor">false</a>
  <a id="4425" href="slides.html#4385" class="Function">not</a> <a id="4429" href="slides.html#4134" class="InductiveConstructor">false</a> <a id="4435" class="Symbol">=</a> <a id="4437" href="slides.html#4129" class="InductiveConstructor">true</a>

  <a id="SimpleData.max"></a><a id="4445" href="slides.html#4445" class="Function">max</a> <a id="4449" class="Symbol">:</a> <a id="4451" href="slides.html#4155" class="Datatype">Nat</a> <a id="4455" class="Symbol">→</a> <a id="4457" href="slides.html#4155" class="Datatype">Nat</a> <a id="4461" class="Symbol">→</a> <a id="4463" href="slides.html#4155" class="Datatype">Nat</a>
  <a id="4469" href="slides.html#4445" class="Function">max</a> <a id="4473" href="slides.html#4175" class="InductiveConstructor">zero</a>    <a id="4481" href="slides.html#4481" class="Bound">l</a>       <a id="4489" class="Symbol">=</a> <a id="4491" href="slides.html#4481" class="Bound">l</a>
  <a id="4495" href="slides.html#4445" class="CatchallClause Function">max</a><a id="4498" class="CatchallClause"> </a><a id="4499" href="slides.html#4499" class="CatchallClause Bound">k</a><a id="4500" class="CatchallClause">       </a><a id="4507" href="slides.html#4175" class="CatchallClause InductiveConstructor">zero</a>    <a id="4515" class="Symbol">=</a> <a id="4517" href="slides.html#4499" class="Bound">k</a>
  <a id="4521" href="slides.html#4445" class="Function">max</a> <a id="4525" class="Symbol">(</a><a id="4526" href="slides.html#4190" class="InductiveConstructor">suc</a> <a id="4530" href="slides.html#4530" class="Bound">k</a><a id="4531" class="Symbol">)</a> <a id="4533" class="Symbol">(</a><a id="4534" href="slides.html#4190" class="InductiveConstructor">suc</a> <a id="4538" href="slides.html#4538" class="Bound">l</a><a id="4539" class="Symbol">)</a> <a id="4541" class="Symbol">=</a> <a id="4543" href="slides.html#4190" class="InductiveConstructor">suc</a> <a id="4547" class="Symbol">(</a><a id="4548" href="slides.html#4445" class="Function">max</a> <a id="4552" href="slides.html#4530" class="Bound">k</a> <a id="4554" href="slides.html#4538" class="Bound">l</a><a id="4555" class="Symbol">)</a>

  <a id="SimpleData.magic"></a><a id="4560" href="slides.html#4560" class="Function">magic</a> <a id="4566" class="Symbol">:</a> <a id="4568" class="Symbol">{</a><a id="4569" href="slides.html#4569" class="Bound">A</a> <a id="4571" class="Symbol">:</a> <a id="4573" class="PrimitiveType">Set</a><a id="4576" class="Symbol">}</a> <a id="4578" class="Symbol">→</a> <a id="4580" href="slides.html#4304" class="Datatype">⊥</a> <a id="4582" class="Symbol">→</a> <a id="4584" href="slides.html#4569" class="Bound">A</a>
  <a id="4588" href="slides.html#4560" class="Function">magic</a> <a id="4594" class="Symbol">()</a>
</pre>
</section><section id="type-and-expression-syntax-for-while" class="slide level2">
<h2>Type and expression syntax for WHILE</h2>
<!--
<pre class="agda-code">  <a id="4658" class="Keyword">postulate</a>
    <a id="SimpleData.Id"></a><a id="4672" href="slides.html#4672" class="Postulate">Id</a> <a id="SimpleData.ℤ"></a><a id="4675" href="slides.html#4675" class="Postulate">ℤ</a> <a id="SimpleData.Boolean"></a><a id="4677" href="slides.html#4677" class="Postulate">Boolean</a> <a id="4685" class="Symbol">:</a> <a id="4687" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="4710" class="Keyword">data</a> <a id="SimpleData.Type"></a><a id="4715" href="slides.html#4715" class="Datatype">Type</a> <a id="4720" class="Symbol">:</a> <a id="4722" class="PrimitiveType">Set</a> <a id="4726" class="Keyword">where</a>
    <a id="SimpleData.Type.bool"></a><a id="4736" href="slides.html#4736" class="InductiveConstructor">bool</a> <a id="SimpleData.Type.int"></a><a id="4741" href="slides.html#4741" class="InductiveConstructor">int</a> <a id="4745" class="Symbol">:</a> <a id="4747" href="slides.html#4715" class="Datatype">Type</a>              <a id="4765" class="Comment">-- t ::= bool | int</a>

  <a id="4788" class="Keyword">data</a> <a id="SimpleData.Exp"></a><a id="4793" href="slides.html#4793" class="Datatype">Exp</a> <a id="4797" class="Symbol">:</a> <a id="4799" class="PrimitiveType">Set</a> <a id="4803" class="Keyword">where</a>
    <a id="SimpleData.Exp.eId"></a><a id="4813" href="slides.html#4813" class="InductiveConstructor">eId</a>   <a id="4819" class="Symbol">:</a> <a id="4821" class="Symbol">(</a><a id="4822" href="slides.html#4822" class="Bound">x</a> <a id="4824" class="Symbol">:</a> <a id="4826" href="slides.html#4672" class="Postulate">Id</a><a id="4828" class="Symbol">)</a>      <a id="4835" class="Symbol">→</a> <a id="4837" href="slides.html#4793" class="Datatype">Exp</a>  <a id="4842" class="Comment">-- x,y,z,...</a>
    <a id="SimpleData.Exp.eInt"></a><a id="4859" href="slides.html#4859" class="InductiveConstructor">eInt</a>  <a id="4865" class="Symbol">:</a> <a id="4867" class="Symbol">(</a><a id="4868" href="slides.html#4868" class="Bound">i</a> <a id="4870" class="Symbol">:</a> <a id="4872" href="slides.html#4675" class="Postulate">ℤ</a><a id="4873" class="Symbol">)</a>       <a id="4881" class="Symbol">→</a> <a id="4883" href="slides.html#4793" class="Datatype">Exp</a>  <a id="4888" class="Comment">-- ...-2,-1,0,1,2...</a>
    <a id="SimpleData.Exp.eBool"></a><a id="4913" href="slides.html#4913" class="InductiveConstructor">eBool</a> <a id="4919" class="Symbol">:</a> <a id="4921" class="Symbol">(</a><a id="4922" href="slides.html#4922" class="Bound">b</a> <a id="4924" class="Symbol">:</a> <a id="4926" href="slides.html#4677" class="Postulate">Boolean</a><a id="4933" class="Symbol">)</a> <a id="4935" class="Symbol">→</a> <a id="4937" href="slides.html#4793" class="Datatype">Exp</a>  <a id="4942" class="Comment">-- true or false</a>
    <a id="SimpleData.Exp.ePlus"></a><a id="4963" href="slides.html#4963" class="InductiveConstructor">ePlus</a> <a id="4969" class="Symbol">:</a> <a id="4971" class="Symbol">(</a><a id="4972" href="slides.html#4972" class="Bound">e</a> <a id="4974" href="slides.html#4974" class="Bound">e&#39;</a> <a id="4977" class="Symbol">:</a> <a id="4979" href="slides.html#4793" class="Datatype">Exp</a><a id="4982" class="Symbol">)</a>  <a id="4985" class="Symbol">→</a> <a id="4987" href="slides.html#4793" class="Datatype">Exp</a>  <a id="4992" class="Comment">-- e+e&#39;</a>
    <a id="SimpleData.Exp.eGt"></a><a id="5004" href="slides.html#5004" class="InductiveConstructor">eGt</a>   <a id="5010" class="Symbol">:</a> <a id="5012" class="Symbol">(</a><a id="5013" href="slides.html#5013" class="Bound">e</a> <a id="5015" href="slides.html#5015" class="Bound">e&#39;</a> <a id="5018" class="Symbol">:</a> <a id="5020" href="slides.html#4793" class="Datatype">Exp</a><a id="5023" class="Symbol">)</a>  <a id="5026" class="Symbol">→</a> <a id="5028" href="slides.html#4793" class="Datatype">Exp</a>  <a id="5033" class="Comment">-- e&gt;e&#39;</a>
    <a id="SimpleData.Exp.eAnd"></a><a id="5045" href="slides.html#5045" class="InductiveConstructor">eAnd</a>  <a id="5051" class="Symbol">:</a> <a id="5053" class="Symbol">(</a><a id="5054" href="slides.html#5054" class="Bound">e</a> <a id="5056" href="slides.html#5056" class="Bound">e&#39;</a> <a id="5059" class="Symbol">:</a> <a id="5061" href="slides.html#4793" class="Datatype">Exp</a><a id="5064" class="Symbol">)</a>  <a id="5067" class="Symbol">→</a> <a id="5069" href="slides.html#4793" class="Datatype">Exp</a>  <a id="5074" class="Comment">-- e&amp;&amp;e&#39;</a>
</pre>
</section><section id="statement-syntax-for-while" class="slide level2">
<h2>Statement syntax for WHILE</h2>
<pre class="agda-code">  <a id="5129" class="Keyword">data</a> <a id="SimpleData.Stm"></a><a id="5134" href="slides.html#5134" class="Datatype">Stm</a> <a id="5138" class="Symbol">:</a> <a id="5140" class="PrimitiveType">Set</a> <a id="5144" class="Keyword">where</a>
    <a id="SimpleData.Stm.sAss"></a><a id="5154" href="slides.html#5154" class="InductiveConstructor">sAss</a>   <a id="5161" class="Symbol">:</a> <a id="5163" class="Symbol">(</a><a id="5164" href="slides.html#5164" class="Bound">x</a> <a id="5166" class="Symbol">:</a> <a id="5168" href="slides.html#4672" class="Postulate">Id</a><a id="5170" class="Symbol">)</a> <a id="5172" class="Symbol">(</a><a id="5173" href="slides.html#5173" class="Bound">e</a> <a id="5175" class="Symbol">:</a> <a id="5177" href="slides.html#4793" class="Datatype">Exp</a><a id="5180" class="Symbol">)</a>        <a id="5189" class="Symbol">→</a> <a id="5191" href="slides.html#5134" class="Datatype">Stm</a>
      <a id="5201" class="Comment">-- ^ x = e;</a>
    <a id="SimpleData.Stm.sWhile"></a><a id="5217" href="slides.html#5217" class="InductiveConstructor">sWhile</a> <a id="5224" class="Symbol">:</a> <a id="5226" class="Symbol">(</a><a id="5227" href="slides.html#5227" class="Bound">e</a> <a id="5229" class="Symbol">:</a> <a id="5231" href="slides.html#4793" class="Datatype">Exp</a><a id="5234" class="Symbol">)</a> <a id="5236" class="Symbol">(</a><a id="5237" href="slides.html#5237" class="Bound">ss</a> <a id="5240" class="Symbol">:</a> <a id="5242" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5247" href="slides.html#5134" class="Datatype">Stm</a><a id="5250" class="Symbol">)</a> <a id="5252" class="Symbol">→</a> <a id="5254" href="slides.html#5134" class="Datatype">Stm</a>
      <a id="5264" class="Comment">-- ^ while (b) { ... }</a>
</pre>
</section><section id="program-syntax-for-while" class="slide level2">
<h2>Program syntax for WHILE</h2>
<pre class="agda-code">  <a id="5331" class="Keyword">record</a> <a id="SimpleData.Decl"></a><a id="5338" href="slides.html#5338" class="Record">Decl</a> <a id="5343" class="Symbol">:</a> <a id="5345" class="PrimitiveType">Set</a> <a id="5349" class="Keyword">where</a>
    <a id="5359" class="Keyword">constructor</a> <a id="SimpleData.Decl.dInit"></a><a id="5371" href="slides.html#5371" class="InductiveConstructor">dInit</a>   <a id="5379" class="Comment">-- t x = e;</a>
    <a id="5395" class="Keyword">field</a>
      <a id="SimpleData.Decl.declType"></a><a id="5407" href="slides.html#5407" class="Field">declType</a> <a id="5416" class="Symbol">:</a> <a id="5418" href="slides.html#4715" class="Datatype">Type</a>   <a id="5425" class="Comment">-- variable type (t)</a>
      <a id="SimpleData.Decl.declId"></a><a id="5452" href="slides.html#5452" class="Field">declId</a>   <a id="5461" class="Symbol">:</a> <a id="5463" href="slides.html#4672" class="Postulate">Id</a>     <a id="5470" class="Comment">-- variable name (x)</a>
      <a id="SimpleData.Decl.declExp"></a><a id="5497" href="slides.html#5497" class="Field">declExp</a>  <a id="5506" class="Symbol">:</a> <a id="5508" href="slides.html#4793" class="Datatype">Exp</a>    <a id="5515" class="Comment">-- initial value (e)</a>
  <a id="5538" class="Keyword">open</a> <a id="5543" href="slides.html#5338" class="Module">Decl</a> <a id="5548" class="Keyword">public</a>

  <a id="5558" class="Keyword">record</a> <a id="SimpleData.Program"></a><a id="5565" href="slides.html#5565" class="Record">Program</a> <a id="5573" class="Symbol">:</a> <a id="5575" class="PrimitiveType">Set</a> <a id="5579" class="Keyword">where</a>
    <a id="5589" class="Keyword">constructor</a> <a id="SimpleData.Program.program"></a><a id="5601" href="slides.html#5601" class="InductiveConstructor">program</a>
    <a id="5613" class="Keyword">field</a>
      <a id="SimpleData.Program.theDecls"></a><a id="5625" href="slides.html#5625" class="Field">theDecls</a> <a id="5634" class="Symbol">:</a> <a id="5636" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5641" href="slides.html#5338" class="Record">Decl</a>  <a id="5647" class="Comment">-- t x = e; ...</a>
      <a id="SimpleData.Program.theStms"></a><a id="5669" href="slides.html#5669" class="Field">theStms</a>  <a id="5678" class="Symbol">:</a> <a id="5680" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5685" href="slides.html#5134" class="Datatype">Stm</a>   <a id="5691" class="Comment">-- ss</a>
      <a id="SimpleData.Program.theMain"></a><a id="5703" href="slides.html#5703" class="Field">theMain</a>  <a id="5712" class="Symbol">:</a> <a id="5714" href="slides.html#4793" class="Datatype">Exp</a>        <a id="5725" class="Comment">-- printInt(e);</a>
  <a id="5743" class="Keyword">open</a> <a id="5748" href="slides.html#5565" class="Module">Program</a> <a id="5756" class="Keyword">public</a>
</pre>
</section><section id="untyped-interpreter" class="slide level2">
<h2>Untyped interpreter</h2>
<p>File <code>UntypedInterpreter.agda</code> defines an <em>untyped</em> interpreter for WHILE:</p>
<pre class="agda-code">  <a id="5878" class="Keyword">data</a> <a id="SimpleData.Val"></a><a id="5883" href="slides.html#5883" class="Datatype">Val</a> <a id="5887" class="Symbol">:</a> <a id="5889" class="PrimitiveType">Set</a> <a id="5893" class="Keyword">where</a>
    <a id="SimpleData.Val.intV"></a><a id="5903" href="slides.html#5903" class="InductiveConstructor">intV</a>  <a id="5909" class="Symbol">:</a> <a id="5911" href="slides.html#4675" class="Postulate">ℤ</a>       <a id="5919" class="Symbol">→</a> <a id="5921" href="slides.html#5883" class="Datatype">Val</a>
    <a id="SimpleData.Val.boolV"></a><a id="5929" href="slides.html#5929" class="InductiveConstructor">boolV</a> <a id="5935" class="Symbol">:</a> <a id="5937" href="slides.html#4677" class="Postulate">Boolean</a> <a id="5945" class="Symbol">→</a> <a id="5947" href="slides.html#5883" class="Datatype">Val</a>

  <a id="SimpleData.Env"></a><a id="5954" href="slides.html#5954" class="Function">Env</a> <a id="5958" class="Symbol">:</a> <a id="5960" class="PrimitiveType">Set</a>
  <a id="5966" href="slides.html#5954" class="Function">Env</a> <a id="5970" class="Symbol">=</a> <a id="5972" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="5977" class="Symbol">(</a><a id="5978" href="slides.html#4672" class="Postulate">Id</a> <a id="5981" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="5983" href="slides.html#5883" class="Datatype">Val</a><a id="5986" class="Symbol">)</a>

  <a id="SimpleData.eval"></a><a id="5991" href="slides.html#5991" class="Function">eval</a> <a id="5996" class="Symbol">:</a> <a id="5998" href="slides.html#5954" class="Function">Env</a> <a id="6002" class="Symbol">→</a> <a id="6004" href="slides.html#4793" class="Datatype">Exp</a> <a id="6008" class="Symbol">→</a> <a id="6010" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6016" href="slides.html#5883" class="Datatype">Val</a>
  <a id="6022" href="slides.html#5991" class="Function">eval</a> <a id="6027" href="slides.html#6027" class="Bound">ρ</a> <a id="6029" href="slides.html#6029" class="Bound">e</a> <a id="6031" class="Symbol">=</a> <a id="6033" href="slides.html#2729" class="Postulate">⋯</a>

  <a id="SimpleData.execDecl"></a><a id="6038" href="slides.html#6038" class="Function">execDecl</a> <a id="6047" class="Symbol">:</a> <a id="6049" href="slides.html#5338" class="Record">Decl</a> <a id="6054" class="Symbol">→</a> <a id="6056" href="slides.html#5954" class="Function">Env</a> <a id="6060" class="Symbol">→</a> <a id="6062" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6068" href="slides.html#5954" class="Function">Env</a>
  <a id="6074" href="slides.html#6038" class="Function">execDecl</a> <a id="6083" href="slides.html#6083" class="Bound">d</a> <a id="6085" href="slides.html#6085" class="Bound">ρ</a> <a id="6087" class="Symbol">=</a> <a id="6089" href="slides.html#2729" class="Postulate">⋯</a>
</pre>
</section><section id="untyped-interpreter-continued" class="slide level2">
<h2>Untyped interpreter (continued)</h2>
<p>All Agda functions must be <strong>total</strong></p>
<p>But WHILE programs can loop!</p>
<p>⇒ we must limit the number of times we repeat the loop</p>
<pre class="agda-code">  <a id="SimpleData.execStm"></a><a id="6266" href="slides.html#6266" class="Function">execStm</a> <a id="6274" class="Symbol">:</a> <a id="6276" class="Symbol">(</a><a id="6277" href="slides.html#6277" class="Bound">fuel</a> <a id="6282" class="Symbol">:</a> <a id="6284" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="6285" class="Symbol">)</a> <a id="6287" class="Symbol">→</a> <a id="6289" href="slides.html#5134" class="Datatype">Stm</a> <a id="6293" class="Symbol">→</a> <a id="6295" href="slides.html#5954" class="Function">Env</a> <a id="6299" class="Symbol">→</a> <a id="6301" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6307" href="slides.html#5954" class="Function">Env</a>
  <a id="6313" href="slides.html#6266" class="Function">execStm</a> <a id="6321" href="slides.html#6321" class="Bound">fuel</a> <a id="6326" href="slides.html#6326" class="Bound">stm</a> <a id="6330" href="slides.html#6330" class="Bound">ρ</a> <a id="6332" class="Symbol">=</a> <a id="6334" href="slides.html#2729" class="Postulate">⋯</a>

  <a id="SimpleData.evalPrg"></a><a id="6339" href="slides.html#6339" class="Function">evalPrg</a> <a id="6347" class="Symbol">:</a> <a id="6349" class="Symbol">(</a><a id="6350" href="slides.html#6350" class="Bound">fuel</a> <a id="6355" class="Symbol">:</a> <a id="6357" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="6358" class="Symbol">)</a> <a id="6360" class="Symbol">→</a> <a id="6362" href="slides.html#5565" class="Record">Program</a> <a id="6370" class="Symbol">→</a> <a id="6372" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="6378" href="slides.html#4675" class="Postulate">ℤ</a>
  <a id="6382" href="slides.html#6339" class="Function">evalPrg</a> <a id="6390" href="slides.html#6390" class="Bound">fuel</a> <a id="6395" class="Symbol">(</a><a id="6396" href="slides.html#5601" class="InductiveConstructor">program</a> <a id="6404" href="slides.html#6404" class="Bound">ds</a> <a id="6407" href="slides.html#6407" class="Bound">ss</a> <a id="6410" href="slides.html#6410" class="Bound">e</a><a id="6411" class="Symbol">)</a> <a id="6413" class="Symbol">=</a> <a id="6415" href="slides.html#2729" class="Postulate">⋯</a>
</pre>
</section><section id="exercise-1" class="slide level2">
<h2>Exercise #1</h2>
<p>Go to <code>AST.agda</code> and extend the syntax with one or more of the following:</p>
<ul>
<li>Boolean negation: <code>!e</code></li>
<li>Integer subtraction: <code>e₁-e₂</code></li>
<li>Conditionals: <code class="sourceCode c"><span class="cf">if</span> (e) { ss₁ } <span class="cf">else</span> { ss₂ }</code></li>
</ul>
<p>Ignore the pragmas <code>{-# COMPILE ... #-}</code> for now.</p>
<p>Also go to <code>UntypedInterpreter.agda</code> and add the missing cases!</p>
</section></section>
<section><section id="haskell-ffi" class="title-slide slide level1"><h1>Haskell FFI</h1></section><section id="haskell-ffi-basics" class="slide level2">
<h2>Haskell FFI: basics</h2>
<!--
<pre class="agda-code"><a id="6788" class="Keyword">module</a> <a id="FFI"></a><a id="6795" href="slides.html#6795" class="Module">FFI</a> <a id="6799" class="Keyword">where</a>
</pre>-->
<p>Import a Haskell module:</p>
<pre class="agda-code">  <a id="6850" class="Symbol">{-#</a> <a id="6854" class="Keyword">FOREIGN</a> <a id="6862" class="Pragma">GHC</a> <a id="6866" class="Pragma">import</a> <a id="6873" class="Pragma">HaskellModule.hs</a> <a id="6890" class="Symbol">#-}</a>
</pre>
<p>Bind Haskell function to Agda name:</p>
<!--
<pre class="agda-code">  <a id="6947" class="Keyword">postulate</a> <a id="FFI.AgdaType"></a><a id="6957" href="slides.html#6957" class="Postulate">AgdaType</a> <a id="6966" class="Symbol">:</a> <a id="6968" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="6991" class="Keyword">postulate</a> <a id="FFI.agdaName"></a><a id="7001" href="slides.html#7001" class="Postulate">agdaName</a> <a id="7010" class="Symbol">:</a> <a id="7012" href="slides.html#6957" class="Postulate">AgdaType</a>
  <a id="7023" class="Symbol">{-#</a> <a id="7027" class="Keyword">COMPILE</a> <a id="7035" class="Pragma">GHC</a> <a id="7039" href="slides.html#7001" class="Postulate">agdaName</a> <a id="7048" class="Pragma">=</a> <a id="7050" class="Pragma">haskellCode</a> <a id="7062" class="Symbol">#-}</a>
</pre>
<p>Bind Haskell datatype to Agda datatype:</p>
<pre class="agda-code">  <a id="7118" class="Keyword">data</a> <a id="FFI.D"></a><a id="7123" href="slides.html#7123" class="Datatype">D</a> <a id="7125" class="Symbol">:</a> <a id="7127" class="PrimitiveType">Set</a> <a id="7131" class="Keyword">where</a> <a id="FFI.D.c₁"></a><a id="7137" href="slides.html#7137" class="InductiveConstructor">c₁</a> <a id="FFI.D.c₂"></a><a id="7140" href="slides.html#7140" class="InductiveConstructor">c₂</a> <a id="7143" class="Symbol">:</a> <a id="7145" href="slides.html#7123" class="Datatype">D</a>
  <a id="7149" class="Symbol">{-#</a> <a id="7153" class="Keyword">COMPILE</a> <a id="7161" class="Pragma">GHC</a> <a id="7165" href="slides.html#7123" class="Datatype">D</a> <a id="7167" class="Pragma">=</a> <a id="7169" class="Pragma">data</a> <a id="7174" class="Pragma">hsData</a> <a id="7181" class="Pragma">(hsCon₁</a> <a id="7189" class="Pragma">|</a> <a id="7191" class="Pragma">hsCon₂)</a> <a id="7199" class="Symbol">#-}</a>
</pre>
</section><section id="haskell-ffi-example" class="slide level2">
<h2>Haskell FFI example:</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1">  <span class="co">-- In file `While/Abs.hs`:</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw">data</span> <span class="dt">Type</span> <span class="fu">=</span> <span class="dt">TBool</span> <span class="fu">|</span> <span class="dt">TInt</span></a></code></pre></div>
<pre class="agda-code">  <a id="7314" class="Comment">-- In file `AST.agda`:</a>
  <a id="7339" class="Symbol">{-#</a> <a id="7343" class="Keyword">FOREIGN</a> <a id="7351" class="Pragma">GHC</a> <a id="7355" class="Pragma">import</a> <a id="7362" class="Pragma">While.Abs</a> <a id="7372" class="Symbol">#-}</a>
  <a id="7378" class="Keyword">data</a> <a id="FFI.Type"></a><a id="7383" href="slides.html#7383" class="Datatype">Type</a> <a id="7388" class="Symbol">:</a> <a id="7390" class="PrimitiveType">Set</a> <a id="7394" class="Keyword">where</a>
    <a id="FFI.Type.bool"></a><a id="7404" href="slides.html#7404" class="InductiveConstructor">bool</a> <a id="FFI.Type.int"></a><a id="7409" href="slides.html#7409" class="InductiveConstructor">int</a> <a id="7413" class="Symbol">:</a> <a id="7415" href="slides.html#7383" class="Datatype">Type</a>

  <a id="7423" class="Symbol">{-#</a> <a id="7427" class="Keyword">COMPILE</a> <a id="7435" class="Pragma">GHC</a> <a id="7439" href="slides.html#7383" class="Datatype">Type</a> <a id="7444" class="Pragma">=</a> <a id="7446" class="Pragma">data</a> <a id="7451" class="Pragma">Type</a>
    <a id="7460" class="Pragma">(</a> <a id="7462" class="Pragma">TBool</a>
    <a id="7472" class="Pragma">|</a> <a id="7474" class="Pragma">TInt</a>
    <a id="7483" class="Pragma">)</a> <a id="7485" class="Symbol">#-}</a>
</pre>
</section><section id="bnfc-the-backus-naur-form-compiler" class="slide level2">
<h2>BNFC: the Backus-Naur Form Compiler</h2>
<p>BNFC is a Haskell library for generating Haskell code from a grammar:</p>
<ul>
<li>Datatypes for abstract syntax</li>
<li>Parser</li>
<li>Pretty-printer</li>
</ul>
<p>See <code>While.cf</code> for the grammar of WHILE.</p>
</section><section id="exercise-2" class="slide level2">
<h2>Exercise #2</h2>
<p>Extend the BNFC grammar with the new syntactic constructions you added.</p>
<p>Don’t forget to update the Haskell bindings in <code>AST.agda</code>!</p>
<p>Testing the grammar: <code>make parser</code> will compile the parser and run it on <code>/test/gcd.c</code>.</p>
</section></section>
<section><section id="dependent-types-and-indexed-datatypes" class="title-slide slide level1"><h1>Dependent types and indexed datatypes</h1></section><section id="indexed-datatypes" class="slide level2">
<h2>Indexed datatypes</h2>
<p><strong>Indexed datatype</strong> = family of datatypes indexed over some base type</p>
<!--
<pre class="agda-code"><a id="8092" class="Keyword">module</a> <a id="IndexedData"></a><a id="8099" href="slides.html#8099" class="Module">IndexedData</a> <a id="8111" class="Keyword">where</a>
  <a id="8119" class="Keyword">open</a> <a id="8124" class="Keyword">import</a> <a id="8131" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
  <a id="8147" class="Keyword">open</a> <a id="8152" class="Keyword">import</a> <a id="8159" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="8177" class="Keyword">using</a> <a id="8183" class="Symbol">(</a><a id="8184" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a><a id="8185" class="Symbol">)</a>
  <a id="8189" class="Keyword">open</a> <a id="8194" class="Keyword">import</a> <a id="8201" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="8236" class="Keyword">using</a> <a id="8242" class="Symbol">(</a><a id="8243" href="Data.List.Membership.Setoid.html#709" class="Function Operator">_∈_</a><a id="8246" class="Symbol">;</a> <a id="8248" href="Data.List.Membership.Setoid.html#758" class="Function Operator">_∉_</a><a id="8251" class="Symbol">)</a>
  <a id="8255" class="Keyword">open</a> <a id="8260" class="Keyword">import</a> <a id="8267" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="8281" class="Keyword">using</a> <a id="8287" class="Symbol">(</a><a id="8288" href="Data.List.All.html#826" class="Datatype">All</a><a id="8291" class="Symbol">;</a> <a id="8293" href="Data.List.All.html#904" class="InductiveConstructor">[]</a><a id="8295" class="Symbol">;</a> <a id="8297" href="Data.List.All.html#921" class="InductiveConstructor Operator">_∷_</a><a id="8300" class="Symbol">)</a> <a id="8302" class="Keyword">hiding</a> <a id="8309" class="Symbol">(</a><a id="8310" class="Keyword">module</a> <a id="8317" href="Data.List.All.html#826" class="Module">All</a><a id="8320" class="Symbol">)</a>
  <a id="8324" class="Keyword">open</a> <a id="8329" href="slides.html#6795" class="Module">FFI</a> <a id="8333" class="Keyword">using</a> <a id="8339" class="Symbol">(</a><a id="8340" href="slides.html#7383" class="Datatype">Type</a><a id="8344" class="Symbol">;</a> <a id="8346" href="slides.html#7409" class="InductiveConstructor">int</a><a id="8349" class="Symbol">;</a> <a id="8351" href="slides.html#7404" class="InductiveConstructor">bool</a><a id="8355" class="Symbol">)</a>

  <a id="8360" class="Keyword">data</a> <a id="IndexedData.Boolean"></a><a id="8365" href="slides.html#8365" class="Datatype">Boolean</a> <a id="8373" class="Symbol">:</a> <a id="8375" class="PrimitiveType">Set</a> <a id="8379" class="Keyword">where</a> <a id="IndexedData.Boolean.BTrue"></a><a id="8385" href="slides.html#8385" class="InductiveConstructor">BTrue</a> <a id="IndexedData.Boolean.BFalse"></a><a id="8391" href="slides.html#8391" class="InductiveConstructor">BFalse</a> <a id="8398" class="Symbol">:</a> <a id="8400" href="slides.html#8365" class="Datatype">Boolean</a>
</pre>-->
<pre class="agda-code">  <a id="8427" class="Keyword">data</a> <a id="IndexedData.Vec"></a><a id="8432" href="slides.html#8432" class="Datatype">Vec</a> <a id="8436" class="Symbol">(</a><a id="8437" href="slides.html#8437" class="Bound">A</a> <a id="8439" class="Symbol">:</a> <a id="8441" class="PrimitiveType">Set</a><a id="8444" class="Symbol">)</a> <a id="8446" class="Symbol">:</a> <a id="8448" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="8450" class="Symbol">→</a> <a id="8452" class="PrimitiveType">Set</a> <a id="8456" class="Keyword">where</a>
    <a id="IndexedData.Vec.[]"></a><a id="8466" href="slides.html#8466" class="InductiveConstructor">[]</a>  <a id="8470" class="Symbol">:</a> <a id="8472" href="slides.html#8432" class="Datatype">Vec</a> <a id="8476" href="slides.html#8437" class="Bound">A</a> <a id="8478" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a>
    <a id="IndexedData.Vec._∷_"></a><a id="8487" href="slides.html#8487" class="InductiveConstructor Operator">_∷_</a> <a id="8491" class="Symbol">:</a> <a id="8493" class="Symbol">{</a><a id="8494" href="slides.html#8494" class="Bound">n</a> <a id="8496" class="Symbol">:</a> <a id="8498" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8499" class="Symbol">}</a> <a id="8501" class="Symbol">→</a> <a id="8503" href="slides.html#8437" class="Bound">A</a> <a id="8505" class="Symbol">→</a> <a id="8507" href="slides.html#8432" class="Datatype">Vec</a> <a id="8511" href="slides.html#8437" class="Bound">A</a> <a id="8513" href="slides.html#8494" class="Bound">n</a> <a id="8515" class="Symbol">→</a> <a id="8517" href="slides.html#8432" class="Datatype">Vec</a> <a id="8521" href="slides.html#8437" class="Bound">A</a> <a id="8523" class="Symbol">(</a><a id="8524" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="8528" href="slides.html#8494" class="Bound">n</a><a id="8529" class="Symbol">)</a>
</pre>
<p>(like GADTs in Haskell/Ocaml)</p>
</section><section id="dependent-pattern-matching" class="slide level2">
<h2>Dependent pattern matching</h2>
<pre class="agda-code">  <a id="IndexedData._++_"></a><a id="8607" href="slides.html#8607" class="Function Operator">_++_</a> <a id="8612" class="Symbol">:</a> <a id="8614" class="Symbol">{</a><a id="8615" href="slides.html#8615" class="Bound">A</a> <a id="8617" class="Symbol">:</a> <a id="8619" class="PrimitiveType">Set</a><a id="8622" class="Symbol">}</a> <a id="8624" class="Symbol">{</a><a id="8625" href="slides.html#8625" class="Bound">m</a> <a id="8627" href="slides.html#8627" class="Bound">n</a> <a id="8629" class="Symbol">:</a> <a id="8631" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8632" class="Symbol">}</a>
       <a id="8641" class="Symbol">→</a> <a id="8643" href="slides.html#8432" class="Datatype">Vec</a> <a id="8647" href="slides.html#8615" class="Bound">A</a> <a id="8649" href="slides.html#8625" class="Bound">m</a> <a id="8651" class="Symbol">→</a> <a id="8653" href="slides.html#8432" class="Datatype">Vec</a> <a id="8657" href="slides.html#8615" class="Bound">A</a> <a id="8659" href="slides.html#8627" class="Bound">n</a> <a id="8661" class="Symbol">→</a> <a id="8663" href="slides.html#8432" class="Datatype">Vec</a> <a id="8667" href="slides.html#8615" class="Bound">A</a> <a id="8669" class="Symbol">(</a><a id="8670" href="slides.html#8625" class="Bound">m</a> <a id="8672" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="8674" href="slides.html#8627" class="Bound">n</a><a id="8675" class="Symbol">)</a>
  <a id="8679" href="slides.html#8466" class="InductiveConstructor">[]</a>       <a id="8688" href="slides.html#8607" class="Function Operator">++</a> <a id="8691" href="slides.html#8691" class="Bound">ys</a> <a id="8694" class="Symbol">=</a> <a id="8696" href="slides.html#8691" class="Bound">ys</a>              <a id="8712" class="Comment">-- m = zero</a>
  <a id="8726" class="Symbol">(</a><a id="8727" href="slides.html#8727" class="Bound">x</a> <a id="8729" href="slides.html#8487" class="InductiveConstructor Operator">∷</a> <a id="8731" href="slides.html#8731" class="Bound">xs</a><a id="8733" class="Symbol">)</a> <a id="8735" href="slides.html#8607" class="Function Operator">++</a> <a id="8738" href="slides.html#8738" class="Bound">ys</a> <a id="8741" class="Symbol">=</a> <a id="8743" href="slides.html#8727" class="Bound">x</a> <a id="8745" href="slides.html#8487" class="InductiveConstructor Operator">∷</a> <a id="8747" class="Symbol">(</a><a id="8748" href="slides.html#8731" class="Bound">xs</a> <a id="8751" href="slides.html#8607" class="Function Operator">++</a> <a id="8754" href="slides.html#8738" class="Bound">ys</a><a id="8756" class="Symbol">)</a>  <a id="8759" class="Comment">-- m = suc m′</a>

  <a id="IndexedData.head"></a><a id="8776" href="slides.html#8776" class="Function">head</a> <a id="8781" class="Symbol">:</a> <a id="8783" class="Symbol">{</a><a id="8784" href="slides.html#8784" class="Bound">A</a> <a id="8786" class="Symbol">:</a> <a id="8788" class="PrimitiveType">Set</a><a id="8791" class="Symbol">}</a> <a id="8793" class="Symbol">{</a><a id="8794" href="slides.html#8794" class="Bound">n</a> <a id="8796" class="Symbol">:</a> <a id="8798" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="8799" class="Symbol">}</a> <a id="8801" class="Symbol">→</a> <a id="8803" href="slides.html#8432" class="Datatype">Vec</a> <a id="8807" href="slides.html#8784" class="Bound">A</a> <a id="8809" class="Symbol">(</a><a id="8810" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="8814" href="slides.html#8794" class="Bound">n</a><a id="8815" class="Symbol">)</a> <a id="8817" class="Symbol">→</a> <a id="8819" href="slides.html#8784" class="Bound">A</a>
  <a id="8823" class="Comment">-- head []         -- Impossible!</a>
  <a id="8859" href="slides.html#8776" class="Function">head</a> <a id="8864" class="Symbol">(</a><a id="8865" href="slides.html#8865" class="Bound">x</a> <a id="8867" href="slides.html#8487" class="InductiveConstructor Operator">∷</a> <a id="8869" href="slides.html#8869" class="Bound">xs</a><a id="8871" class="Symbol">)</a> <a id="8873" class="Symbol">=</a> <a id="8875" href="slides.html#8865" class="Bound">x</a>
</pre>
</section><section id="well-typed-syntax-representation" class="slide level2">
<h2>Well-typed syntax representation</h2>
<p>Our correct-by-construction typechecker produces <strong>intrinsically well-typed syntax</strong>:</p>
<pre class="agda-code">  <a id="IndexedData.Cxt"></a><a id="9012" href="slides.html#9012" class="Function">Cxt</a> <a id="9016" class="Symbol">=</a> <a id="9018" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="9023" href="slides.html#7383" class="Datatype">Type</a>

  <a id="9031" class="Keyword">data</a> <a id="IndexedData.Exp"></a><a id="9036" href="slides.html#9036" class="Datatype">Exp</a> <a id="9040" class="Symbol">(</a><a id="9041" href="slides.html#9041" class="Bound">Γ</a> <a id="9043" class="Symbol">:</a> <a id="9045" href="slides.html#9012" class="Function">Cxt</a><a id="9048" class="Symbol">)</a> <a id="9050" class="Symbol">:</a> <a id="9052" href="slides.html#7383" class="Datatype">Type</a> <a id="9057" class="Symbol">→</a> <a id="9059" class="PrimitiveType">Set</a>
</pre>
<p>A term <code>e : Exp Γ t</code> is a <em>well-typed</em> WHILE expression in context <code>Γ</code>.</p>
</section><section id="well-typed-syntax" class="slide level2">
<h2>Well-typed syntax</h2>
<pre class="agda-code">  <a id="IndexedData.Var"></a><a id="9173" href="slides.html#9173" class="Function">Var</a> <a id="9177" class="Symbol">:</a> <a id="9179" class="Symbol">(</a><a id="9180" href="slides.html#9180" class="Bound">Γ</a> <a id="9182" class="Symbol">:</a> <a id="9184" href="slides.html#9012" class="Function">Cxt</a><a id="9187" class="Symbol">)</a> <a id="9189" class="Symbol">(</a><a id="9190" href="slides.html#9190" class="Bound">t</a> <a id="9192" class="Symbol">:</a> <a id="9194" href="slides.html#7383" class="Datatype">Type</a><a id="9198" class="Symbol">)</a> <a id="9200" class="Symbol">→</a> <a id="9202" class="PrimitiveType">Set</a>
  <a id="9208" href="slides.html#9173" class="Function">Var</a> <a id="9212" href="slides.html#9212" class="Bound">Γ</a> <a id="9214" href="slides.html#9214" class="Bound">t</a> <a id="9216" class="Symbol">=</a> <a id="9218" href="slides.html#9214" class="Bound">t</a> <a id="9220" href="Data.List.Membership.Setoid.html#709" class="Function Operator">∈</a> <a id="9222" href="slides.html#9212" class="Bound">Γ</a>

  <a id="9227" class="Keyword">data</a> <a id="IndexedData.Op"></a><a id="9232" href="slides.html#9232" class="Datatype">Op</a> <a id="9235" class="Symbol">:</a> <a id="9237" class="Symbol">(</a><a id="9238" href="slides.html#9238" class="Bound">dom</a> <a id="9242" href="slides.html#9242" class="Bound">codom</a> <a id="9248" class="Symbol">:</a> <a id="9250" href="slides.html#7383" class="Datatype">Type</a><a id="9254" class="Symbol">)</a> <a id="9256" class="Symbol">→</a> <a id="9258" class="PrimitiveType">Set</a> <a id="9262" class="Keyword">where</a>
    <a id="IndexedData.Op.plus"></a><a id="9272" href="slides.html#9272" class="InductiveConstructor">plus</a>  <a id="9278" class="Symbol">:</a> <a id="9280" href="slides.html#9232" class="Datatype">Op</a> <a id="9283" href="slides.html#7409" class="InductiveConstructor">int</a>  <a id="9288" href="slides.html#7409" class="InductiveConstructor">int</a>
    <a id="IndexedData.Op.gt"></a><a id="9296" href="slides.html#9296" class="InductiveConstructor">gt</a>    <a id="9302" class="Symbol">:</a> <a id="9304" href="slides.html#9232" class="Datatype">Op</a> <a id="9307" href="slides.html#7409" class="InductiveConstructor">int</a>  <a id="9312" href="slides.html#7404" class="InductiveConstructor">bool</a>
    <a id="IndexedData.Op.and"></a><a id="9321" href="slides.html#9321" class="InductiveConstructor">and</a>   <a id="9327" class="Symbol">:</a> <a id="9329" href="slides.html#9232" class="Datatype">Op</a> <a id="9332" href="slides.html#7404" class="InductiveConstructor">bool</a> <a id="9337" href="slides.html#7404" class="InductiveConstructor">bool</a>

  <a id="9345" class="Keyword">data</a> <a id="9350" href="slides.html#9036" class="Datatype">Exp</a> <a id="9354" href="slides.html#9354" class="Bound">Γ</a> <a id="9356" class="Keyword">where</a>
    <a id="IndexedData.Exp.eInt"></a><a id="9366" href="slides.html#9366" class="InductiveConstructor">eInt</a>  <a id="9372" class="Symbol">:</a> <a id="9374" class="Symbol">(</a><a id="9375" href="slides.html#9375" class="Bound">i</a> <a id="9377" class="Symbol">:</a> <a id="9379" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a><a id="9380" class="Symbol">)</a>            <a id="9393" class="Symbol">→</a> <a id="9395" href="slides.html#9036" class="Datatype">Exp</a> <a id="9399" href="slides.html#9354" class="Bound">Γ</a> <a id="9401" href="slides.html#7409" class="InductiveConstructor">int</a>
    <a id="IndexedData.Exp.eBool"></a><a id="9409" href="slides.html#9409" class="InductiveConstructor">eBool</a> <a id="9415" class="Symbol">:</a> <a id="9417" class="Symbol">(</a><a id="9418" href="slides.html#9418" class="Bound">b</a> <a id="9420" class="Symbol">:</a> <a id="9422" href="slides.html#8365" class="Datatype">Boolean</a><a id="9429" class="Symbol">)</a>      <a id="9436" class="Symbol">→</a> <a id="9438" href="slides.html#9036" class="Datatype">Exp</a> <a id="9442" href="slides.html#9354" class="Bound">Γ</a> <a id="9444" href="slides.html#7404" class="InductiveConstructor">bool</a>
    <a id="IndexedData.Exp.eOp"></a><a id="9453" href="slides.html#9453" class="InductiveConstructor">eOp</a>   <a id="9459" class="Symbol">:</a> <a id="9461" class="Symbol">∀{</a><a id="9463" href="slides.html#9463" class="Bound">t</a> <a id="9465" href="slides.html#9465" class="Bound">t&#39;</a><a id="9467" class="Symbol">}</a> <a id="9469" class="Symbol">(</a><a id="9470" href="slides.html#9470" class="Bound">op</a> <a id="9473" class="Symbol">:</a> <a id="9475" href="slides.html#9232" class="Datatype">Op</a> <a id="9478" href="slides.html#9463" class="Bound">t</a> <a id="9480" href="slides.html#9465" class="Bound">t&#39;</a><a id="9482" class="Symbol">)</a>
          <a id="9494" class="Symbol">→</a> <a id="9496" class="Symbol">(</a><a id="9497" href="slides.html#9497" class="Bound">e</a> <a id="9499" href="slides.html#9499" class="Bound">e&#39;</a> <a id="9502" class="Symbol">:</a> <a id="9504" href="slides.html#9036" class="Datatype">Exp</a> <a id="9508" href="slides.html#9354" class="Bound">Γ</a> <a id="9510" href="slides.html#9463" class="Bound">t</a><a id="9511" class="Symbol">)</a>   <a id="9515" class="Symbol">→</a> <a id="9517" href="slides.html#9036" class="Datatype">Exp</a> <a id="9521" href="slides.html#9354" class="Bound">Γ</a> <a id="9523" href="slides.html#9465" class="Bound">t&#39;</a>
    <a id="IndexedData.Exp.eVar"></a><a id="9530" href="slides.html#9530" class="InductiveConstructor">eVar</a>  <a id="9536" class="Symbol">:</a> <a id="9538" class="Symbol">∀{</a><a id="9540" href="slides.html#9540" class="Bound">t</a><a id="9541" class="Symbol">}</a> <a id="9543" class="Symbol">(</a><a id="9544" href="slides.html#9544" class="Bound">x</a> <a id="9546" class="Symbol">:</a> <a id="9548" href="slides.html#9173" class="Function">Var</a> <a id="9552" href="slides.html#9354" class="Bound">Γ</a> <a id="9554" href="slides.html#9540" class="Bound">t</a><a id="9555" class="Symbol">)</a> <a id="9557" class="Symbol">→</a> <a id="9559" href="slides.html#9036" class="Datatype">Exp</a> <a id="9563" href="slides.html#9354" class="Bound">Γ</a> <a id="9565" href="slides.html#9540" class="Bound">t</a>
</pre>
<p>see <code>WellTypedSyntax.agda</code></p>
</section><section id="evaluating-well-typed-syntax" class="slide level2">
<h2>Evaluating well-typed syntax</h2>
<p>We can now define <code>eval</code> for well-typed expressions:</p>
<pre class="agda-code">  <a id="IndexedData.Val"></a><a id="9692" href="slides.html#9692" class="Function">Val</a> <a id="9696" class="Symbol">:</a> <a id="9698" href="slides.html#7383" class="Datatype">Type</a> <a id="9703" class="Symbol">→</a> <a id="9705" class="PrimitiveType">Set</a>
  <a id="9711" href="slides.html#9692" class="Function">Val</a> <a id="9715" href="slides.html#7409" class="InductiveConstructor">int</a>    <a id="9722" class="Symbol">=</a> <a id="9724" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
  <a id="9728" href="slides.html#9692" class="Function">Val</a> <a id="9732" href="slides.html#7404" class="InductiveConstructor">bool</a>   <a id="9739" class="Symbol">=</a> <a id="9741" href="slides.html#8365" class="Datatype">Boolean</a>

  <a id="IndexedData.Env"></a><a id="9752" href="slides.html#9752" class="Function">Env</a> <a id="9756" class="Symbol">:</a> <a id="9758" href="slides.html#9012" class="Function">Cxt</a> <a id="9762" class="Symbol">→</a> <a id="9764" class="PrimitiveType">Set</a>
  <a id="9770" href="slides.html#9752" class="Function">Env</a> <a id="9774" class="Symbol">=</a> <a id="9776" href="Data.List.All.html#826" class="Datatype">All</a> <a id="9780" href="slides.html#9692" class="Function">Val</a>

  <a id="IndexedData.eval"></a><a id="9787" href="slides.html#9787" class="Function">eval</a> <a id="9792" class="Symbol">:</a> <a id="9794" class="Symbol">∀</a> <a id="9796" class="Symbol">{</a><a id="9797" href="slides.html#9797" class="Bound">Γ</a><a id="9798" class="Symbol">}</a> <a id="9800" class="Symbol">{</a><a id="9801" href="slides.html#9801" class="Bound">t</a><a id="9802" class="Symbol">}</a> <a id="9804" class="Symbol">→</a> <a id="9806" href="slides.html#9752" class="Function">Env</a> <a id="9810" href="slides.html#9797" class="Bound">Γ</a> <a id="9812" class="Symbol">→</a> <a id="9814" href="slides.html#9036" class="Datatype">Exp</a> <a id="9818" href="slides.html#9797" class="Bound">Γ</a> <a id="9820" href="slides.html#9801" class="Bound">t</a> <a id="9822" class="Symbol">→</a> <a id="9824" href="slides.html#9692" class="Function">Val</a> <a id="9828" href="slides.html#9801" class="Bound">t</a>
  <a id="9832" href="slides.html#9787" class="Function">eval</a> <a id="9837" class="Symbol">=</a> <a id="9839" href="slides.html#2729" class="Postulate">⋯</a>
</pre>
<p>that <strong>always</strong> returns a value (bye bye <code>Maybe</code>!)</p>
<p>See definition of <code>eval</code> in <code>Interpreter.agda</code>.</p>
</section><section id="exercise-3" class="slide level2">
<h2>Exercise #3</h2>
<p>Extend the well-typed syntax with the new syntactic constructions you added.</p>
</section></section>
<section><section id="break-30-min" class="title-slide slide level1"><h1>BREAK (30 min)</h1></section></section>
<section><section id="monads-and-instance-arguments" class="title-slide slide level1"><h1>Monads and instance arguments</h1></section><section id="instance-arguments" class="slide level2">
<h2>Instance arguments</h2>
<p><em>Instance arguments</em> are Agda’s builtin mechanism for ad-hoc overloading (~ type classes in Haskell).</p>
<p>Syntax:</p>
<ul>
<li>Using an instance: <code>{{x : A}} → ...</code></li>
<li>Defining new instances: <code>instance ...</code></li>
</ul>
<p>When using a function of type <code>{{x : A}} → B</code>, Agda will automatically resolve the argument if there is a <strong>unique</strong> instance of the right type in scope.</p>
</section><section id="defining-a-typeclass-with-instance-arguments" class="slide level2">
<h2>Defining a typeclass with instance arguments</h2>
<!--
<pre class="agda-code"><a id="10526" class="Keyword">module</a> <a id="Instances"></a><a id="10533" href="slides.html#10533" class="Module">Instances</a> <a id="10543" class="Keyword">where</a>
  <a id="10551" class="Keyword">open</a> <a id="10556" class="Keyword">import</a> <a id="10563" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
  <a id="10580" class="Keyword">open</a> <a id="10585" class="Keyword">import</a> <a id="10592" href="Data.String.Base.html" class="Module">Data.String.Base</a>
</pre>-->
<pre class="agda-code">  <a id="10628" class="Keyword">record</a> <a id="Instances.Print"></a><a id="10635" href="slides.html#10635" class="Record">Print</a> <a id="10641" class="Symbol">{</a><a id="10642" href="slides.html#10642" class="Bound">ℓ</a><a id="10643" class="Symbol">}</a> <a id="10645" class="Symbol">(</a><a id="10646" href="slides.html#10646" class="Bound">A</a> <a id="10648" class="Symbol">:</a> <a id="10650" class="PrimitiveType">Set</a> <a id="10654" href="slides.html#10642" class="Bound">ℓ</a><a id="10655" class="Symbol">)</a> <a id="10657" class="Symbol">:</a> <a id="10659" class="PrimitiveType">Set</a> <a id="10663" href="slides.html#10642" class="Bound">ℓ</a> <a id="10665" class="Keyword">where</a>
    <a id="10675" class="Keyword">field</a>
      <a id="Instances.Print.print"></a><a id="10687" href="slides.html#10687" class="Field">print</a> <a id="10693" class="Symbol">:</a> <a id="10695" href="slides.html#10646" class="Bound">A</a> <a id="10697" class="Symbol">→</a> <a id="10699" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
  <a id="10708" class="Keyword">open</a> <a id="10713" href="slides.html#10635" class="Module">Print</a> <a id="10719" class="Symbol">{{...}}</a>  <a id="10728" class="Comment">-- print : {{r : Print A}} → A → String</a>

  <a id="10771" class="Keyword">instance</a>
    <a id="Instances.PrintBool"></a><a id="10784" href="slides.html#10784" class="Function">PrintBool</a> <a id="10794" class="Symbol">:</a> <a id="10796" href="slides.html#10635" class="Record">Print</a> <a id="10802" href="Agda.Builtin.Bool.html#67" class="Datatype">Bool</a>
    <a id="10811" href="slides.html#10687" class="Field">print</a> <a id="10817" class="Symbol">{{</a><a id="10819" href="slides.html#10784" class="Function">PrintBool</a><a id="10828" class="Symbol">}}</a> <a id="10831" href="Agda.Builtin.Bool.html#92" class="InductiveConstructor">true</a>  <a id="10837" class="Symbol">=</a> <a id="10839" class="String">&quot;true&quot;</a>
    <a id="10850" href="slides.html#10687" class="Field">print</a> <a id="10856" class="Symbol">{{</a><a id="10858" href="slides.html#10784" class="Function">PrintBool</a><a id="10867" class="Symbol">}}</a> <a id="10870" href="Agda.Builtin.Bool.html#86" class="InductiveConstructor">false</a> <a id="10876" class="Symbol">=</a> <a id="10878" class="String">&quot;false&quot;</a>

    <a id="Instances.PrintString"></a><a id="10891" href="slides.html#10891" class="Function">PrintString</a> <a id="10903" class="Symbol">:</a> <a id="10905" href="slides.html#10635" class="Record">Print</a> <a id="10911" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
    <a id="10922" href="slides.html#10687" class="Field">print</a> <a id="10928" class="Symbol">{{</a><a id="10930" href="slides.html#10891" class="Function">PrintString</a><a id="10941" class="Symbol">}}</a> <a id="10944" href="slides.html#10944" class="Bound">x</a> <a id="10946" class="Symbol">=</a> <a id="10948" href="slides.html#10944" class="Bound">x</a>

  <a id="Instances.testPrint"></a><a id="10953" href="slides.html#10953" class="Function">testPrint</a> <a id="10963" class="Symbol">:</a> <a id="10965" href="Agda.Builtin.String.html#174" class="Postulate">String</a>
  <a id="10974" href="slides.html#10953" class="Function">testPrint</a> <a id="10984" class="Symbol">=</a> <a id="10986" class="Symbol">(</a><a id="10987" href="slides.html#10687" class="Field">print</a> <a id="10993" href="Agda.Builtin.Bool.html#92" class="InductiveConstructor">true</a><a id="10997" class="Symbol">)</a> <a id="10999" href="Data.String.Base.html#1089" class="Function Operator">++</a> <a id="11002" class="Symbol">(</a><a id="11003" href="slides.html#10687" class="Field">print</a> <a id="11009" class="String">&quot;a string&quot;</a><a id="11019" class="Symbol">)</a>
</pre>
</section><section id="monads" class="slide level2">
<h2>Monads</h2>
<p><code>Monad</code> is a typeclass with two fields <code>return</code> and <code>_&gt;&gt;=_</code>.</p>
<p>Example: <code>Error</code> monad (see <code>Library/Error.agda</code>)</p>
</section><section id="correct-by-construction-typechecker" class="slide level2">
<h2>Correct-by-construction typechecker</h2>
<p>See <code>TypeChecker.agda</code></p>
</section><section id="exercise-4" class="slide level2">
<h2>Exercise #4</h2>
<p>Extend the typechecker with rules for the new syntactic constructions you added.</p>
</section></section>
<section><section id="coinduction-and-sized-types" class="title-slide slide level1"><h1>Coinduction and sized types</h1></section><section id="coinduction-in-agda" class="slide level2">
<h2>Coinduction in Agda</h2>
<p>Coinductive type may contain infinitely deep values (non well-founded trees)</p>
<!--
<pre class="agda-code"><a id="11458" class="Keyword">module</a> <a id="Coinduction"></a><a id="11465" href="slides.html#11465" class="Module">Coinduction</a> <a id="11477" class="Keyword">where</a>
  <a id="11485" class="Keyword">module</a> <a id="GuardedStream"></a><a id="11492" href="slides.html#11492" class="Module">GuardedStream</a> <a id="11506" class="Keyword">where</a>
</pre>-->
<pre class="agda-code">    <a id="11533" class="Keyword">record</a> <a id="Coinduction.GuardedStream.Stream"></a><a id="11540" href="slides.html#11540" class="Record">Stream</a> <a id="11547" class="Symbol">(</a><a id="11548" href="slides.html#11548" class="Bound">A</a> <a id="11550" class="Symbol">:</a> <a id="11552" class="PrimitiveType">Set</a><a id="11555" class="Symbol">)</a> <a id="11557" class="Symbol">:</a> <a id="11559" class="PrimitiveType">Set</a> <a id="11563" class="Keyword">where</a>
      <a id="11575" class="Keyword">coinductive</a>
      <a id="11593" class="Keyword">field</a>
        <a id="Coinduction.GuardedStream.Stream.head"></a><a id="11607" href="slides.html#11607" class="Field">head</a> <a id="11612" class="Symbol">:</a> <a id="11614" href="slides.html#11548" class="Bound">A</a>
        <a id="Coinduction.GuardedStream.Stream.tail"></a><a id="11624" href="slides.html#11624" class="Field">tail</a> <a id="11629" class="Symbol">:</a> <a id="11631" href="slides.html#11540" class="Record">Stream</a> <a id="11638" href="slides.html#11548" class="Bound">A</a>
    <a id="11644" class="Keyword">open</a> <a id="11649" href="slides.html#11540" class="Module">Stream</a>

    <a id="Coinduction.GuardedStream.repeat"></a><a id="11661" href="slides.html#11661" class="Function">repeat</a> <a id="11668" class="Symbol">:</a> <a id="11670" class="Symbol">{</a><a id="11671" href="slides.html#11671" class="Bound">A</a> <a id="11673" class="Symbol">:</a> <a id="11675" class="PrimitiveType">Set</a><a id="11678" class="Symbol">}</a> <a id="11680" class="Symbol">→</a> <a id="11682" href="slides.html#11671" class="Bound">A</a> <a id="11684" class="Symbol">→</a> <a id="11686" href="slides.html#11540" class="Record">Stream</a> <a id="11693" href="slides.html#11671" class="Bound">A</a>
    <a id="11699" href="slides.html#11661" class="Function">repeat</a> <a id="11706" href="slides.html#11706" class="Bound">x</a> <a id="11708" class="Symbol">.</a><a id="11709" href="slides.html#11607" class="Field">head</a> <a id="11714" class="Symbol">=</a> <a id="11716" href="slides.html#11706" class="Bound">x</a>
    <a id="11722" href="slides.html#11661" class="Function">repeat</a> <a id="11729" href="slides.html#11729" class="Bound">x</a> <a id="11731" class="Symbol">.</a><a id="11732" href="slides.html#11624" class="Field">tail</a> <a id="11737" class="Symbol">=</a> <a id="11739" href="slides.html#11661" class="Function">repeat</a> <a id="11746" href="slides.html#11729" class="Bound">x</a>
</pre>
</section><section id="dealing-with-infinite-computations" class="slide level2">
<h2>Dealing with infinite computations</h2>
<p>Remember: all Agda functions must be <strong>total</strong></p>
<p>⇒ interpreter for WHILE takes <code>fuel</code> argument</p>
<p>Can we do better?</p>
</section><section id="going-carbon-free-with-the-delay-monad" class="slide level2">
<h2>Going carbon-free with the <code>Delay</code> monad</h2>
<p><strong>Monads</strong> allow us to use effects in a pure language</p>
<p>The <code>Delay</code> monad captures the effect of <em>non-termination</em></p>
<p>A value of type <code>Delay A</code> is</p>
<ul>
<li>either a value of type <code>A</code> produced <strong>now</strong></li>
<li>or a computation of type <code>Delay A</code> producing a value <strong>later</strong></li>
</ul>
</section><section id="the-delay-monad-definition" class="slide level2">
<h2>The Delay monad: definition</h2>
<pre class="agda-code">  <a id="12250" class="Keyword">mutual</a>
    <a id="12261" class="Keyword">record</a> <a id="Coinduction.Delay"></a><a id="12268" href="slides.html#12268" class="Record">Delay</a> <a id="12274" class="Symbol">(</a><a id="12275" href="slides.html#12275" class="Bound">A</a> <a id="12277" class="Symbol">:</a> <a id="12279" class="PrimitiveType">Set</a><a id="12282" class="Symbol">)</a> <a id="12284" class="Symbol">:</a> <a id="12286" class="PrimitiveType">Set</a> <a id="12290" class="Keyword">where</a>
      <a id="12302" class="Keyword">coinductive</a>
      <a id="12320" class="Keyword">field</a> <a id="Coinduction.Delay.force"></a><a id="12326" href="slides.html#12326" class="Field">force</a> <a id="12332" class="Symbol">:</a> <a id="12334" href="slides.html#12353" class="Datatype">Delay&#39;</a> <a id="12341" href="slides.html#12275" class="Bound">A</a>

    <a id="12348" class="Keyword">data</a> <a id="Coinduction.Delay&#39;"></a><a id="12353" href="slides.html#12353" class="Datatype">Delay&#39;</a> <a id="12360" class="Symbol">(</a><a id="12361" href="slides.html#12361" class="Bound">A</a> <a id="12363" class="Symbol">:</a> <a id="12365" class="PrimitiveType">Set</a><a id="12368" class="Symbol">)</a> <a id="12370" class="Symbol">:</a> <a id="12372" class="PrimitiveType">Set</a> <a id="12376" class="Keyword">where</a>
      <a id="Coinduction.Delay&#39;.now"></a><a id="12388" href="slides.html#12388" class="InductiveConstructor">now</a>   <a id="12394" class="Symbol">:</a> <a id="12396" href="slides.html#12361" class="Bound">A</a>       <a id="12404" class="Symbol">→</a> <a id="12406" href="slides.html#12353" class="Datatype">Delay&#39;</a> <a id="12413" href="slides.html#12361" class="Bound">A</a>
      <a id="Coinduction.Delay&#39;.later"></a><a id="12421" href="slides.html#12421" class="InductiveConstructor">later</a> <a id="12427" class="Symbol">:</a> <a id="12429" href="slides.html#12268" class="Record">Delay</a> <a id="12435" href="slides.html#12361" class="Bound">A</a> <a id="12437" class="Symbol">→</a> <a id="12439" href="slides.html#12353" class="Datatype">Delay&#39;</a> <a id="12446" href="slides.html#12361" class="Bound">A</a>

  <a id="12451" class="Keyword">open</a> <a id="12456" href="slides.html#12268" class="Module">Delay</a> <a id="12462" class="Keyword">public</a>

  <a id="Coinduction.never"></a><a id="12472" href="slides.html#12472" class="Function">never</a> <a id="12478" class="Symbol">:</a> <a id="12480" class="Symbol">{</a><a id="12481" href="slides.html#12481" class="Bound">A</a> <a id="12483" class="Symbol">:</a> <a id="12485" class="PrimitiveType">Set</a><a id="12488" class="Symbol">}</a> <a id="12490" class="Symbol">→</a> <a id="12492" href="slides.html#12268" class="Record">Delay</a> <a id="12498" href="slides.html#12481" class="Bound">A</a>
  <a id="12502" href="slides.html#12472" class="Function">never</a> <a id="12508" class="Symbol">.</a><a id="12509" href="slides.html#12326" class="Field">force</a> <a id="12515" class="Symbol">=</a> <a id="12517" href="slides.html#12421" class="InductiveConstructor">later</a> <a id="12523" href="slides.html#12472" class="Function">never</a>
</pre>
</section><section id="sized-types" class="slide level2">
<h2>Sized types</h2>
<p>Totality requirement: coinductive definitions should be <strong>productive</strong>: computing each observation should be terminating.</p>
<p>To ensure this, Agda checks that corecursive calls are <strong>guarded by constructors</strong>, but this is often quite limiting.</p>
<p>A more flexible and modular approach is to use <strong>sized types</strong>.</p>
</section><section id="the-type-size" class="slide level2">
<h2>The type <code>Size</code></h2>
<p><code>Size</code> ≃ abstract version of the natural numbers extended with <code>∞</code></p>
<p>For each <code>i : Size</code>, we have a type <code>Size&lt; i</code> of sizes <strong>smaller than <code>i</code></strong>.</p>
<p><strong>Note</strong>: pattern matching on <code>Size</code> is not allowed!</p>
</section><section id="the-sized-delay-monad" class="slide level2">
<h2>The sized delay monad</h2>
<!--
<pre class="agda-code"><a id="13116" class="Keyword">module</a> <a id="SizedTypes"></a><a id="13123" href="slides.html#13123" class="Module">SizedTypes</a> <a id="13134" class="Keyword">where</a>
  <a id="13142" class="Keyword">open</a> <a id="13147" class="Keyword">import</a> <a id="13154" href="Size.html" class="Module">Size</a>
</pre>-->
<pre class="agda-code">  <a id="13178" class="Keyword">mutual</a>
    <a id="13189" class="Keyword">record</a> <a id="SizedTypes.Delay"></a><a id="13196" href="slides.html#13196" class="Record">Delay</a> <a id="13202" class="Symbol">(</a><a id="13203" href="slides.html#13203" class="Bound">i</a> <a id="13205" class="Symbol">:</a> <a id="13207" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="13211" class="Symbol">)</a> <a id="13213" class="Symbol">(</a><a id="13214" href="slides.html#13214" class="Bound">A</a> <a id="13216" class="Symbol">:</a> <a id="13218" class="PrimitiveType">Set</a><a id="13221" class="Symbol">)</a> <a id="13223" class="Symbol">:</a> <a id="13225" class="PrimitiveType">Set</a> <a id="13229" class="Keyword">where</a>
      <a id="13241" class="Keyword">coinductive</a>
      <a id="13259" class="Keyword">constructor</a> <a id="SizedTypes.Delay.delay"></a><a id="13271" href="slides.html#13271" class="CoinductiveConstructor">delay</a>
      <a id="13283" class="Keyword">field</a>
        <a id="SizedTypes.Delay.force"></a><a id="13297" href="slides.html#13297" class="Field">force</a> <a id="13303" class="Symbol">:</a> <a id="13305" class="Symbol">{</a><a id="13306" href="slides.html#13306" class="Bound">j</a> <a id="13308" class="Symbol">:</a> <a id="13310" href="Agda.Builtin.Size.html#146" class="Postulate Operator">Size&lt;</a> <a id="13316" href="slides.html#13203" class="Bound">i</a><a id="13317" class="Symbol">}</a> <a id="13319" class="Symbol">→</a> <a id="13321" href="slides.html#13342" class="Datatype">Delay&#39;</a> <a id="13328" href="slides.html#13306" class="Bound">j</a> <a id="13330" href="slides.html#13214" class="Bound">A</a>

    <a id="13337" class="Keyword">data</a> <a id="SizedTypes.Delay&#39;"></a><a id="13342" href="slides.html#13342" class="Datatype">Delay&#39;</a> <a id="13349" class="Symbol">(</a><a id="13350" href="slides.html#13350" class="Bound">i</a> <a id="13352" class="Symbol">:</a> <a id="13354" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="13358" class="Symbol">)</a> <a id="13360" class="Symbol">(</a><a id="13361" href="slides.html#13361" class="Bound">A</a> <a id="13363" class="Symbol">:</a> <a id="13365" class="PrimitiveType">Set</a><a id="13368" class="Symbol">)</a> <a id="13370" class="Symbol">:</a> <a id="13372" class="PrimitiveType">Set</a> <a id="13376" class="Keyword">where</a>
      <a id="SizedTypes.Delay&#39;.return&#39;"></a><a id="13388" href="slides.html#13388" class="InductiveConstructor">return&#39;</a> <a id="13396" class="Symbol">:</a> <a id="13398" href="slides.html#13361" class="Bound">A</a>         <a id="13408" class="Symbol">→</a> <a id="13410" href="slides.html#13342" class="Datatype">Delay&#39;</a> <a id="13417" href="slides.html#13350" class="Bound">i</a> <a id="13419" href="slides.html#13361" class="Bound">A</a>
      <a id="SizedTypes.Delay&#39;.later&#39;"></a><a id="13427" href="slides.html#13427" class="InductiveConstructor">later&#39;</a>  <a id="13435" class="Symbol">:</a> <a id="13437" href="slides.html#13196" class="Record">Delay</a> <a id="13443" href="slides.html#13350" class="Bound">i</a> <a id="13445" href="slides.html#13361" class="Bound">A</a> <a id="13447" class="Symbol">→</a> <a id="13449" href="slides.html#13342" class="Datatype">Delay&#39;</a> <a id="13456" href="slides.html#13350" class="Bound">i</a> <a id="13458" href="slides.html#13361" class="Bound">A</a>
</pre>
<p><code>i</code> ≃ how many more steps are we allowed to observe.</p>
<p><code>Delay ∞ A</code> is the type of computations that can take <em>any</em> number of steps.</p>
</section><section id="interpreting-well-typed-while-programs" class="slide level2">
<h2>Interpreting well-typed WHILE programs</h2>
<p>WHILE statements can have two effects:</p>
<ul>
<li>Modify the environment ⇒ <code>State</code> monad</li>
<li>Go into a loop ⇒ <code>Delay</code> monad</li>
</ul>
<p>We combine both effects in the <code>Exec</code> monad.</p>
</section><section id="the-exec-monad" class="slide level2">
<h2>The <code>Exec</code> monad</h2>
<!--
<pre class="agda-code">  <a id="13848" class="Keyword">open</a> <a id="13853" class="Keyword">import</a> <a id="13860" href="Data.Unit.html" class="Module">Data.Unit</a>
  <a id="13872" class="Keyword">open</a> <a id="13877" class="Keyword">import</a> <a id="13884" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a>
  <a id="13904" class="Keyword">open</a> <a id="13909" href="slides.html#8099" class="Module">IndexedData</a>
  <a id="13923" class="Keyword">postulate</a>
    <a id="SizedTypes.Stm"></a><a id="13937" href="slides.html#13937" class="Postulate">Stm</a> <a id="13941" class="Symbol">:</a> <a id="13943" href="slides.html#9012" class="Function">Cxt</a> <a id="13947" class="Symbol">→</a> <a id="13949" class="PrimitiveType">Set</a>
    <a id="SizedTypes.Program"></a><a id="13957" href="slides.html#13957" class="Postulate">Program</a> <a id="13965" class="Symbol">:</a> <a id="13967" class="PrimitiveType">Set</a>
</pre>-->
<pre class="agda-code">  <a id="13990" class="Keyword">record</a> <a id="SizedTypes.Exec"></a><a id="13997" href="slides.html#13997" class="Record">Exec</a> <a id="14002" class="Symbol">{</a><a id="14003" href="slides.html#14003" class="Bound">Γ</a> <a id="14005" class="Symbol">:</a> <a id="14007" href="slides.html#9012" class="Function">Cxt</a><a id="14010" class="Symbol">}</a> <a id="14012" class="Symbol">(</a><a id="14013" href="slides.html#14013" class="Bound">i</a> <a id="14015" class="Symbol">:</a> <a id="14017" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="14021" class="Symbol">)</a> <a id="14023" class="Symbol">(</a><a id="14024" href="slides.html#14024" class="Bound">A</a> <a id="14026" class="Symbol">:</a> <a id="14028" class="PrimitiveType">Set</a><a id="14031" class="Symbol">)</a> <a id="14033" class="Symbol">:</a> <a id="14035" class="PrimitiveType">Set</a> <a id="14039" class="Keyword">where</a>
    <a id="14049" class="Keyword">field</a>
      <a id="SizedTypes.Exec.runExec"></a><a id="14061" href="slides.html#14061" class="Field">runExec</a> <a id="14069" class="Symbol">:</a> <a id="14071" class="Symbol">(</a><a id="14072" href="slides.html#14072" class="Bound">ρ</a> <a id="14074" class="Symbol">:</a> <a id="14076" href="slides.html#9752" class="Function">Env</a> <a id="14080" href="slides.html#14003" class="Bound">Γ</a><a id="14081" class="Symbol">)</a> <a id="14083" class="Symbol">→</a> <a id="14085" href="slides.html#13196" class="Record">Delay</a> <a id="14091" href="slides.html#14013" class="Bound">i</a> <a id="14093" class="Symbol">(</a><a id="14094" href="slides.html#14024" class="Bound">A</a> <a id="14096" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="14098" href="slides.html#9752" class="Function">Env</a> <a id="14102" href="slides.html#14003" class="Bound">Γ</a><a id="14103" class="Symbol">)</a>
  <a id="14107" class="Keyword">open</a> <a id="14112" href="slides.html#13997" class="Module">Exec</a> <a id="14117" class="Keyword">public</a>

  <a id="SizedTypes.execStm"></a><a id="14127" href="slides.html#14127" class="Function">execStm</a> <a id="14135" class="Symbol">:</a> <a id="14137" class="Symbol">∀</a> <a id="14139" class="Symbol">{</a><a id="14140" href="slides.html#14140" class="Bound">Γ</a><a id="14141" class="Symbol">}</a> <a id="14143" class="Symbol">{</a><a id="14144" href="slides.html#14144" class="Bound">i</a><a id="14145" class="Symbol">}</a> <a id="14147" class="Symbol">(</a><a id="14148" href="slides.html#14148" class="Bound">s</a> <a id="14150" class="Symbol">:</a> <a id="14152" href="slides.html#13937" class="Postulate">Stm</a> <a id="14156" href="slides.html#14140" class="Bound">Γ</a><a id="14157" class="Symbol">)</a> <a id="14159" class="Symbol">→</a> <a id="14161" href="slides.html#13997" class="Record">Exec</a> <a id="14166" class="Symbol">{</a><a id="14167" href="slides.html#14140" class="Bound">Γ</a><a id="14168" class="Symbol">}</a> <a id="14170" href="slides.html#14144" class="Bound">i</a> <a id="14172" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a>
  <a id="14176" href="slides.html#14127" class="Function">execStm</a> <a id="14184" class="Symbol">=</a> <a id="14186" href="slides.html#2729" class="Postulate">⋯</a>

  <a id="SizedTypes.execPrg"></a><a id="14191" href="slides.html#14191" class="Function">execPrg</a> <a id="14199" class="Symbol">:</a> <a id="14201" class="Symbol">∀</a> <a id="14203" class="Symbol">{</a><a id="14204" href="slides.html#14204" class="Bound">i</a><a id="14205" class="Symbol">}</a> <a id="14207" class="Symbol">(</a><a id="14208" href="slides.html#14208" class="Bound">prg</a> <a id="14212" class="Symbol">:</a> <a id="14214" href="slides.html#13957" class="Postulate">Program</a><a id="14221" class="Symbol">)</a> <a id="14223" class="Symbol">→</a> <a id="14225" href="slides.html#13196" class="Record">Delay</a> <a id="14231" href="slides.html#14204" class="Bound">i</a> <a id="14233" href="Agda.Builtin.Int.html#178" class="Datatype">ℤ</a>
  <a id="14237" href="slides.html#14191" class="Function">execPrg</a> <a id="14245" href="slides.html#14245" class="Bound">prg</a> <a id="14249" class="Symbol">=</a> <a id="14251" href="slides.html#2729" class="Postulate">⋯</a>
</pre>
<p>See <code>Interpreter.agda</code> for full code</p>
</section><section id="exercise-5" class="slide level2">
<h2>Exercise #5</h2>
<p>Extend the interpreter with rules for the new syntactic constructions you added.</p>
</section></section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js/lib/js/head.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'linear', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        height: 720,
        // Factor of the display size that should remain empty around the content
        margin: 0.2,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'https://cdn.jsdelivr.net/npm/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/math/math.js', async: true },
          { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
